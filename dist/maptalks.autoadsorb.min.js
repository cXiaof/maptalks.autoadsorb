/*!
 * maptalks.autoadsorb v0.3.0
 * LICENSE : MIT
 * (c) 2016-2022 maptalks.org
 */
/*!
 * requires maptalks@>=0.46.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(T,s){"use strict";function G(t,e,r,n,o){!function t(e,r,n,o,i){for(;n<o;){600<o-n&&(a=o-n+1,l=r-n+1,u=Math.log(a),s=.5*Math.exp(2*u/3),u=.5*Math.sqrt(u*s*(a-s)/a)*(l-a/2<0?-1:1),c=Math.max(n,Math.floor(r-l*s/a+u)),l=Math.min(o,Math.floor(r+(a-l)*s/a+u)),t(e,r,c,l,i));var a,s,u,c,l,f=e[r],h=n,p=o;for(d(e,n,r),0<i(e[o],f)&&d(e,n,o);h<p;){for(d(e,h,p),h++,p--;i(e[h],f)<0;)h++;for(;0<i(e[p],f);)p--}0===i(e[n],f)?d(e,n,p):d(e,++p,o),p<=r&&(n=p+1),r<=p&&(o=p-1)}}(t,e,r||0,n||t.length-1,o||F)}function d(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function F(t,e){return t<e?-1:e<t?1:0}n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,r=[];if(!u(t,e))return r;for(var n=this.toBBox,o=[];e;){for(var i=0;i<e.children.length;i++){var a=e.children[i],s=e.leaf?n(a):a;u(t,s)&&(e.leaf?r.push(a):I(t,s)?this._all(a,r):o.push(a))}e=o.pop()}return r},n.prototype.collides=function(t){var e=this.data;if(!u(t,e))return!1;for(var r=[];e;){for(var n=0;n<e.children.length;n++){var o=e.children[n],i=e.leaf?this.toBBox(o):o;if(u(t,i)){if(e.leaf||I(t,i))return!0;r.push(o)}}e=r.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var r,n=this._build(t.slice(),0,t.length-1,0);return this.data.children.length?this.data.height===n.height?this._splitRoot(this.data,n):(this.data.height<n.height&&(r=this.data,this.data=n,n=r),this._insert(n,this.data.height-n.height-1,!0)):this.data=n,this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=v([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var r=this.data,n=this.toBBox(t),o=[],i=[],a=void 0,s=void 0,u=void 0;r||o.length;){if(r||(r=o.pop(),s=o[o.length-1],a=i.pop(),u=!0),r.leaf){var c=function(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}(t,r.children,e);if(-1!==c)return r.children.splice(c,1),o.push(r),this._condense(o),this}u||r.leaf||!I(r,n)?s?(a++,r=s.children[a],u=!1):r=null:(o.push(r),i.push(a),r=(s=r).children[a=0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},n.prototype._build=function(t,e,r,n){var o=r-e+1,i=this._maxEntries,a=void 0;if(o<=i)return p(a=v(t.slice(e,r+1)),this.toBBox),a;n||(n=Math.ceil(Math.log(o)/Math.log(i)),i=Math.ceil(o/Math.pow(i,n-1))),(a=v([])).leaf=!1,a.height=n;var s=Math.ceil(o/i),u=s*Math.ceil(Math.sqrt(i));N(t,e,r,u,this.compareMinX);for(var c=e;c<=r;c+=u){var l=Math.min(c+u-1,r);N(t,c,l,s,this.compareMinY);for(var f=c;f<=l;f+=s){var h=Math.min(f+s-1,l);a.children.push(this._build(t,f,h,n-1))}}return p(a,this.toBBox),a},n.prototype._chooseSubtree=function(t,e,r,n){for(;;){if(n.push(e),e.leaf||n.length-1===r)break;for(var o=1/0,i=1/0,a=void 0,s=0;s<e.children.length;s++){var u=e.children[s],c=Y(u),l=(f=t,l=u,(Math.max(l.maxX,f.maxX)-Math.min(l.minX,f.minX))*(Math.max(l.maxY,f.maxY)-Math.min(l.minY,f.minY))-c);l<i?(i=l,o=c<o?c:o,a=u):l===i&&c<o&&(o=c,a=u)}e=a||e.children[0]}var f,l;return e},n.prototype._insert=function(t,e,r){var r=r?t:this.toBBox(t),n=[],o=this._chooseSubtree(r,this.data,e,n);for(o.children.push(t),h(o,r);0<=e&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},n.prototype._split=function(t,e){var r=t[e],n=r.children.length,o=this._minEntries,o=(this._chooseSplitAxis(r,o,n),this._chooseSplitIndex(r,o,n)),n=v(r.children.splice(o,r.children.length-o));n.height=r.height,n.leaf=r.leaf,p(r,this.toBBox),p(n,this.toBBox),e?t[e-1].children.push(n):this._splitRoot(r,n)},n.prototype._splitRoot=function(t,e){this.data=v([t,e]),this.data.height=t.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,r){for(var n,o,i,a=void 0,s=1/0,u=1/0,c=e;c<=r-e;c++){var l=y(t,0,c,this.toBBox),f=y(t,c,r,this.toBBox),h=(n=l,h=f,p=i=o=void 0,o=Math.max(n.minX,h.minX),i=Math.max(n.minY,h.minY),p=Math.min(n.maxX,h.maxX),n=Math.min(n.maxY,h.maxY),Math.max(0,p-o)*Math.max(0,n-i)),p=Y(l)+Y(f);h<s?(s=h,a=c,u=p<u?p:u):h===s&&p<u&&(u=p,a=c)}return a||r-e},n.prototype._chooseSplitAxis=function(t,e,r){var n=t.leaf?this.compareMinX:B,o=t.leaf?this.compareMinY:X;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,o)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,r,n){t.children.sort(n);for(var o=this.toBBox,i=y(t,0,e,o),a=y(t,r-e,r,o),s=_(i)+_(a),u=e;u<r-e;u++){var c=t.children[u];h(i,t.leaf?o(c):c),s+=_(i)}for(var l=r-e-1;e<=l;l--){var f=t.children[l];h(a,t.leaf?o(f):f),s+=_(a)}return s},n.prototype._adjustParentBBoxes=function(t,e,r){for(var n=r;0<=n;n--)h(e[n],t)},n.prototype._condense=function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():p(t[r],this.toBBox)};var t=n;function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:9,e=this,r=n;if(!(e instanceof r))throw new TypeError("Cannot call a class as a function");this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}function p(t,e){y(t,0,t.children.length,e,t)}function y(t,e,r,n,o){(o=o||v(null)).minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i=e;i<r;i++){var a=t.children[i];h(o,t.leaf?n(a):a)}return o}function h(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function B(t,e){return t.minX-e.minX}function X(t,e){return t.minY-e.minY}function Y(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function _(t){return t.maxX-t.minX+(t.maxY-t.minY)}function I(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function u(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function v(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function N(t,e,r,n,o){for(var i,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(G(t,i=e+Math.ceil((r-e)/n/2)*n,e,r,o),a.push(e,i,i,r))}var e=Object.freeze({default:t}),z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=6371008.8,D={centimeters:100*r,centimetres:100*r,degrees:r/111325,feet:3.28084*r,inches:39.37*r,kilometers:r/1e3,kilometres:r/1e3,meters:r,metres:r,miles:r/1609.344,millimeters:1e3*r,millimetres:1e3*r,nauticalmiles:r/1852,radians:1,yards:1.0936*r},$={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function l(t,e,r){var n={type:"Feature"};return 0!==(r=void 0===r?{}:r).id&&!r.id||(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function c(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(i(t[0])&&i(t[1]))return l({type:"Point",coordinates:t},e,r);throw new Error("coordinates must contain numbers")}function R(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return l({type:"Polygon",coordinates:t},e,r)}function m(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return l({type:"LineString",coordinates:t},e,r)}function o(t,e){var r={type:"FeatureCollection"};return(e=void 0===e?{}:e).id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function q(t,e,r){return l({type:"MultiLineString",coordinates:t},e,r=void 0===r?{}:r)}function U(t,e,r){return l({type:"MultiPoint",coordinates:t},e,r=void 0===r?{}:r)}function J(t,e,r){return l({type:"MultiPolygon",coordinates:t},e,r=void 0===r?{}:r)}function V(t,e){var r=D[e=void 0===e?"kilometers":e];if(r)return t*r;throw new Error(e+" units is invalid")}function W(t,e){var r=D[e=void 0===e?"kilometers":e];if(r)return t/r;throw new Error(e+" units is invalid")}function K(t){return 180*(t%(2*Math.PI))/Math.PI}function i(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function H(t){return!!t&&t.constructor===Object}r=Object.freeze({earthRadius:r,factors:D,unitsFactors:{centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/r,yards:1.0936133},areaFactors:$,feature:l,geometry:function(t,e,r){switch(void 0===r&&(r={}),t){case"Point":return c(e).geometry;case"LineString":return m(e).geometry;case"Polygon":return R(e).geometry;case"MultiPoint":return U(e).geometry;case"MultiLineString":return q(e).geometry;case"MultiPolygon":return J(e).geometry;default:throw new Error(t+" is invalid")}},point:c,points:function(t,e,r){return void 0===r&&(r={}),o(t.map(function(t){return c(t,e)}),r)},polygon:R,polygons:function(t,e,r){return void 0===r&&(r={}),o(t.map(function(t){return R(t,e)}),r)},lineString:m,lineStrings:function(t,e,r){return void 0===r&&(r={}),o(t.map(function(t){return m(t,e)}),r)},featureCollection:o,multiLineString:q,multiPoint:U,multiPolygon:J,geometryCollection:function(t,e,r){return l({type:"GeometryCollection",geometries:t},e,r=void 0===r?{}:r)},round:function(t,e){if(!(e=void 0===e?0:e)||0<=e)return e=Math.pow(10,e||0),Math.round(t*e)/e;throw new Error("precision must be a positive number")},radiansToLength:V,lengthToRadians:W,lengthToDegrees:function(t,e){return K(W(t,e))},bearingToAzimuth:function(t){return(t%=360)<0&&(t+=360),t},radiansToDegrees:K,degreesToRadians:function(t){return t%360*Math.PI/180},convertLength:function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),0<=t)return V(W(t,e),r);throw new Error("length must be a positive number")},convertArea:function(t,e,r){if(void 0===e&&(e="meters"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("area must be a positive number");if(!(e=$[e]))throw new Error("invalid original units");if(r=$[r])return t/e*r;throw new Error("invalid final units")},isNumber:i,isObject:H,validateBBox:function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!i(t))throw new Error("bbox must only contain numbers")})},validateId:function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(void 0===t?"undefined":z(t)))throw new Error("id must be a number or a string")}});function j(t,e,r){if(null!==t)for(var n,o,i,a=0,s=t.type,u="FeatureCollection"===s,c="Feature"===s,l=u?t.features.length:1,f=0;f<l;f++)for(var h,p,d=(p=!!(h=u?t.features[f].geometry:c?t.geometry:t)&&"GeometryCollection"===h.type)?h.geometries.length:1,y=0;y<d;y++){var _=0,v=0,m=p?h.geometries[y]:h;if(null!==m){var g=m.coordinates,b=m.type,w=!r||"Polygon"!==b&&"MultiPolygon"!==b?0:1;switch(b){case null:break;case"Point":if(!1===e(g,a,f,_,v))return!1;a++,_++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(!1===e(g[n],a,f,_,v))return!1;a++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(o=0;o<g[n].length-w;o++){if(!1===e(g[n][o],a,f,_,v))return!1;a++}"MultiLineString"===b&&_++,"Polygon"===b&&v++}"Polygon"===b&&_++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(o=v=0;o<g[n].length;o++){for(i=0;i<g[n][o].length-w;i++){if(!1===e(g[n][o][i],a,f,_,v))return!1;a++}v++}_++}break;case"GeometryCollection":for(n=0;n<m.geometries.length;n++)if(!1===j(m.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}function Q(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function Z(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function tt(t,e){for(var r,n,o,i,a,s,u,c,l,f=0,h="FeatureCollection"===t.type,p="Feature"===t.type,d=h?t.features.length:1,y=0;y<d;y++){for(a=h?t.features[y].geometry:p?t.geometry:t,u=h?t.features[y].properties:p?t.properties:{},c=h?t.features[y].bbox:p?t.bbox:void 0,l=h?t.features[y].id:p?t.id:void 0,i=(s=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<i;n++)if(null===(o=s?a.geometries[n]:a)){if(!1===e(null,f,u,c,l))return!1}else switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,f,u,c,l))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],f,u,c,l))return!1;break;default:throw new Error("Unknown Geometry Type")}f++}}function f(t,c){tt(t,function(t,e,r,n,o){var i,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1===c(l(t,r,{bbox:n,id:o}),e,0)?!1:void 0}switch(a){case"MultiPoint":i="Point";break;case"MultiLineString":i="LineString";break;case"MultiPolygon":i="Polygon"}for(var s=0;s<t.coordinates.length;s++){var u=t.coordinates[s];if(!1===c(l({type:i,coordinates:u},r),e,s))return!1}})}function et(t,p){f(t,function(i,a,s){var u=0;if(i.geometry){var c,l,f,h,t=i.geometry.type;if("Point"!==t&&"MultiPoint"!==t)return h=f=l=0,!1!==j(i,function(t,e,r,n,o){return void 0===c||l<a||f<n||h<o?(c=t,l=a,f=n,h=o,void(u=0)):(n=m([c,t],i.properties),!1!==p(n,a,s,o,u)&&(u++,void(c=t)))})&&void 0}})}function rt(t,a){if(!t)throw new Error("geojson is required");f(t,function(t,e,r){if(null!==t.geometry){var n=t.geometry.type,o=t.geometry.coordinates;switch(n){case"LineString":if(!1===a(t,e,r,0,0))return!1;break;case"Polygon":for(var i=0;i<o.length;i++)if(!1===a(m(o[i],t.properties),e,r,i))return!1}}})}var nt=Object.freeze({coordAll:function(t){var e=[];return j(t,function(t){e.push(t)}),e},coordEach:j,coordReduce:function(t,i,a,e){var s=a;return j(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)},e),s},featureEach:Z,featureReduce:function(t,r,n){var o=n;return Z(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},findPoint:function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return c(u,s,e);case"MultiPoint":return c(u[o=o<0?u.length+o:o],s,e);case"LineString":return c(u[a=a<0?u.length+a:a],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),c(u[i][a],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a),c(u[o][a],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a),c(u[o][i][a],s,e)}throw new Error("geojson is invalid")},findSegment:function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return m([u[a=a<0?u.length+a-1:a],u[a+1]],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a-1),m([u[i][a],u[i][a+1]],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a-1),m([u[o][a],u[o][a+1]],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a-1),m([u[o][i][a],u[o][i][a+1]],s,e)}throw new Error("geojson is invalid")},flattenEach:f,flattenReduce:function(t,n,o){var i=o;return f(t,function(t,e,r){i=0===e&&0===r&&void 0===o?t:n(i,t,e,r)}),i},geomEach:tt,geomReduce:function(t,i,a){var s=a;return tt(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)}),s},lineEach:rt,lineReduce:function(t,o,i){var a=i;return rt(t,function(t,e,r,n){a=0===e&&void 0===i?t:o(a,t,e,r,n)}),a},propEach:Q,propReduce:function(t,r,n){var o=n;return Q(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},segmentEach:et,segmentReduce:function(t,i,a){var s=a,u=!1;return et(t,function(t,e,r,n,o){s=!1===u&&void 0===a?t:i(s,t,e,r,n,o),u=!0}),s}});function a(t){var e=[1/0,1/0,-1/0,-1/0];return j(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}a.default=a;var g=Object.freeze({default:a}),b=e&&t,w=(g&&a).default,ot=nt.featureEach,it=r.featureCollection;function at(t){t=new b(t);return t.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox||w(t),b.prototype.insert.call(this,t)},t.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox||w(t),e.push(t)}):ot(t,function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox||w(t),e.push(t)}),b.prototype.load.call(this,e)},t.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox||w(t),b.prototype.remove.call(this,t,e)},t.clear=function(){return b.prototype.clear.call(this)},t.search=function(t){t=b.prototype.search.call(this,this.toBBox(t));return it(t)},t.collides=function(t){return b.prototype.collides.call(this,this.toBBox(t))},t.all=function(){var t=b.prototype.all.call(this);return it(t)},t.toJSON=function(){return b.prototype.toJSON.call(this)},t.fromJSON=function(t){return b.prototype.fromJSON.call(this,t)},t.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=w(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=w(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},t}var st=at,ne=(st.default=at,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});function ut(t,e){return t(e={exports:{}},e.exports),e.exports}var Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct=ut(function(t,e){var n="__lodash_hash_undefined__",B=1,V=2,S=9007199254740991,X="[object Arguments]",Y="[object Array]",P="[object AsyncFunction]",W="[object Boolean]",K="[object Date]",H="[object Error]",E="[object Function]",M="[object GeneratorFunction]",I="[object Map]",Q="[object Number]",A="[object Null]",N="[object Object]",O="[object Promise]",C="[object Proxy]",Z="[object RegExp]",z="[object Set]",tt="[object String]",et="[object Symbol]",k="[object Undefined]",r="[object WeakMap]",rt="[object ArrayBuffer]",D="[object DataView]",L=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,o={},i=(o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o[X]=o[Y]=o[rt]=o[W]=o[D]=o[K]=o[H]=o[E]=o[I]=o[Q]=o[N]=o[Z]=o[z]=o[tt]=o[r]=!1,"object"==Yt(ne)&&ne&&ne.Object===Object&&ne),a="object"==("undefined"==typeof self?"undefined":Yt(self))&&self&&self.Object===Object&&self,a=i||a||Function("return this")(),e=e&&!e.nodeType&&e,s=e&&t&&!t.nodeType&&t,s=s&&s.exports===e,u=s&&i.process,e=function(){try{return u&&u.binding&&u.binding("util")}catch(t){}}(),i=e&&e.isTypedArray;function nt(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function ot(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var G,F,e=Array.prototype,c=Function.prototype,l=Object.prototype,f=a["__core-js_shared__"],it=c.toString,$=l.hasOwnProperty,at=(c=/[^.]+$/.exec(f&&f.keys&&f.keys.IE_PROTO||""))?"Symbol(src)_1."+c:"",st=l.toString,ut=RegExp("^"+it.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),f=s?a.Buffer:void 0,c=a.Symbol,ct=a.Uint8Array,lt=l.propertyIsEnumerable,ft=e.splice,h=c?c.toStringTag:void 0,ht=Object.getOwnPropertySymbols,s=f?f.isBuffer:void 0,pt=(G=Object.keys,F=Object,function(t){return G(F(t))}),e=j(a,"DataView"),p=j(a,"Map"),f=j(a,"Promise"),dt=j(a,"Set"),a=j(a,"WeakMap"),d=j(Object,"create"),yt=x(e),_t=x(p),vt=x(f),mt=x(dt),gt=x(a),c=c?c.prototype:void 0,bt=c?c.valueOf:void 0;function y(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function _(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function v(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function m(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new v;++e<r;)this.add(t[e])}function R(t){t=this.__data__=new _(t);this.size=t.size}function wt(t,e){var r,n,o,i=U(t),a=!i&&Ct(t),s=!i&&!a&&kt(t),u=!i&&!a&&!s&&Bt(t),c=i||a||s||u,l=c?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],f=l.length;for(r in t)!e&&!$.call(t,r)||c&&("length"==r||s&&("offset"==r||"parent"==r)||u&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||(n=r,(o=null==(o=f)?S:o)&&("number"==typeof n||T.test(n))&&-1<n&&n%1==0&&n<o))||l.push(r);return l}function g(t,e){for(var r=t.length;r--;)if(Ot(t[r][0],e))return r;return-1}function b(t){{if(null==t)return void 0===t?k:A;if(h&&h in Object(t)){var e=t,r=$.call(e,h),n=e[h];try{var o=!(e[h]=void 0)}catch(t){}var i=st.call(e);return o&&(r?e[h]=n:delete e[h]),i}return st.call(t)}}function jt(t){return J(t)&&b(t)==X}function xt(t,e,r,n,o){{if(t===e)return!0;if(null==t||null==e||!J(t)&&!J(e))return t!=t&&e!=e;var i=xt,a=U(t),s=U(e),u=a?Y:q(t),s=s?Y:q(e),c=(u=u==X?N:u)==N,l=(s=s==X?N:s)==N,s;if((s=u==s)&&kt(t)){if(!kt(e))return!1;c=!(a=!0)}if(s&&!c){o=o||new R;if(a||Bt(t))return Et(t,e,r,n,i,o);else{var f=t;var h=e;var p=u;var d=r;var y=n;var _=i;var v=o;switch(p){case D:if(f.byteLength!=h.byteLength||f.byteOffset!=h.byteOffset)return!1;f=f.buffer,h=h.buffer;case rt:return f.byteLength==h.byteLength&&_(new ct(f),new ct(h))?!0:!1;case W:case K:case Q:return Ot(+f,+h);case H:return f.name==h.name&&f.message==h.message;case Z:case tt:return f==h+"";case I:var m=nt;case z:var g=d&B;if(m=m||ot,f.size!=h.size&&!g)return!1;g=v.get(f);if(g)return g==h;d|=V,v.set(f,h);g=Et(m(f),m(h),d,y,_,v);return v.delete(f),g;case et:if(bt)return bt.call(f)==bt.call(h)}return!1;return}}if(!(r&B)){var a=c&&$.call(t,"__wrapped__"),u=l&&$.call(e,"__wrapped__");if(a||u)return c=a?t.value():t,l=u?e.value():e,o=o||new R,i(c,l,r,n,o)}if(s){o=o||new R;var b=t,w=e,j=r,x=n,S=i,P=o,E=j&B,M=Mt(b),A=M.length,a=Mt(w).length;if(A!=a&&!E)return!1;for(var O=A;O--;){var C=M[O];if(!(E?C in w:$.call(w,C)))return!1}if((a=P.get(b))&&P.get(w))return a==w;for(var k=!0,L=(P.set(b,w),P.set(w,b),E);++O<A;){C=M[O];var T,G=b[C],F=w[C];if(!(void 0===(T=x?E?x(F,G,C,w,b,P):x(G,F,C,b,w,P):T)?G===F||S(G,F,j,x,P):T)){k=!1;break}L=L||"constructor"==C}return k&&!L&&(a=b.constructor,u=w.constructor,a!=u&&"constructor"in b&&"constructor"in w&&!("function"==typeof a&&a instanceof a&&"function"==typeof u&&u instanceof u)&&(k=!1)),P.delete(b),P.delete(w),k}return!1}}function St(t){var e;if(Gt(t)&&(e=t,!(at&&at in e)))return(Lt(t)?ut:L).test(x(t))}function Pt(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||l,e!==r)return pt(t);var e,r,n,o=[];for(n in Object(t))$.call(t,n)&&"constructor"!=n&&o.push(n);return o}function Et(t,e,r,n,o,i){var a=r&B,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;u=i.get(t);if(u&&i.get(e))return u==e;var c=-1,l=!0,f=r&V?new m:void 0;for(i.set(t,e),i.set(e,t);++c<s;){var h,p=t[c],d=e[c];if(void 0!==(h=n?a?n(d,p,c,e,t,i):n(p,d,c,t,e,i):h)){if(h)continue;l=!1;break}if(f){if(!function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return!f.has(e)&&(p===t||o(p,t,r,n,i))&&f.push(e)})){l=!1;break}}else if(p!==d&&!o(p,d,r,n,i)){l=!1;break}}return i.delete(t),i.delete(e),l}function Mt(t){var e=Xt,r=At;if(e=e(t),U(t))return e;for(var n=e,o=r(t),i=-1,a=o.length,s=n.length;++i<a;)n[s+i]=o[i];return n}function w(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":Yt(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function j(t,e){e=e;t=null==(t=t)?void 0:t[e];return St(t)?t:void 0}y.prototype.clear=function(){this.__data__=d?d(null):{},this.size=0},y.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},y.prototype.get=function(t){var e,r=this.__data__;return d?(e=r[t])===n?void 0:e:$.call(r,t)?r[t]:void 0},y.prototype.has=function(t){var e=this.__data__;return d?void 0!==e[t]:$.call(e,t)},y.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=d&&void 0===e?n:e,this},_.prototype.clear=function(){this.__data__=[],this.size=0},_.prototype.delete=function(t){var e=this.__data__;return!((t=g(e,t))<0)&&(t==e.length-1?e.pop():ft.call(e,t,1),--this.size,!0)},_.prototype.get=function(t){var e=this.__data__;return(t=g(e,t))<0?void 0:e[t][1]},_.prototype.has=function(t){return-1<g(this.__data__,t)},_.prototype.set=function(t,e){var r=this.__data__,n=g(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},v.prototype.clear=function(){this.size=0,this.__data__={hash:new y,map:new(p||_),string:new y}},v.prototype.delete=function(t){return t=w(this,t).delete(t),this.size-=t?1:0,t},v.prototype.get=function(t){return w(this,t).get(t)},v.prototype.has=function(t){return w(this,t).has(t)},v.prototype.set=function(t,e){var r=w(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},m.prototype.add=m.prototype.push=function(t){return this.__data__.set(t,n),this},m.prototype.has=function(t){return this.__data__.has(t)},R.prototype.clear=function(){this.__data__=new _,this.size=0},R.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},R.prototype.get=function(t){return this.__data__.get(t)},R.prototype.has=function(t){return this.__data__.has(t)},R.prototype.set=function(t,e){var r=this.__data__;if(r instanceof _){var n=r.__data__;if(!p||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new v(n)}return r.set(t,e),this.size=r.size,this};var At=ht?function(e){if(null==e)return[];e=Object(e);for(var t=ht(e),r=function(t){return lt.call(e,t)},n=-1,o=null==t?0:t.length,i=0,a=[];++n<o;){var s=t[n];r(s,n,t)&&(a[i++]=s)}return a}:function(){return[]},q=b;function x(t){if(null!=t){try{return it.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ot(t,e){return t===e||t!=t&&e!=e}(e&&q(new e(new ArrayBuffer(1)))!=D||p&&q(new p)!=I||f&&q(f.resolve())!=O||dt&&q(new dt)!=z||a&&q(new a)!=r)&&(q=function(t){var e=b(t),t=e==N?t.constructor:void 0,t=t?x(t):"";if(t)switch(t){case yt:return D;case _t:return I;case vt:return O;case mt:return z;case gt:return r}return e});var Ct=jt(function(){return arguments}())?jt:function(t){return J(t)&&$.call(t,"callee")&&!lt.call(t,"callee")},U=Array.isArray;var kt=s||function(){return!1};function Lt(t){if(Gt(t))return t=b(t),t==E||t==M||t==P||t==C}function Tt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=S}function Gt(t){var e=void 0===t?"undefined":Yt(t);return null!=t&&("object"==e||"function"==e)}function J(t){return null!=t&&"object"==(void 0===t?"undefined":Yt(t))}var Ft,Bt=i?(Ft=i,function(t){return Ft(t)}):function(t){return J(t)&&Tt(t.length)&&!!o[b(t)]};function Xt(t){return(null!=(e=t)&&Tt(e.length)&&!Lt(e)?wt:Pt)(t);var e}t.exports=function(t,e){return xt(t,e)}}),x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lt="__lodash_hash_undefined__",ft=9007199254740991,ht="[object Arguments]",pt="[object Function]",dt="[object GeneratorFunction]",yt=/^\[object .+?Constructor\]$/,e="object"==x(ne)&&ne&&ne.Object===Object&&ne,t="object"==("undefined"==typeof self?"undefined":x(self))&&self&&self.Object===Object&&self,g=e||t||Function("return this")();function _t(t,e){return!!(t?t.length:0)&&-1<function(t,e,r){if(e!=e)return function(t,e,r,n){var o=t.length,i=r+(n?1:-1);for(;n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,mt,r);var n=r-1,o=t.length;for(;++n<o;)if(t[n]===e)return n;return-1}(t,e,0)}function vt(t,e,r){for(var n=-1,o=t?t.length:0;++n<o;)if(r(e,t[n]))return!0;return!1}function mt(t){return t!=t}function gt(t,e){return t.has(e)}var nt=Array.prototype,r=Function.prototype,e=Object.prototype,t=g["__core-js_shared__"],bt=(t=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||""))?"Symbol(src)_1."+t:"",wt=r.toString,S=e.hasOwnProperty,jt=e.toString,xt=RegExp("^"+wt.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),t=g.Symbol,St=e.propertyIsEnumerable,Pt=nt.splice,Et=t?t.isConcatSpreadable:void 0,Mt=Math.max,At=Lt(g,"Map"),P=Lt(Object,"create");function E(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function M(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function A(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function O(t){var e=-1,r=t?t.length:0;for(this.__data__=new A;++e<r;)this.add(t[e])}function C(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}function Ot(t,e,r,n){var o,i=-1,a=_t,s=!0,u=t.length,c=[],l=e.length;if(!u)return c;r&&(e=function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(e,(o=r,function(t){return o(t)}))),n?(a=vt,s=!1):200<=e.length&&(a=gt,s=!1,e=new O(e));t:for(;++i<u;){var f=t[i],h=r?r(f):f,f=n||0!==f?f:0;if(s&&h==h){for(var p=l;p--;)if(e[p]===h)continue t;c.push(f)}else a(e,h,n)||c.push(f)}return c}function Ct(t){var e;if(zt(t)&&(e=t,!(bt&&bt in e)))return(Nt(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?xt:yt).test(function(t){if(null!=t){try{return wt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function kt(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":x(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function Lt(t,e){e=e;t=null==(t=t)?void 0:t[e];return Ct(t)?t:void 0}function Tt(t){return Bt(t)||It(e=t)&&S.call(e,"callee")&&(!St.call(e,"callee")||jt.call(e)==ht)||!!(Et&&t&&t[Et]);var e}E.prototype.clear=function(){this.__data__=P?P(null):{}},E.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},E.prototype.get=function(t){var e,r=this.__data__;return P?(e=r[t])===lt?void 0:e:S.call(r,t)?r[t]:void 0},E.prototype.has=function(t){var e=this.__data__;return P?void 0!==e[t]:S.call(e,t)},E.prototype.set=function(t,e){return this.__data__[t]=P&&void 0===e?lt:e,this},M.prototype.clear=function(){this.__data__=[]},M.prototype.delete=function(t){var e=this.__data__;return!((t=C(e,t))<0)&&(t==e.length-1?e.pop():Pt.call(e,t,1),!0)},M.prototype.get=function(t){var e=this.__data__;return(t=C(e,t))<0?void 0:e[t][1]},M.prototype.has=function(t){return-1<C(this.__data__,t)},M.prototype.set=function(t,e){var r=this.__data__,n=C(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},A.prototype.clear=function(){this.__data__={hash:new E,map:new(At||M),string:new E}},A.prototype.delete=function(t){return kt(this,t).delete(t)},A.prototype.get=function(t){return kt(this,t).get(t)},A.prototype.has=function(t){return kt(this,t).has(t)},A.prototype.set=function(t,e){return kt(this,t).set(t,e),this},O.prototype.add=O.prototype.push=function(t){return this.__data__.set(t,lt),this},O.prototype.has=function(t){return this.__data__.has(t)};function Gt(){for(var t=arguments,e=-1,r=Mt(t.length-k,0),n=Array(r);++e<r;)n[e]=t[k+e];for(var e=-1,o=Array(k+1);++e<k;)o[e]=t[e];o[k]=n;var i=Ft,a=this,s=o;switch(s.length){case 0:return i.call(a);case 1:return i.call(a,s[0]);case 2:return i.call(a,s[0],s[1]);case 3:return i.call(a,s[0],s[1],s[2])}return i.apply(a,s)}var Ft,k;Ft=function(t,e){var r,n=(r=(n=e)?n.length:0)?n[r-1]:void 0;return It(n)&&(n=void 0),It(t)?Ot(t,function t(e,r,n,o,i){var a=-1,s=e.length;for(n=n||Tt,i=i||[];++a<s;){var u=e[a];if(0<r&&n(u))if(1<r)t(u,r-1,n,o,i);else{p=h=f=l=c=void 0;for(var c=i,l=u,f=-1,h=l.length,p=c.length;++f<h;)c[p+f]=l[f]}else o||(i[i.length]=u)}return i}(e,1,It,!0),void 0,n):[]},k=Mt(void 0===k?Ft.length-1:k,0);var Bt=Array.isArray;function Xt(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=ft)&&!Nt(t);var e}function It(t){return!!(e=t)&&"object"==(void 0===e?"undefined":x(e))&&Xt(t);var e}function Nt(t){t=zt(t)?jt.call(t):"";return t==pt||t==dt}function zt(t){var e=void 0===t?"undefined":x(t);return t&&("object"==e||"function"==e)}var Dt=Gt,oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$t=ut(function(t,e){var x="__lodash_hash_undefined__",B=1,X=2,l=1/0,S=9007199254740991,P=17976931348623157e292,E=NaN,Y="[object Arguments]",W="[object Array]",K="[object Boolean]",H="[object Date]",Q="[object Error]",M="[object Function]",A="[object GeneratorFunction]",I="[object Map]",Z="[object Number]",N="[object Object]",O="[object Promise]",tt="[object RegExp]",z="[object Set]",et="[object String]",rt="[object Symbol]",C="[object WeakMap]",nt="[object ArrayBuffer]",D="[object DataView]",k=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,L=/^\w*$/,T=/^\./,G=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,F=/^\s+|\s+$/g,ot=/\\(\\)?/g,it=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,st=/^\[object .+?Constructor\]$/,ut=/^0o[0-7]+$/i,ct=/^(?:0|[1-9]\d*)$/,r={},lt=(r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r[Y]=r[W]=r[nt]=r[K]=r[D]=r[H]=r[Q]=r[M]=r[I]=r[Z]=r[N]=r[tt]=r[z]=r[et]=r[C]=!1,parseInt),n="object"==oe(ne)&&ne&&ne.Object===Object&&ne,o="object"==("undefined"==typeof self?"undefined":oe(self))&&self&&self.Object===Object&&self,o=n||o||Function("return this")(),e=e&&!e.nodeType&&e,i=e&&t&&!t.nodeType&&t,ft=i&&i.exports===e&&n.process,i=function(){try{return ft&&ft.binding("util")}catch(t){}}(),e=i&&i.isTypedArray;function ht(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function pt(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function dt(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var yt,_t,n=Array.prototype,i=Function.prototype,a=Object.prototype,s=o["__core-js_shared__"],vt=(s=/[^.]+$/.exec(s&&s.keys&&s.keys.IE_PROTO||""))?"Symbol(src)_1."+s:"",mt=i.toString,$=a.hasOwnProperty,u=a.toString,gt=RegExp("^"+mt.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),s=o.Symbol,bt=o.Uint8Array,wt=a.propertyIsEnumerable,jt=n.splice,xt=(yt=Object.keys,_t=Object,function(t){return yt(_t(t))}),St=Math.max,i=m(o,"DataView"),c=m(o,"Map"),n=m(o,"Promise"),Pt=m(o,"Set"),o=m(o,"WeakMap"),f=m(Object,"create"),Et=w(i),Mt=w(c),At=w(n),Ot=w(Pt),Ct=w(o),s=s?s.prototype:void 0,kt=s?s.valueOf:void 0,Lt=s?s.toString:void 0;function h(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function p(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function d(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function y(t){var e=-1,r=t?t.length:0;for(this.__data__=new d;++e<r;)this.add(t[e])}function R(t){this.__data__=new p(t)}function Tt(t,e){var r,n=U(t)||Vt(t)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],o=n.length,i=!!o;for(r in t)!e&&!$.call(t,r)||i&&("length"==r||Dt(r,o))||n.push(r);return n}function _(t,e){for(var r=t.length;r--;)if(Jt(t[r][0],e))return r;return-1}function Gt(t,e){for(var r=0,n=(e=g(e,t)?[e]:Nt(e)).length;null!=t&&r<n;)t=t[b(e[r++])];return r&&r==n?t:void 0}function Ft(t,e){return null!=t&&e in Object(t)}function Bt(t,e,r,n,o){{if(t===e)return!0;if(null==t||null==e||!J(t)&&!V(e))return t!=t&&e!=e;var i=Bt,a=U(t),s=U(e),u=W,c=W,s=(a||(u=(u=q(t))==Y?N:u),s||(c=(c=q(e))==Y?N:c),u==N&&!ht(t)),l=c==N&&!ht(e),c;if((c=u==c)&&!s){o=o||new R;if(a||Zt(t))return zt(t,e,i,r,n,o);else{var f=t;var h=e;var p=u;var d=i;var y=r;var _=n;var v=o;switch(p){case D:if(f.byteLength!=h.byteLength||f.byteOffset!=h.byteOffset)return!1;f=f.buffer,h=h.buffer;case nt:return f.byteLength==h.byteLength&&d(new bt(f),new bt(h))?!0:!1;case K:case H:case Z:return Jt(+f,+h);case Q:return f.name==h.name&&f.message==h.message;case tt:case et:return f==h+"";case I:var m=pt;case z:var g=_&X;if(m=m||dt,f.size!=h.size&&!g)return!1;g=v.get(f);if(g)return g==h;_|=B,v.set(f,h);g=zt(m(f),m(h),d,y,_,v);return v.delete(f),g;case rt:if(kt)return kt.call(f)==kt.call(h)}return!1;return}}if(!(n&X)){var a=s&&$.call(t,"__wrapped__"),u=l&&$.call(e,"__wrapped__");if(a||u)return s=a?t.value():t,l=u?e.value():e,o=o||new R,i(s,l,r,n,o)}if(c){o=o||new R;var b=t,w=e,j=i,x=r,S=n,P=o,E=S&X,M=ee(b),A=M.length,a=ee(w).length;if(A!=a&&!E)return!1;for(var O=A;O--;){var C=M[O];if(!(E?C in w:$.call(w,C)))return!1}if((a=P.get(b))&&P.get(w))return a==w;for(var k=!0,L=(P.set(b,w),P.set(w,b),E);++O<A;){C=M[O];var T,G=b[C],F=w[C];if(!(void 0===(T=x?E?x(F,G,C,w,b,P):x(G,F,C,b,w,P):T)?G===F||j(G,F,x,S,P):T)){k=!1;break}L=L||"constructor"==C}return k&&!L&&(a=b.constructor,u=w.constructor,a!=u&&"constructor"in b&&"constructor"in w&&!("function"==typeof a&&a instanceof a&&"function"==typeof u&&u instanceof u)&&(k=!1)),P.delete(b),P.delete(w),k}return!1}}function Xt(t){var e;if(J(t)&&(e=t,!(vt&&vt in e)))return(Kt(t)||ht(t)?gt:st).test(w(t))}function Yt(t){if("function"==typeof t)return t;if(null==t)return re;if("object"==(void 0===t?"undefined":oe(t)))if(U(t)){var n=t[0],o=t[1];return g(n)&&$t(o)?Rt(b(n),o):function(t){var e,r=function(t,e,r){t=null==t?void 0:Gt(t,e);return void 0===t?r:t}(t,n);return void 0===r&&r===o?(e=n,null!=(t=t)&&function(t,e,r){e=g(e,t)?[e]:Nt(e);var n,o=-1,i=e.length;for(;++o<i;){var a=b(e[o]);if(!(n=null!=t&&r(t,a)))break;t=t[a]}if(n)return n;return!!(i=t?t.length:0)&&Ht(i)&&Dt(a,i)&&(U(t)||Vt(t))}(t,e,Ft)):Bt(o,r,void 0,B|X)}}else{var e=t,r=function(t){var e=ee(t),r=e.length;for(;r--;){var n=e[r],o=t[n];e[r]=[n,o,$t(o)]}return e}(e);return 1==r.length&&r[0][2]?Rt(r[0][0],r[0][1]):function(t){return t===e||function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var s=r[o];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++o<i;){var u=(s=r[o])[0],c=t[u],l=s[1];if(a&&s[2]){if(void 0===c&&!(u in t))return!1}else{var f,h=new R;if(!(void 0===(f=n?n(c,l,u,t,e,h):f)?Bt(l,c,n,B|X,h):f))return!1}}return!0}(t,e,r)}}var i,a;return g(t=t)?(i=b(t),function(t){return null==t?void 0:t[i]}):(a=t,function(t){return Gt(t,a)})}function It(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||a,e!==r)return xt(t);var e,r,n,o=[];for(n in Object(t))$.call(t,n)&&"constructor"!=n&&o.push(n);return o}function Nt(t){return U(t)?t:qt(t)}function zt(t,e,r,n,o,i){var a=o&X,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;u=i.get(t);if(u&&i.get(e))return u==e;var c=-1,l=!0,f=o&B?new y:void 0;for(i.set(t,e),i.set(e,t);++c<s;){var h,p=t[c],d=e[c];if(void 0!==(h=n?a?n(d,p,c,e,t,i):n(p,d,c,t,e,i):h)){if(h)continue;l=!1;break}if(f){if(!function(t,e){for(var r=-1,n=t?t.length:0;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return!f.has(e)&&(p===t||r(p,t,n,o,i))&&f.add(e)})){l=!1;break}}else if(p!==d&&!r(p,d,n,o,i)){l=!1;break}}return i.delete(t),i.delete(e),l}function v(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":oe(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function m(t,e){e=e;t=null==(t=t)?void 0:t[e];return Xt(t)?t:void 0}h.prototype.clear=function(){this.__data__=f?f(null):{}},h.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},h.prototype.get=function(t){var e,r=this.__data__;return f?(e=r[t])===x?void 0:e:$.call(r,t)?r[t]:void 0},h.prototype.has=function(t){var e=this.__data__;return f?void 0!==e[t]:$.call(e,t)},h.prototype.set=function(t,e){return this.__data__[t]=f&&void 0===e?x:e,this},p.prototype.clear=function(){this.__data__=[]},p.prototype.delete=function(t){var e=this.__data__;return!((t=_(e,t))<0)&&(t==e.length-1?e.pop():jt.call(e,t,1),!0)},p.prototype.get=function(t){var e=this.__data__;return(t=_(e,t))<0?void 0:e[t][1]},p.prototype.has=function(t){return-1<_(this.__data__,t)},p.prototype.set=function(t,e){var r=this.__data__,n=_(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},d.prototype.clear=function(){this.__data__={hash:new h,map:new(c||p),string:new h}},d.prototype.delete=function(t){return v(this,t).delete(t)},d.prototype.get=function(t){return v(this,t).get(t)},d.prototype.has=function(t){return v(this,t).has(t)},d.prototype.set=function(t,e){return v(this,t).set(t,e),this},y.prototype.add=y.prototype.push=function(t){return this.__data__.set(t,x),this},y.prototype.has=function(t){return this.__data__.has(t)},R.prototype.clear=function(){this.__data__=new p},R.prototype.delete=function(t){return this.__data__.delete(t)},R.prototype.get=function(t){return this.__data__.get(t)},R.prototype.has=function(t){return this.__data__.has(t)},R.prototype.set=function(t,e){var r=this.__data__;if(r instanceof p){var n=r.__data__;if(!c||n.length<199)return n.push([t,e]),this;r=this.__data__=new d(n)}return r.set(t,e),this};var q=function(t){return u.call(t)};function Dt(t,e){return!!(e=null==e?S:e)&&("number"==typeof t||ct.test(t))&&-1<t&&t%1==0&&t<e}function g(t,e){var r;if(!U(t))return r=void 0===t?"undefined":oe(t),"number"==r||"symbol"==r||"boolean"==r||null==t||j(t)||(L.test(t)||!k.test(t)||null!=e&&t in Object(e))}function $t(t){return t==t&&!J(t)}function Rt(e,r){return function(t){return null!=t&&(t[e]===r&&(void 0!==r||e in Object(t)))}}(i&&q(new i(new ArrayBuffer(1)))!=D||c&&q(new c)!=I||n&&q(n.resolve())!=O||Pt&&q(new Pt)!=z||o&&q(new o)!=C)&&(q=function(t){var e=u.call(t),t=e==N?t.constructor:void 0,t=t?w(t):void 0;if(t)switch(t){case Et:return D;case Mt:return I;case At:return O;case Ot:return z;case Ct:return C}return e});var qt=Ut(function(t){t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(j(t))return Lt?Lt.call(t):"";var e=t+"";return"0"==e&&1/t==-l?"-0":e}(e);var e,o=[];return T.test(t)&&o.push(""),t.replace(G,function(t,e,r,n){o.push(r?n.replace(ot,"$1"):e||t)}),o});function b(t){if("string"==typeof t||j(t))return t;var e=t+"";return"0"==e&&1/t==-l?"-0":e}function w(t){if(null!=t){try{return mt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ut(n,o){if("function"!=typeof n||o&&"function"!=typeof o)throw new TypeError("Expected a function");function i(){var t=arguments,e=o?o.apply(this,t):t[0],r=i.cache;return r.has(e)?r.get(e):(t=n.apply(this,t),i.cache=r.set(e,t),t)}return i.cache=new(Ut.Cache||d),i}function Jt(t,e){return t===e||t!=t&&e!=e}function Vt(t){return V(e=t)&&Wt(e)&&$.call(t,"callee")&&(!wt.call(t,"callee")||u.call(t)==Y);var e}Ut.Cache=d;var U=Array.isArray;function Wt(t){return null!=t&&Ht(t.length)&&!Kt(t)}function Kt(t){t=J(t)?u.call(t):"";return t==M||t==A}function Ht(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=S}function J(t){var e=void 0===t?"undefined":oe(t);return t&&("object"==e||"function"==e)}function V(t){return!!t&&"object"==(void 0===t?"undefined":oe(t))}function j(t){return"symbol"==(void 0===t?"undefined":oe(t))||V(t)&&u.call(t)==rt}var Qt,Zt=e?(Qt=e,function(t){return Qt(t)}):function(t){return V(t)&&Ht(t.length)&&!!r[u.call(t)]};function te(t){if("number"==typeof t)return t;if(j(t))return E;if("string"!=typeof(t=J(t)?J(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=t.replace(F,"");var e=at.test(t);return e||ut.test(t)?lt(t.slice(2),e?2:8):it.test(t)?E:+t}function ee(t){return(Wt(t)?Tt:It)(t)}function re(t){return t}t.exports=function(t,e,r){var n=t?t.length:0;if(!n)return-1;for(var o=null==r?0:(r=function(t){return t?(t=te(t))!==l&&t!==-l?t==t?t:0:(t<0?-1:1)*P:0===t?t:0}(r=r),o=r%1,r==r?o?r-o:r:0),i=(o<0&&(o=St(n+o,0)),t),a=Yt(e),r=o,s=void 0,u=i.length,c=r+(s?1:-1);s?c--:++c<u;)if(a(i[c],c,i))return c;return-1}}),Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt=1/0,Ut=9007199254740991,Jt=17976931348623157e292,Vt=NaN,Wt="[object Arguments]",Kt="[object Function]",Ht="[object GeneratorFunction]",Qt="[object String]",Zt="[object Symbol]",te=/^\s+|\s+$/g,ee=/^[-+]0x[0-9a-f]+$/i,re=/^0b[01]+$/i,ie=/^0o[0-7]+$/i,ae=/^(?:0|[1-9]\d*)$/,se=parseInt;function ue(t){return t!=t}function ce(e,t){for(var r=t,n=function(t){return e[t]},o=-1,i=r?r.length:0,a=Array(i);++o<i;)a[o]=n(r[o],o,r);return a}var le,fe,he=Object.prototype,pe=he.hasOwnProperty,de=he.toString,ye=he.propertyIsEnumerable,_e=(le=Object.keys,fe=Object,function(t){return le(fe(t))}),ve=Math.max;function me(t,e){var r,n,o,i,a=be(t)||function(t){return xe(t)&&we(t)}(r=t)&&pe.call(r,"callee")&&(!ye.call(r,"callee")||de.call(r)==Wt)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=a.length,u=!!s;for(n in t)!e&&!pe.call(t,n)||u&&("length"==n||(o=n,(i=null==(i=s)?Ut:i)&&("number"==typeof o||ae.test(o))&&-1<o&&o%1==0&&o<i))||a.push(n);return a}function ge(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||he,e!==r)return _e(t);var e,r,n,o=[];for(n in Object(t))pe.call(t,n)&&"constructor"!=n&&o.push(n);return o}var be=Array.isArray;function we(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=Ut)&&!function(t){t=je(t)?de.call(t):"";return t==Kt||t==Ht}(t);var e}function je(t){var e=void 0===t?"undefined":Rt(t);return t&&("object"==e||"function"==e)}function xe(t){return!!t&&"object"==(void 0===t?"undefined":Rt(t))}function Se(t){if("number"==typeof t)return t;if("symbol"==(void 0===(e=t)?"undefined":Rt(e))||xe(e)&&de.call(e)==Zt)return Vt;if("string"!=typeof(t=je(t)?je(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=t.replace(te,"");var e=re.test(t);return e||ie.test(t)?se(t.slice(2),e?2:8):ee.test(t)?Vt:+t}var Pe=function(t,e,r,n){t=we(t)?t:(o=t)?ce(o,function(t){return(we(t)?me:ge)(t)}(o)):[],r=r&&!n?(o=function(t){return t?(t=Se(t))!==qt&&t!==-qt?t==t?t:0:(t<0?-1:1)*Jt:0===t?t:0}(o=r),n=o%1,o==o?n?o-n:o:0):0;var o,i,n=t.length;return r<0&&(r=ve(n+r,0)),"string"==typeof(i=t)||!be(i)&&xe(i)&&de.call(i)==Qt?r<=n&&-1<t.indexOf(e,r):!!n&&-1<function(t,e,r){if(e!=e){for(var n=t,o=ue,i=r,a=void 0,s=n.length,u=i+(a?1:-1);a?u--:++u<s;)if(o(n[u],u,n))return u;return-1}for(var c=r-1,l=t.length;++c<l;)if(t[c]===e)return c;return-1}(t,e,r)},Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me=9007199254740991,Ae="[object Arguments]",Oe="[object Function]",Ce="[object GeneratorFunction]",r="object"==Ee(ne)&&ne&&ne.Object===Object&&ne,e="object"==("undefined"==typeof self?"undefined":Ee(self))&&self&&self.Object===Object&&self,nt=r||e||Function("return this")();var t=Object.prototype,ke=t.hasOwnProperty,Le=t.toString,g=nt.Symbol,Te=t.propertyIsEnumerable,Ge=g?g.isConcatSpreadable:void 0;function Fe(t){return Be(t)||function(t){return function(t){return!!t&&"object"==(void 0===t?"undefined":Ee(t))}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=Me}(t.length)&&!function(t){t=function(t){var e=void 0===t?"undefined":Ee(t);return t&&("object"==e||"function"==e)}(t)?Le.call(t):"";return t==Oe||t==Ce}(t)}(t)}(e=t)&&ke.call(e,"callee")&&(!Te.call(e,"callee")||Le.call(e)==Ae)||!!(Ge&&t&&t[Ge]);var e}var Be=Array.isArray;var Xe=function(t){return(t?t.length:0)?function t(e,r,n,o,i){var a=-1,s=e.length;for(n=n||Fe,i=i||[];++a<s;){var u=e[a];if(0<r&&n(u))if(1<r)t(u,r-1,n,o,i);else{p=h=f=l=c=void 0;for(var c=i,l=u,f=-1,h=l.length,p=c.length;++f<h;)c[p+f]=l[f]}else o||(i[i.length]=u)}return i}(t,1/0):[]};function Ye(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);if(t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e)if(Object.setPrototypeOf)Object.setPrototypeOf(t,e);else for(var r=t,n=e,o=Object.getOwnPropertyNames(n),i=0;i<o.length;i++){var a=o[i],s=Object.getOwnPropertyDescriptor(n,a);s&&s.configurable&&void 0===r[a]&&Object.defineProperty(r,a,s)}}var Ie,Ne={mode:"auto",distance:10,needCtrl:!1},r=(Ye(L,Ie=s.Class),L.prototype.setLayer=function(t){var e;return t instanceof s.VectorLayer&&(e=t.map,this._addTo(e),this.adsorblayer=t,this.adsorblayer.on("addgeo",this._updateGeosSet,this),this.adsorblayer.on("clear",this._resetGeosSet,this),this.bindDrawTool(e._map_tool)),this},L.prototype.bindDrawTool=function(t){return t instanceof s.DrawTool&&((this.drawTool=t).on("enable",this.enable,this),t.on("disable",this.disable,this),t.on("remove",this.remove,this),t.isEnabled()&&this.enable()),this},L.prototype.setGeometry=function(t){var e,r;return t instanceof s.Geometry&&((r=(e=t._layer).map)._map_tool&&r._map_tool instanceof s.DrawTool&&r._map_tool.disable(),this._addTo(r),this.adsorblayer=e,this._bindGeometry(t)),this},L.prototype.enable=function(){return this._isEnable=!0,this._updateGeosSet(),this._registerMapEvents(),this.drawTool&&this._registerDrawToolEvents(),this.geometry&&this._registerGeometryEvents(),this._mousemoveLayer&&this._mousemoveLayer.show(),this},L.prototype.disable=function(){return this._isEnable=!1,this._offMapEvents(),this._offDrawToolEvents(),this._offGeometryEvents(),this._resetGeosSet(),delete this._mousemove,delete this._mousedown,delete this._mouseup,this._mousemoveLayer&&this._mousemoveLayer.hide(),this},L.prototype.isEnable=function(){return this._isEnable},L.prototype.toggleEnable=function(){return this._isEnable?this.disable():this.enable()},L.prototype.remove=function(){this.disable();var t=map.getLayer(this._layerName);t&&t.remove(),delete this.adsorblayer,delete this.drawTool,delete this.geometry,delete this.geometryCoords,delete this.assistLayers},L.prototype.setMode=function(t){return this._updateModeType(t),this._updateGeosSet(),this},L.prototype.getMode=function(){return this._mode},L.prototype.setDistance=function(t){return this._updateDistance(t),this._updateGeosSet(),this},L.prototype.getDistance=function(){return this._distance},L.prototype.needCtrl=function(t){return this._updateNeedCtrl(t),this},L.prototype.setAssistGeosLayer=function(t){var r,n;return t?(r=this._map,t instanceof Array||(t=[t]),n=this.adsorblayer.getId(),0<(t=t.reduce(function(t,e){return e!==n&&r.getLayer(e)instanceof s.VectorLayer?[].concat(t,[e]):t},[])).length&&(this.assistLayers=t)):this.assistLayers=void 0,this._updateGeosSet(),this},L.prototype._updateModeType=function(t){this._mode=t||this.options.mode||Ne.mode},L.prototype._updateDistance=function(t){t=t||this.options.distance||Ne.distance,this._distance=Math.max(t,1)},L.prototype._updateNeedCtrl=function(t){t=void 0!==t?t:this.options.needCtrl,this._needCtrl=t=void 0!==t?t:Ne.needCtrl},L.prototype._addTo=function(t){return t.getLayer(this._layerName)&&this.remove(),this._mousemoveLayer=new s.VectorLayer(this._layerName).addTo(t).bringToFront(),this._map=t,this._resetGeosSet(),this},L.prototype._updateGeosSet=function(){var e=this,t=this._getGeosSet(),r="auto"===this._mode,n="vertux"===this._mode,o="border"===this._mode,i=[],a=[];t.forEach(function(t){(r||n)&&i.push.apply(i,e._parseToPoints(t)),(r||o)&&e._parseToLines(t).forEach(function(t){("Point"===t.geometry.type?i:a).push(t)})}),this._geosSetPoint=i,this._geosSetLine=a},L.prototype._getGeosSet=function(){var e=this.adsorblayer.getGeometries();return this.assistLayers&&this.assistLayers.forEach(function(t){return e.push.apply(e,map.getLayer(t).getGeometries())}),e},L.prototype._parseToPoints=function(t){var e=this;if(this._skipGeoSelf(t))return[];var r=[],t=t.getCoordinates();return t[0]instanceof Array?t.forEach(function(t){return r.push.apply(r,e._createMarkers(t))}):(t instanceof Array||(t=[t]),r.push.apply(r,this._createMarkers(t))),r},L.prototype._skipGeoSelf=function(t){var e;return!!this.geometry&&(t=t.toGeoJSON().geometry.coordinates,e=this.geometry.toGeoJSON().geometry.coordinates,ct(t,e))},L.prototype._createMarkers=function(t){return Xe(t).map(function(t){return new s.Marker(t,{properties:{}}).toGeoJSON()})},L.prototype._parseToLines=function(t){if(this._skipGeoSelf(t))return[];var e=[];return"Point"===t.type?e.push(t.setProperties({}).toGeoJSON()):e.push.apply(e,this._parsePolygonToLine(t)),e},L.prototype._parsePolygonToLine=function(e){var t,r=this,n=e.getCoordinates(),o=[];if(n instanceof Array)switch(e.type){case"MultiPolygon":n.forEach(function(t){return t.forEach(function(t){return o.push.apply(o,r._createLine(t,e))})});break;case"Polygon":n.forEach(function(t){return o.push.apply(o,r._createLine(t,e))});break;default:o.push.apply(o,this._createLine(n,e))}else"Polygon"===e.type&&((t=e.options).numberOfShellPoints=300,e.setOptions(t),n=e.getShell(),t.numberOfShellPoints=60,e.setOptions(t),o.push.apply(o,this._createMarkers(n)));return o},L.prototype._createLine=function(t,e){for(var r=[],n=0;n<t.length-1;n++){var o=[t[n],t[n+1]],o=new s.LineString(o,{properties:{obj:e}}).toGeoJSON();r.push(o)}return r},L.prototype._resetGeosSet=function(){this._geosSetPoint=[],this._geosSetLine=[]},L.prototype._bindGeometry=function(t){return t instanceof s.Geometry&&(this.geometry=t,this.geometryCoords=t.getCoordinates(),t.on("editstart",this.enable,this),t.on("editend",this.disable,this),t.on("remove",this.remove,this),t.isEditing()?(t.endEdit(),this.enable(),t.startEdit()):t.startEdit().endEdit()),this},L.prototype._registerMapEvents=function(){var t,e=this;this._mousemove||(t=this._map,this._mousemove=function(t){return e._mousemoveEvents(t)},this._mousedown=function(){e.drawTool&&(e._needFindGeometry=!1),e.geometry&&(e._needFindGeometry=!0)},this._mouseup=function(){e.drawTool&&(e._needFindGeometry=!0),e.geometry&&(e._needFindGeometry=!1)},t.on("mousemove touchstart",this._mousemove,this),t.on("mousedown",this._mousedown,this),t.on("mouseup",this._mouseup,this))},L.prototype._offMapEvents=function(){var t=this._map;this._mousemove&&t.off("mousemove touchstart",this._mousemove,this),this._mousedown&&t.off("mousedown",this._mousedown,this),this._mouseup&&t.off("mouseup",this._mouseup,this)},L.prototype._mousemoveEvents=function(t){var e=t.coordinate,t=t.domEvent;this._needDeal=!0,this._mousePoint=e,this._marker?this._marker.setCoordinates(e):this._marker=new s.Marker(e,{symbol:{}}).addTo(this._mousemoveLayer),this._updateAdsorbPoint(e),this._needCtrl!==t.ctrlKey&&(this._adsorbPoint=null)},L.prototype._updateAdsorbPoint=function(t){var e;this._needFindGeometry&&(t=this._findGeometry(t),this._adsorbPoint=t&&0<t.features.length?this._getAdsorbPoint(t):null,this._adsorbPoint&&(e=(t=this._adsorbPoint).x,t=t.y,this._marker.setCoordinates([e,t])))},L.prototype._findGeometry=function(t){if(!this._geosSetPoint&&!this._geosSetLine)return null;var e,r=[];return this._geosSetPoint&&(e=this._findAvailGeos(this._geosSetPoint,t),r.push.apply(r,e)),this._geosSetLine&&(e=this._findAvailGeos(this._geosSetLine,t),r.push.apply(r,e)),{type:"FeatureCollection",features:r}},L.prototype._findAvailGeos=function(t,e){this._tree.clear(),this._tree.load({type:"FeatureCollection",features:t});t=this._createInspectExtent(e);return this._tree.search(t).features},L.prototype._createInspectExtent=function(t){var e=Math.max(parseInt(this._distance,0),1),e=this._map.pixelToDistance(0,e);return new s.Circle(t,e,{properties:{}}).toGeoJSON()},L.prototype._getAdsorbPoint=function(t){t=this._findNearestFeatures(t.features);if(!t)return null;var e=t.geoObject,t=e.geometry,r=t.coordinates,t=t.type,n=r[0];switch(t){case"Point":return{x:n,y:r[1]};case"LineString":var o=this._setEquation(e),i=o.A,a=o.B,s=this._mousePoint,u=s.x,s=s.y;return 0===i?{x:u,y:n[1]}:i===1/0?{x:n[0],y:s}:(u=this._setVertiEquation(a/i),this._solveEquation(o,u));default:return null}},L.prototype._findNearestFeatures=function(t){t=this._setDistance(t);if(0===t.length)return null;var r;return t.sort((r="distance",function(t,e){return e[r]<t[r]}))[0]},L.prototype._setDistance=function(t){var o=this,i=-1===t.findIndex(function(t){return"Point"===t.geometry.type});return t.reduce(function(t,e,r){var n=void 0;switch(e.geometry.type){case"Point":n=o._distToPoint(e);break;case"LineString":i&&(n=o._distToPolyline(e))}return t=void 0!==n?[].concat(t,[{geoObject:e,distance:n}]):t},[])},L.prototype._distToPoint=function(t){var e=this._mousePoint,e=[e.x,e.y],t=t.geometry.coordinates;return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},L.prototype._distToPolyline=function(t){var e=this._mousePoint,r=e.x,e=e.y,t=this._setEquation(t),n=t.A,o=t.B,t=t.C;return Math.abs((n*r+o*e+t)/Math.sqrt(Math.pow(n,2)+Math.pow(o,2)))},L.prototype._setEquation=function(t){var t=t.geometry.coordinates,e=t[0],t=t[1],r=e[0],e=e[1],n=t[0],t=(e-t[1])/(r-n);return{A:t=t===-1/0?-t:t,B:-1,C:e-t*r}},L.prototype._setVertiEquation=function(t){var e=this._mousePoint,r=e.x;return{A:t,B:-1,C:e.y-t*r}},L.prototype._solveEquation=function(t,e){var r=t.A,n=t.B,t=t.C,o=e.A,i=e.B,e=e.C;return{x:(n*e-t*i)/(r*i-o*n),y:(r*e-o*t)/(n*o-i*r)}},L.prototype._registerDrawToolEvents=function(){var t=this.drawTool;t.on("drawstart",this._resetCoordsAndPoint,this),t.on("mousemove",this._resetCoordinates,this),t.on("drawvertex",this._resetCoordsAndPoint,this),t.on("drawend",this._resetCoordinates,this)},L.prototype._offDrawToolEvents=function(){var t;this.drawTool&&((t=this.drawTool).off("drawstart",this._resetCoordsAndPoint,this),t.off("mousemove",this._resetCoordinates,this),t.off("drawvertex",this._resetCoordsAndPoint,this),t.off("drawend",this._resetCoordinates,this))},L.prototype._registerGeometryEvents=function(){var t=this.geometry;t.on("shapechange",this._setEditCoordinates,this),t.on("editrecord",this._upGeoCoords,this)},L.prototype._offGeometryEvents=function(){var t;this.geometry&&((t=this.geometry).off("shapechange",this._setEditCoordinates,this),t.off("editrecord",this._upGeoCoords,this))},L.prototype._resetCoordsAndPoint=function(t){this._resetCoordinates(t),this._resetClickPoint(t)},L.prototype._resetCoordinates=function(t){var e,r,n,o,i;this._adsorbPoint&&(e=(t=t.target).options,t=t._geometry,e=e.mode,i=(r=this._adsorbPoint).x,r=r.y,(t=t)instanceof s.Geometry&&((n=t.getCoordinates())instanceof Array?("Rectangle"===e?0<n[0].length&&(n[0][1].x=i,n[0][2].x=i,n[0][2].y=r,n[0][3].y=r):(o=n.length)&&(n[o-1].x=i,n[o-1].y=r),t.setCoordinates(n)):"Circle"===e&&(i=this._map.getProjection().measureLength([n,this._adsorbPoint]),t.setRadius(i)._updateCache())))},L.prototype._resetClickPoint=function(t){var e,r,n;this._adsorbPoint&&((t=t.target._clickCoords)instanceof s.Coordinate||t instanceof Array)&&(r=this._map.coordToPoint(this._adsorbPoint),e=(r=this._map._pointToPrj(r)).x,r=r.y,(n=t.length)?(t[n-1].x=e,t[n-1].y=r):(t.x=e,t.y=r))},L.prototype._setEditCoordinates=function(t){var e,r,n,o,i,a;this._adsorbPoint&&this._needDeal&&"MultiPolygon"!==this.geometry.type&&(t=t.target,a=(e=this._adsorbPoint).x,e=e.y,this.geometryCoords instanceof Array?(i=this.geometryCoords[0],Pe(i,this._adsorbPoint)||(n=!0,(o=(r=t.getCoordinates())[0])instanceof Array?0===(i=Dt(o,i,ct)).length?n=!1:(i=$t(o,i[0]),o=o.length,r[0][i].x=a,r[0][i].y=e,0===i&&(r[0][o-1].x=a,r[0][o-1].y=e)):(i=Dt(r,this.geometryCoords,ct)[0],r[o=$t(r,i)].x=a,r[o].y=e),this._needDeal=!1,n&&t._editor._shadow.setCoordinates(r))):this.geometry instanceof s.Circle&&(this._needDeal=!1,i=this.geometryCoords,a=this._map.getProjection().measureLength([i,this._adsorbPoint]),t._editor._shadow.setRadius(a)))},L.prototype._upGeoCoords=function(t){t=t.target;this.geometryCoords=t.getCoordinates()},L);function L(t){if(!(this instanceof L))throw new TypeError("Cannot call a class as a function");t=function(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,Ie.call(this,t));return t._tree=st(),t._layerName=s.INTERNAL_LAYER_PREFIX+"_Autoadsorb",t._isEnable=!1,t._updateModeType(),t._updateDistance(),t._updateNeedCtrl(),t}r.mergeOptions(Ne),T.Autoadsorb=r,Object.defineProperty(T,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.autoadsorb v0.3.0, requires maptalks@>=0.46.0.")});