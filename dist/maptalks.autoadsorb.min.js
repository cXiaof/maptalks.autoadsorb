/*!
 * maptalks.autoadsorb v0.4.0
 * LICENSE : MIT
 * (c) 2016-2022 maptalks.org
 */
/*!
 * requires maptalks@>=0.46.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks"),require("lodash.isequal")):"function"==typeof define&&define.amd?define(["exports","maptalks","lodash.isequal"],e):e(t.maptalks=t.maptalks||{},t.maptalks,t.isEqual)}(this,function(T,n,i){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;var G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t=6371008.8,B={centimeters:100*t,centimetres:100*t,degrees:t/111325,feet:3.28084*t,inches:39.37*t,kilometers:t/1e3,kilometres:t/1e3,meters:t,metres:t,miles:t/1609.344,millimeters:1e3*t,millimetres:1e3*t,nauticalmiles:t/1852,radians:1,yards:1.0936*t},X={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function p(t,e,r){var n={type:"Feature"};return 0!==(r=void 0===r?{}:r).id&&!r.id||(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function d(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(D(t[0])&&D(t[1]))return p({type:"Point",coordinates:t},e,r);throw new Error("coordinates must contain numbers")}function Y(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return p({type:"Polygon",coordinates:t},e,r)}function y(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return p({type:"LineString",coordinates:t},e,r)}function _(t,e){var r={type:"FeatureCollection"};return(e=void 0===e?{}:e).id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function R(t,e,r){return p({type:"MultiLineString",coordinates:t},e,r=void 0===r?{}:r)}function I(t,e,r){return p({type:"MultiPoint",coordinates:t},e,r=void 0===r?{}:r)}function N(t,e,r){return p({type:"MultiPolygon",coordinates:t},e,r=void 0===r?{}:r)}function $(t,e){var r=B[e=void 0===e?"kilometers":e];if(r)return t*r;throw new Error(e+" units is invalid")}function q(t,e){var r=B[e=void 0===e?"kilometers":e];if(r)return t/r;throw new Error(e+" units is invalid")}function a(t){return 180*(t%(2*Math.PI))/Math.PI}function s(t){return t%360*Math.PI/180}function D(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function J(t){return!!t&&t.constructor===Object}t=Object.freeze({earthRadius:t,factors:B,unitsFactors:{centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t,yards:1.0936133},areaFactors:X,feature:p,geometry:function(t,e,r){switch(void 0===r&&(r={}),t){case"Point":return d(e).geometry;case"LineString":return y(e).geometry;case"Polygon":return Y(e).geometry;case"MultiPoint":return I(e).geometry;case"MultiLineString":return R(e).geometry;case"MultiPolygon":return N(e).geometry;default:throw new Error(t+" is invalid")}},point:d,points:function(t,e,r){return void 0===r&&(r={}),_(t.map(function(t){return d(t,e)}),r)},polygon:Y,polygons:function(t,e,r){return void 0===r&&(r={}),_(t.map(function(t){return Y(t,e)}),r)},lineString:y,lineStrings:function(t,e,r){return void 0===r&&(r={}),_(t.map(function(t){return y(t,e)}),r)},featureCollection:_,multiLineString:R,multiPoint:I,multiPolygon:N,geometryCollection:function(t,e,r){return p({type:"GeometryCollection",geometries:t},e,r=void 0===r?{}:r)},round:function(t,e){if(!(e=void 0===e?0:e)||0<=e)return e=Math.pow(10,e||0),Math.round(t*e)/e;throw new Error("precision must be a positive number")},radiansToLength:$,lengthToRadians:q,lengthToDegrees:function(t,e){return a(q(t,e))},bearingToAzimuth:function(t){return(t%=360)<0&&(t+=360),t},radiansToDegrees:a,degreesToRadians:s,convertLength:function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),0<=t)return $(q(t,e),r);throw new Error("length must be a positive number")},convertArea:function(t,e,r){if(void 0===e&&(e="meters"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("area must be a positive number");if(!(e=X[e]))throw new Error("invalid original units");if(r=X[r])return t/e*r;throw new Error("invalid final units")},isNumber:D,isObject:J,validateBBox:function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!D(t))throw new Error("bbox must only contain numbers")})},validateId:function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(void 0===t?"undefined":G(t)))throw new Error("id must be a number or a string")}});function P(t,e,r){if(null!==t)for(var n,o,i,a=0,s=t.type,u="FeatureCollection"===s,c="Feature"===s,l=u?t.features.length:1,h=0;h<l;h++)for(var f,p,d=(p=!!(f=u?t.features[h].geometry:c?t.geometry:t)&&"GeometryCollection"===f.type)?f.geometries.length:1,y=0;y<d;y++){var _=0,g=0,m=p?f.geometries[y]:f;if(null!==m){var v=m.coordinates,b=m.type,w=!r||"Polygon"!==b&&"MultiPolygon"!==b?0:1;switch(b){case null:break;case"Point":if(!1===e(v,a,h,_,g))return!1;a++,_++;break;case"LineString":case"MultiPoint":for(n=0;n<v.length;n++){if(!1===e(v[n],a,h,_,g))return!1;a++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(n=0;n<v.length;n++){for(o=0;o<v[n].length-w;o++){if(!1===e(v[n][o],a,h,_,g))return!1;a++}"MultiLineString"===b&&_++,"Polygon"===b&&g++}"Polygon"===b&&_++;break;case"MultiPolygon":for(n=0;n<v.length;n++){for(o=g=0;o<v[n].length;o++){for(i=0;i<v[n][o].length-w;i++){if(!1===e(v[n][o][i],a,h,_,g))return!1;a++}g++}_++}break;case"GeometryCollection":for(n=0;n<m.geometries.length;n++)if(!1===P(m.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}function z(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function g(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function H(t,e){for(var r,n,o,i,a,s,u,c,l,h=0,f="FeatureCollection"===t.type,p="Feature"===t.type,d=f?t.features.length:1,y=0;y<d;y++){for(a=f?t.features[y].geometry:p?t.geometry:t,u=f?t.features[y].properties:p?t.properties:{},c=f?t.features[y].bbox:p?t.bbox:void 0,l=f?t.features[y].id:p?t.id:void 0,i=(s=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<i;n++)if(null===(o=s?a.geometries[n]:a)){if(!1===e(null,h,u,c,l))return!1}else switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,h,u,c,l))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],h,u,c,l))return!1;break;default:throw new Error("Unknown Geometry Type")}h++}}function r(t,c){H(t,function(t,e,r,n,o){var i,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1===c(p(t,r,{bbox:n,id:o}),e,0)?!1:void 0}switch(a){case"MultiPoint":i="Point";break;case"MultiLineString":i="LineString";break;case"MultiPolygon":i="Polygon"}for(var s=0;s<t.coordinates.length;s++){var u=t.coordinates[s];if(!1===c(p({type:i,coordinates:u},r),e,s))return!1}})}function U(t,p){r(t,function(i,a,s){var u=0;if(i.geometry){var c,l,h,f,t=i.geometry.type;if("Point"!==t&&"MultiPoint"!==t)return f=h=l=0,!1!==P(i,function(t,e,r,n,o){return void 0===c||l<a||h<n||f<o?(c=t,l=a,h=n,f=o,void(u=0)):(n=y([c,t],i.properties),!1!==p(n,a,s,o,u)&&(u++,void(c=t)))})&&void 0}})}function W(t,a){if(!t)throw new Error("geojson is required");r(t,function(t,e,r){if(null!==t.geometry){var n=t.geometry.type,o=t.geometry.coordinates;switch(n){case"LineString":if(!1===a(t,e,r,0,0))return!1;break;case"Polygon":for(var i=0;i<o.length;i++)if(!1===a(y(o[i],t.properties),e,r,i))return!1}}})}var e=Object.freeze({coordAll:function(t){var e=[];return P(t,function(t){e.push(t)}),e},coordEach:P,coordReduce:function(t,i,a,e){var s=a;return P(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)},e),s},featureEach:g,featureReduce:function(t,r,n){var o=n;return g(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},findPoint:function(t,e){if(!J(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return d(u,s,e);case"MultiPoint":return d(u[o=o<0?u.length+o:o],s,e);case"LineString":return d(u[a=a<0?u.length+a:a],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),d(u[i][a],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a),d(u[o][a],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a),d(u[o][i][a],s,e)}throw new Error("geojson is invalid")},findSegment:function(t,e){if(!J(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return y([u[a=a<0?u.length+a-1:a],u[a+1]],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a-1),y([u[i][a],u[i][a+1]],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a-1),y([u[o][a],u[o][a+1]],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a-1),y([u[o][i][a],u[o][i][a+1]],s,e)}throw new Error("geojson is invalid")},flattenEach:r,flattenReduce:function(t,n,o){var i=o;return r(t,function(t,e,r){i=0===e&&0===r&&void 0===o?t:n(i,t,e,r)}),i},geomEach:H,geomReduce:function(t,i,a){var s=a;return H(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)}),s},lineEach:W,lineReduce:function(t,o,i){var a=i;return W(t,function(t,e,r,n){a=0===e&&void 0===i?t:o(a,t,e,r,n)}),a},propEach:z,propReduce:function(t,r,n){var o=n;return z(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},segmentEach:U,segmentReduce:function(t,i,a){var s=a,u=!1;return U(t,function(t,e,r,n,o){s=!1===u&&void 0===a?t:i(s,t,e,r,n,o),u=!0}),s}});function V(e){var r=[];return"FeatureCollection"===e.type?g(e,function(e){P(e,function(t){r.push(d(t,e.properties))})}):P(e,function(t){r.push(d(t,e.properties))}),_(r)}function K(t){if(!t)throw new Error("geojson is required");var e=[];return r(t,function(t){e.push(t)}),_(e)}var Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function Z(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return tt(t);case"FeatureCollection":return e=t,r={type:"FeatureCollection"},Object.keys(e).forEach(function(t){switch(t){case"type":case"features":return;default:r[t]=e[t]}}),r.features=e.features.map(tt),r;case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return et(t);default:throw new Error("unknown GeoJSON type")}var e,r}function tt(e){var r={type:"Feature"};return Object.keys(e).forEach(function(t){switch(t){case"type":case"properties":case"geometry":return;default:r[t]=e[t]}}),r.properties=function r(n){var o={};if(!n)return o;Object.keys(n).forEach(function(t){var e=n[t];"object"===(void 0===e?"undefined":Q(e))?null===e?o[t]=null:Array.isArray(e)?o[t]=e.map(function(t){return t}):o[t]=r(e):o[t]=e});return o}(e.properties),r.geometry=et(e.geometry),r}function et(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?e.geometries=t.geometries.map(et):e.coordinates=function e(t){if("object"!==Q(t[0]))return t.slice();return t.map(function(t){return e(t)})}(t.coordinates),e}function u(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&2<=t.length&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function m(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function rt(t){return"Feature"===t.type?t.geometry:t}function v(t,e,r){void 0===r&&(r={});var t=u(t),e=u(e),n=s(e[1]-t[1]),o=s(e[0]-t[0]),t=s(t[1]),e=s(e[1]),n=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(t)*Math.cos(e);return $(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),r.units)}function nt(t,e,r){if(!0===(r=void 0===r?{}:r).final)return(nt(e,t)+180)%360;var r=u(t),t=u(e),e=s(r[0]),n=s(t[0]),r=s(r[1]),t=s(t[1]),o=Math.sin(n-e)*Math.cos(t),r=Math.cos(r)*Math.sin(t)-Math.sin(r)*Math.cos(t)*Math.cos(n-e);return a(Math.atan2(o,r))}function ot(t,e,r,n){void 0===n&&(n={});var t=u(t),o=s(t[0]),t=s(t[1]),r=s(r),e=q(e,n.units),i=Math.asin(Math.sin(t)*Math.cos(e)+Math.cos(t)*Math.sin(e)*Math.cos(r));return d([a(o+Math.atan2(Math.sin(r)*Math.sin(e)*Math.cos(t),Math.cos(e)-Math.sin(t)*Math.sin(i))),a(i)],n.properties)}function it(t){if(!t)throw new Error("geojson is required");var i=[];return r(t,function(t){var e=t,r=i,n=[],o=e.geometry;if(null!==o){switch(o.type){case"Polygon":n=m(o);break;case"LineString":n=[m(o)]}n.forEach(function(t){var a,s;a=e.properties,s=[],t.reduce(function(t,e){var r,n,o,i=y([t,e],a);return i.bbox=(r=e,n=(t=t)[0],t=t[1],o=r[0],r=r[1],[n<o?n:o,t<r?t:r,o<n?n:o,r<t?t:r]),s.push(i),e}),s.forEach(function(t){t.id=r.length,r.push(t)})})}}),_(i)}function at(t,e,r,n,o){!function t(e,r,n,o,i){for(;n<o;){600<o-n&&(a=o-n+1,l=r-n+1,u=Math.log(a),s=.5*Math.exp(2*u/3),u=.5*Math.sqrt(u*s*(a-s)/a)*(l-a/2<0?-1:1),c=Math.max(n,Math.floor(r-l*s/a+u)),l=Math.min(o,Math.floor(r+(a-l)*s/a+u)),t(e,r,c,l,i));var a,s,u,c,l,h=e[r],f=n,p=o;for(b(e,n,r),0<i(e[o],h)&&b(e,n,o);f<p;){for(b(e,f,p),f++,p--;i(e[f],h)<0;)f++;for(;0<i(e[p],h);)p--}0===i(e[n],h)?b(e,n,p):b(e,++p,o),p<=r&&(n=p+1),r<=p&&(o=p-1)}}(t,e,r||0,n||t.length-1,o||st)}function b(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function st(t,e){return t<e?-1:e<t?1:0}c.prototype.all=function(){return this._all(this.data,[])},c.prototype.search=function(t){var e=this.data,r=[];if(!yt(t,e))return r;for(var n=this.toBBox,o=[];e;){for(var i=0;i<e.children.length;i++){var a=e.children[i],s=e.leaf?n(a):a;yt(t,s)&&(e.leaf?r.push(a):dt(t,s)?this._all(a,r):o.push(a))}e=o.pop()}return r},c.prototype.collides=function(t){var e=this.data;if(!yt(t,e))return!1;for(var r=[];e;){for(var n=0;n<e.children.length;n++){var o=e.children[n],i=e.leaf?this.toBBox(o):o;if(yt(t,i)){if(e.leaf||dt(t,i))return!0;r.push(o)}}e=r.pop()}return!1},c.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var r,n=this._build(t.slice(),0,t.length-1,0);return this.data.children.length?this.data.height===n.height?this._splitRoot(this.data,n):(this.data.height<n.height&&(r=this.data,this.data=n,n=r),this._insert(n,this.data.height-n.height-1,!0)):this.data=n,this},c.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},c.prototype.clear=function(){return this.data=M([]),this},c.prototype.remove=function(t,e){if(!t)return this;for(var r=this.data,n=this.toBBox(t),o=[],i=[],a=void 0,s=void 0,u=void 0;r||o.length;){if(r||(r=o.pop(),s=o[o.length-1],a=i.pop(),u=!0),r.leaf){var c=function(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}(t,r.children,e);if(-1!==c)return r.children.splice(c,1),o.push(r),this._condense(o),this}u||r.leaf||!dt(r,n)?s?(a++,r=s.children[a],u=!1):r=null:(o.push(r),i.push(a),r=(s=r).children[a=0])}return this},c.prototype.toBBox=function(t){return t},c.prototype.compareMinX=function(t,e){return t.minX-e.minX},c.prototype.compareMinY=function(t,e){return t.minY-e.minY},c.prototype.toJSON=function(){return this.data},c.prototype.fromJSON=function(t){return this.data=t,this},c.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},c.prototype._build=function(t,e,r,n){var o=r-e+1,i=this._maxEntries,a=void 0;if(o<=i)return w(a=M(t.slice(e,r+1)),this.toBBox),a;n||(n=Math.ceil(Math.log(o)/Math.log(i)),i=Math.ceil(o/Math.pow(i,n-1))),(a=M([])).leaf=!1,a.height=n;var s=Math.ceil(o/i),u=s*Math.ceil(Math.sqrt(i));_t(t,e,r,u,this.compareMinX);for(var c=e;c<=r;c+=u){var l=Math.min(c+u-1,r);_t(t,c,l,s,this.compareMinY);for(var h=c;h<=l;h+=s){var f=Math.min(h+s-1,l);a.children.push(this._build(t,h,f,n-1))}}return w(a,this.toBBox),a},c.prototype._chooseSubtree=function(t,e,r,n){for(;;){if(n.push(e),e.leaf||n.length-1===r)break;for(var o=1/0,i=1/0,a=void 0,s=0;s<e.children.length;s++){var u=e.children[s],c=ft(u),l=(h=t,l=u,(Math.max(l.maxX,h.maxX)-Math.min(l.minX,h.minX))*(Math.max(l.maxY,h.maxY)-Math.min(l.minY,h.minY))-c);l<i?(i=l,o=c<o?c:o,a=u):l===i&&c<o&&(o=c,a=u)}e=a||e.children[0]}var h,l;return e},c.prototype._insert=function(t,e,r){var r=r?t:this.toBBox(t),n=[],o=this._chooseSubtree(r,this.data,e,n);for(o.children.push(t),ct(o,r);0<=e&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},c.prototype._split=function(t,e){var r=t[e],n=r.children.length,o=this._minEntries,o=(this._chooseSplitAxis(r,o,n),this._chooseSplitIndex(r,o,n)),n=M(r.children.splice(o,r.children.length-o));n.height=r.height,n.leaf=r.leaf,w(r,this.toBBox),w(n,this.toBBox),e?t[e-1].children.push(n):this._splitRoot(r,n)},c.prototype._splitRoot=function(t,e){this.data=M([t,e]),this.data.height=t.height+1,this.data.leaf=!1,w(this.data,this.toBBox)},c.prototype._chooseSplitIndex=function(t,e,r){for(var n,o,i,a=void 0,s=1/0,u=1/0,c=e;c<=r-e;c++){var l=ut(t,0,c,this.toBBox),h=ut(t,c,r,this.toBBox),f=(n=l,f=h,p=i=o=void 0,o=Math.max(n.minX,f.minX),i=Math.max(n.minY,f.minY),p=Math.min(n.maxX,f.maxX),n=Math.min(n.maxY,f.maxY),Math.max(0,p-o)*Math.max(0,n-i)),p=ft(l)+ft(h);f<s?(s=f,a=c,u=p<u?p:u):f===s&&p<u&&(u=p,a=c)}return a||r-e},c.prototype._chooseSplitAxis=function(t,e,r){var n=t.leaf?this.compareMinX:lt,o=t.leaf?this.compareMinY:ht;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,o)&&t.children.sort(n)},c.prototype._allDistMargin=function(t,e,r,n){t.children.sort(n);for(var o=this.toBBox,i=ut(t,0,e,o),a=ut(t,r-e,r,o),s=pt(i)+pt(a),u=e;u<r-e;u++){var c=t.children[u];ct(i,t.leaf?o(c):c),s+=pt(i)}for(var l=r-e-1;e<=l;l--){var h=t.children[l];ct(a,t.leaf?o(h):h),s+=pt(a)}return s},c.prototype._adjustParentBBoxes=function(t,e,r){for(var n=r;0<=n;n--)ct(e[n],t)},c.prototype._condense=function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():w(t[r],this.toBBox)};var o=c;function c(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:9,e=this,r=c;if(!(e instanceof r))throw new TypeError("Cannot call a class as a function");this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}function w(t,e){ut(t,0,t.children.length,e,t)}function ut(t,e,r,n,o){(o=o||M(null)).minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i=e;i<r;i++){var a=t.children[i];ct(o,t.leaf?n(a):a)}return o}function ct(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function lt(t,e){return t.minX-e.minX}function ht(t,e){return t.minY-e.minY}function ft(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function pt(t){return t.maxX-t.minX+(t.maxY-t.minY)}function dt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function yt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function M(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _t(t,e,r,n,o){for(var i,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(at(t,i=e+Math.ceil((r-e)/n/2)*n,e,r,o),a.push(e,i,i,r))}var l=Object.freeze({default:o});function gt(t){var e=[1/0,1/0,-1/0,-1/0];return P(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}gt.default=gt;var h=Object.freeze({default:gt}),f=l&&o,S=(h&&gt).default,mt=e.featureEach,vt=t.featureCollection;function bt(t){t=new f(t);return t.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox||S(t),f.prototype.insert.call(this,t)},t.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox||S(t),e.push(t)}):mt(t,function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox||S(t),e.push(t)}),f.prototype.load.call(this,e)},t.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox||S(t),f.prototype.remove.call(this,t,e)},t.clear=function(){return f.prototype.clear.call(this)},t.search=function(t){t=f.prototype.search.call(this,this.toBBox(t));return vt(t)},t.collides=function(t){return f.prototype.collides.call(this,this.toBBox(t))},t.all=function(){var t=f.prototype.all.call(this);return vt(t)},t.toJSON=function(){return f.prototype.toJSON.call(this)},t.fromJSON=function(t){return f.prototype.fromJSON.call(this,t)},t.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=S(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=S(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},t}var wt=bt;function Pt(t,e){t=m(t),e=m(e);if(2!==t.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==e.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=t[0][0],n=t[0][1],o=t[1][0],t=t[1][1],i=e[0][0],a=e[0][1],s=e[1][0],e=e[1][1],u=(e-a)*(o-r)-(s-i)*(t-n),s=(s-i)*(n-a)-(e-a)*(r-i),e=(o-r)*(n-a)-(t-n)*(r-i);if(0==u)return null;a=s/u,i=e/u;return 0<=a&&a<=1&&0<=i&&i<=1?d([r+a*(o-r),n+a*(t-n)]):null}function Mt(t,c,l){void 0===l&&(l={});var h=d([1/0,1/0],{dist:1/0}),f=0;return r(t,function(t){for(var e=m(t),r=0;r<e.length-1;r++){var n=d(e[r]),o=(n.properties.dist=v(c,n,l),d(e[r+1])),i=(o.properties.dist=v(c,o,l),v(n,o,l)),a=Math.max(n.properties.dist,o.properties.dist),s=nt(n,o),u=ot(c,a,s+90,l),a=ot(c,a,s-90,l),s=function(t,e){var r,n={},o=[];if("LineString"===t.type&&(t=p(t)),"LineString"===e.type&&(e=p(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length)return(r=Pt(t,e))&&o.push(r),_(o);var i=wt();return i.load(it(e)),g(it(t),function(r){g(i.search(r),function(t){var e,t=Pt(r,t);t&&(e=m(t).join(","),n[e]||(n[e]=!0,o.push(t)))})}),_(o)}(y([u.geometry.coordinates,a.geometry.coordinates]),y([n.geometry.coordinates,o.geometry.coordinates])),u=null;0<s.features.length&&((u=s.features[0]).properties.dist=v(c,u,l),u.properties.location=f+v(n,u,l)),n.properties.dist<h.properties.dist&&((h=n).properties.index=r,h.properties.location=f),o.properties.dist<h.properties.dist&&((h=o).properties.index=r+1,h.properties.location=f+i),u&&u.properties.dist<h.properties.dist&&((h=u).properties.index=r),f+=i}}),h}wt.default=bt;function St(t,e){void 0===e&&(e={});var r,n,o,i,a,s=rt(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),s.type){case"Polygon":return void 0===(i=e)&&(i={}),a=rt(o=s).coordinates,i=i.properties||("Feature"===o.type?o.properties:{}),xt(a,i);case"MultiPolygon":return void 0===(o=e)&&(o={}),i=rt(a=s).coordinates,r=o.properties||("Feature"===a.type?a.properties:{}),n=[],i.forEach(function(t){n.push(xt(t,r))}),_(n);default:throw new Error("invalid poly")}}function xt(t,e){return 1<t.length?R(t,e):y(t[0],e)}var ne="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt="__lodash_hash_undefined__",Ct=9007199254740991,Lt="[object Arguments]",Ot="[object Function]",At="[object GeneratorFunction]",kt=/^\[object .+?Constructor\]$/,l="object"==Et(ne)&&ne&&ne.Object===Object&&ne,o="object"==("undefined"==typeof self?"undefined":Et(self))&&self&&self.Object===Object&&self,h=l||o||Function("return this")();function Ft(t,e){return!!(t?t.length:0)&&-1<function(t,e,r){if(e!=e)return function(t,e,r,n){var o=t.length,i=r+(n?1:-1);for(;n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,Gt,r);var n=r-1,o=t.length;for(;++n<o;)if(t[n]===e)return n;return-1}(t,e,0)}function Tt(t,e,r){for(var n=-1,o=t?t.length:0;++n<o;)if(r(e,t[n]))return!0;return!1}function Gt(t){return t!=t}function Bt(t,e){return t.has(e)}var e=Array.prototype,t=Function.prototype,l=Object.prototype,o=h["__core-js_shared__"],Xt=(o=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"",Yt=t.toString,Rt=l.hasOwnProperty,It=l.toString,Nt=RegExp("^"+Yt.call(Rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),o=h.Symbol,$t=l.propertyIsEnumerable,qt=e.splice,Dt=o?o.isConcatSpreadable:void 0,Jt=Math.max,zt=Zt(h,"Map"),Ht=Zt(Object,"create");function x(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function E(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function j(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Ut(t){var e=-1,r=t?t.length:0;for(this.__data__=new j;++e<r;)this.add(t[e])}function Wt(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}function Vt(t,e,r,n){var o,i=-1,a=Ft,s=!0,u=t.length,c=[],l=e.length;if(!u)return c;r&&(e=function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(e,(o=r,function(t){return o(t)}))),n?(a=Tt,s=!1):200<=e.length&&(a=Bt,s=!1,e=new Ut(e));t:for(;++i<u;){var h=t[i],f=r?r(h):h,h=n||0!==h?h:0;if(s&&f==f){for(var p=l;p--;)if(e[p]===f)continue t;c.push(h)}else a(e,f,n)||c.push(h)}return c}function Kt(t){var e;if(ce(t)&&(e=t,!(Xt&&Xt in e)))return(ue(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?Nt:kt).test(function(t){if(null!=t){try{return Yt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function Qt(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":Et(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function Zt(t,e){e=e;t=null==(t=t)?void 0:t[e];return Kt(t)?t:void 0}function te(t){return ie(t)||se(e=t)&&Rt.call(e,"callee")&&(!$t.call(e,"callee")||It.call(e)==Lt)||!!(Dt&&t&&t[Dt]);var e}x.prototype.clear=function(){this.__data__=Ht?Ht(null):{}},x.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},x.prototype.get=function(t){var e,r=this.__data__;return Ht?(e=r[t])===jt?void 0:e:Rt.call(r,t)?r[t]:void 0},x.prototype.has=function(t){var e=this.__data__;return Ht?void 0!==e[t]:Rt.call(e,t)},x.prototype.set=function(t,e){return this.__data__[t]=Ht&&void 0===e?jt:e,this},E.prototype.clear=function(){this.__data__=[]},E.prototype.delete=function(t){var e=this.__data__;return!((t=Wt(e,t))<0)&&(t==e.length-1?e.pop():qt.call(e,t,1),!0)},E.prototype.get=function(t){var e=this.__data__;return(t=Wt(e,t))<0?void 0:e[t][1]},E.prototype.has=function(t){return-1<Wt(this.__data__,t)},E.prototype.set=function(t,e){var r=this.__data__,n=Wt(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},j.prototype.clear=function(){this.__data__={hash:new x,map:new(zt||E),string:new x}},j.prototype.delete=function(t){return Qt(this,t).delete(t)},j.prototype.get=function(t){return Qt(this,t).get(t)},j.prototype.has=function(t){return Qt(this,t).has(t)},j.prototype.set=function(t,e){return Qt(this,t).set(t,e),this},Ut.prototype.add=Ut.prototype.push=function(t){return this.__data__.set(t,jt),this},Ut.prototype.has=function(t){return this.__data__.has(t)};function ee(){for(var t=arguments,e=-1,r=Jt(t.length-C,0),n=Array(r);++e<r;)n[e]=t[C+e];for(var e=-1,o=Array(C+1);++e<C;)o[e]=t[e];o[C]=n;var i=re,a=this,s=o;switch(s.length){case 0:return i.call(a);case 1:return i.call(a,s[0]);case 2:return i.call(a,s[0],s[1]);case 3:return i.call(a,s[0],s[1],s[2])}return i.apply(a,s)}var re,C;re=function(t,e){return se(t)?Vt(t,function t(e,r,n,o,i){var a=-1,s=e.length;for(n=n||te,i=i||[];++a<s;){var u=e[a];if(0<r&&n(u))if(1<r)t(u,r-1,n,o,i);else{p=f=h=l=c=void 0;for(var c=i,l=u,h=-1,f=l.length,p=c.length;++h<f;)c[p+h]=l[h]}else o||(i[i.length]=u)}return i}(e,1,se,!0)):[]},C=Jt(void 0===C?re.length-1:C,0);var ie=Array.isArray;function ae(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=Ct)&&!ue(t);var e}function se(t){return!!(e=t)&&"object"==(void 0===e?"undefined":Et(e))&&ae(t);var e}function ue(t){t=ce(t)?It.call(t):"";return t==Ot||t==At}function ce(t){var e=void 0===t?"undefined":Et(t);return t&&("object"==e||"function"==e)}var le=ee,he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fe="__lodash_hash_undefined__",pe=9007199254740991,de="[object Arguments]",ye="[object Function]",_e="[object GeneratorFunction]",ge=/^\[object .+?Constructor\]$/,t="object"==he(ne)&&ne&&ne.Object===Object&&ne,l="object"==("undefined"==typeof self?"undefined":he(self))&&self&&self.Object===Object&&self,e=t||l||Function("return this")();function me(t,e){return!!(t?t.length:0)&&-1<function(t,e,r){if(e!=e)return function(t,e,r,n){var o=t.length,i=r+(n?1:-1);for(;n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,be,r);var n=r-1,o=t.length;for(;++n<o;)if(t[n]===e)return n;return-1}(t,e,0)}function ve(t,e,r){for(var n=-1,o=t?t.length:0;++n<o;)if(r(e,t[n]))return!0;return!1}function be(t){return t!=t}function we(t,e){return t.has(e)}var o=Array.prototype,h=Function.prototype,t=Object.prototype,l=e["__core-js_shared__"],Pe=(l=/[^.]+$/.exec(l&&l.keys&&l.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"",Me=h.toString,Se=t.hasOwnProperty,xe=t.toString,Ee=RegExp("^"+Me.call(Se).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),l=e.Symbol,je=t.propertyIsEnumerable,Ce=o.splice,Le=l?l.isConcatSpreadable:void 0,Oe=Math.max,Ae=Ye(e,"Map"),ke=Ye(Object,"create");function L(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function O(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function A(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Fe(t){var e=-1,r=t?t.length:0;for(this.__data__=new A;++e<r;)this.add(t[e])}function Te(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}function Ge(t,e,r,n){var o,i=-1,a=me,s=!0,u=t.length,c=[],l=e.length;if(!u)return c;r&&(e=function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(e,(o=r,function(t){return o(t)}))),n?(a=ve,s=!1):200<=e.length&&(a=we,s=!1,e=new Fe(e));t:for(;++i<u;){var h=t[i],f=r?r(h):h,h=n||0!==h?h:0;if(s&&f==f){for(var p=l;p--;)if(e[p]===f)continue t;c.push(h)}else a(e,f,n)||c.push(h)}return c}function Be(t){var e;if(ze(t)&&(e=t,!(Pe&&Pe in e)))return(Je(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?Ee:ge).test(function(t){if(null!=t){try{return Me.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function Xe(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":he(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function Ye(t,e){e=e;t=null==(t=t)?void 0:t[e];return Be(t)?t:void 0}function Re(t){return $e(t)||De(e=t)&&Se.call(e,"callee")&&(!je.call(e,"callee")||xe.call(e)==de)||!!(Le&&t&&t[Le]);var e}L.prototype.clear=function(){this.__data__=ke?ke(null):{}},L.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},L.prototype.get=function(t){var e,r=this.__data__;return ke?(e=r[t])===fe?void 0:e:Se.call(r,t)?r[t]:void 0},L.prototype.has=function(t){var e=this.__data__;return ke?void 0!==e[t]:Se.call(e,t)},L.prototype.set=function(t,e){return this.__data__[t]=ke&&void 0===e?fe:e,this},O.prototype.clear=function(){this.__data__=[]},O.prototype.delete=function(t){var e=this.__data__;return!((t=Te(e,t))<0)&&(t==e.length-1?e.pop():Ce.call(e,t,1),!0)},O.prototype.get=function(t){var e=this.__data__;return(t=Te(e,t))<0?void 0:e[t][1]},O.prototype.has=function(t){return-1<Te(this.__data__,t)},O.prototype.set=function(t,e){var r=this.__data__,n=Te(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},A.prototype.clear=function(){this.__data__={hash:new L,map:new(Ae||O),string:new L}},A.prototype.delete=function(t){return Xe(this,t).delete(t)},A.prototype.get=function(t){return Xe(this,t).get(t)},A.prototype.has=function(t){return Xe(this,t).has(t)},A.prototype.set=function(t,e){return Xe(this,t).set(t,e),this},Fe.prototype.add=Fe.prototype.push=function(t){return this.__data__.set(t,fe),this},Fe.prototype.has=function(t){return this.__data__.has(t)};function Ie(){for(var t=arguments,e=-1,r=Oe(t.length-k,0),n=Array(r);++e<r;)n[e]=t[k+e];for(var e=-1,o=Array(k+1);++e<k;)o[e]=t[e];o[k]=n;var i=Ne,a=this,s=o;switch(s.length){case 0:return i.call(a);case 1:return i.call(a,s[0]);case 2:return i.call(a,s[0],s[1]);case 3:return i.call(a,s[0],s[1],s[2])}return i.apply(a,s)}var Ne,k;Ne=function(t,e){var r,n=(r=(n=e)?n.length:0)?n[r-1]:void 0;return De(n)&&(n=void 0),De(t)?Ge(t,function t(e,r,n,o,i){var a=-1,s=e.length;for(n=n||Re,i=i||[];++a<s;){var u=e[a];if(0<r&&n(u))if(1<r)t(u,r-1,n,o,i);else{p=f=h=l=c=void 0;for(var c=i,l=u,h=-1,f=l.length,p=c.length;++h<f;)c[p+h]=l[h]}else o||(i[i.length]=u)}return i}(e,1,De,!0),void 0,n):[]},k=Oe(void 0===k?Ne.length-1:k,0);var $e=Array.isArray;function qe(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=pe)&&!Je(t);var e}function De(t){return!!(e=t)&&"object"==(void 0===e?"undefined":he(e))&&qe(t);var e}function Je(t){t=ze(t)?xe.call(t):"";return t==ye||t==_e}function ze(t){var e=void 0===t?"undefined":he(t);return t&&("object"==e||"function"==e)}function He(t,e){if(i(t,e))return!0;var r=(t=t.toArray())[0],t=t[1],n=(e=e.toArray())[0],e=e[1],o=Ue(r,n),r=r.toFixed(o),n=n.toFixed(o),o=Ue(t,e),t=t.toFixed(o),e=e.toFixed(o);return r===n&&t===e}function Ue(t,e){return t=Ke(t),e=Ke(e),t=Math.max(t,e)-3,Math.max(t,0)}var We=Ie,oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ve=(function(t,e){var M="__lodash_hash_undefined__",B=1,X=2,l=1/0,S=9007199254740991,x=17976931348623157e292,E=NaN,Y="[object Arguments]",W="[object Array]",V="[object Boolean]",K="[object Date]",Q="[object Error]",j="[object Function]",C="[object GeneratorFunction]",R="[object Map]",Z="[object Number]",I="[object Object]",L="[object Promise]",tt="[object RegExp]",N="[object Set]",et="[object String]",rt="[object Symbol]",O="[object WeakMap]",nt="[object ArrayBuffer]",$="[object DataView]",A=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,k=/^\w*$/,F=/^\./,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,G=/^\s+|\s+$/g,ot=/\\(\\)?/g,it=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,st=/^\[object .+?Constructor\]$/,ut=/^0o[0-7]+$/i,ct=/^(?:0|[1-9]\d*)$/,r={},lt=(r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r[Y]=r[W]=r[nt]=r[V]=r[$]=r[K]=r[Q]=r[j]=r[R]=r[Z]=r[I]=r[tt]=r[N]=r[et]=r[O]=!1,parseInt),n="object"==oe(ne)&&ne&&ne.Object===Object&&ne,o="object"==("undefined"==typeof self?"undefined":oe(self))&&self&&self.Object===Object&&self,o=n||o||Function("return this")(),e=e&&!e.nodeType&&e,i=e&&t&&!t.nodeType&&t,ht=i&&i.exports===e&&n.process,i=function(){try{return ht&&ht.binding("util")}catch(t){}}(),e=i&&i.isTypedArray;function ft(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function pt(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function dt(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var yt,_t,n=Array.prototype,i=Function.prototype,a=Object.prototype,s=o["__core-js_shared__"],gt=(s=/[^.]+$/.exec(s&&s.keys&&s.keys.IE_PROTO||""))?"Symbol(src)_1."+s:"",mt=i.toString,q=a.hasOwnProperty,u=a.toString,vt=RegExp("^"+mt.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),s=o.Symbol,bt=o.Uint8Array,wt=a.propertyIsEnumerable,Pt=n.splice,Mt=(yt=Object.keys,_t=Object,function(t){return yt(_t(t))}),St=Math.max,i=m(o,"DataView"),c=m(o,"Map"),n=m(o,"Promise"),xt=m(o,"Set"),o=m(o,"WeakMap"),h=m(Object,"create"),Et=w(i),jt=w(c),Ct=w(n),Lt=w(xt),Ot=w(o),s=s?s.prototype:void 0,At=s?s.valueOf:void 0,kt=s?s.toString:void 0;function f(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function p(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function d(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function y(t){var e=-1,r=t?t.length:0;for(this.__data__=new d;++e<r;)this.add(t[e])}function D(t){this.__data__=new p(t)}function Ft(t,e){var r,n=z(t)||Ut(t)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],o=n.length,i=!!o;for(r in t)!e&&!q.call(t,r)||i&&("length"==r||$t(r,o))||n.push(r);return n}function _(t,e){for(var r=t.length;r--;)if(Ht(t[r][0],e))return r;return-1}function Tt(t,e){for(var r=0,n=(e=v(e,t)?[e]:It(e)).length;null!=t&&r<n;)t=t[b(e[r++])];return r&&r==n?t:void 0}function Gt(t,e){return null!=t&&e in Object(t)}function Bt(t,e,r,n,o){{if(t===e)return!0;if(null==t||null==e||!H(t)&&!U(e))return t!=t&&e!=e;var i=Bt,a=z(t),s=z(e),u=W,c=W,s=(a||(u=(u=J(t))==Y?I:u),s||(c=(c=J(e))==Y?I:c),u==I&&!ft(t)),l=c==I&&!ft(e),c;if((c=u==c)&&!s){o=o||new D;if(a||Zt(t))return Nt(t,e,i,r,n,o);else{var h=t;var f=e;var p=u;var d=i;var y=r;var _=n;var g=o;switch(p){case $:if(h.byteLength!=f.byteLength||h.byteOffset!=f.byteOffset)return!1;h=h.buffer,f=f.buffer;case nt:return h.byteLength==f.byteLength&&d(new bt(h),new bt(f))?!0:!1;case V:case K:case Z:return Ht(+h,+f);case Q:return h.name==f.name&&h.message==f.message;case tt:case et:return h==f+"";case R:var m=pt;case N:var v=_&X;if(m=m||dt,h.size!=f.size&&!v)return!1;v=g.get(h);if(v)return v==f;_|=B,g.set(h,f);v=Nt(m(h),m(f),d,y,_,g);return g.delete(h),v;case rt:if(At)return At.call(h)==At.call(f)}return!1;return}}if(!(n&X)){var a=s&&q.call(t,"__wrapped__"),u=l&&q.call(e,"__wrapped__");if(a||u)return s=a?t.value():t,l=u?e.value():e,o=o||new D,i(s,l,r,n,o)}if(c){o=o||new D;var b=t,w=e,P=i,M=r,S=n,x=o,E=S&X,j=ee(b),C=j.length,a=ee(w).length;if(C!=a&&!E)return!1;for(var L=C;L--;){var O=j[L];if(!(E?O in w:q.call(w,O)))return!1}if((a=x.get(b))&&x.get(w))return a==w;for(var A=!0,k=(x.set(b,w),x.set(w,b),E);++L<C;){O=j[L];var F,T=b[O],G=w[O];if(!(void 0===(F=M?E?M(G,T,O,w,b,x):M(T,G,O,b,w,x):F)?T===G||P(T,G,M,S,x):F)){A=!1;break}k=k||"constructor"==O}return A&&!k&&(a=b.constructor,u=w.constructor,a!=u&&"constructor"in b&&"constructor"in w&&!("function"==typeof a&&a instanceof a&&"function"==typeof u&&u instanceof u)&&(A=!1)),x.delete(b),x.delete(w),A}return!1}}function Xt(t){var e;if(H(t)&&(e=t,!(gt&&gt in e)))return(Vt(t)||ft(t)?vt:st).test(w(t))}function Yt(t){if("function"==typeof t)return t;if(null==t)return re;if("object"==(void 0===t?"undefined":oe(t)))if(z(t)){var n=t[0],o=t[1];return v(n)&&qt(o)?Dt(b(n),o):function(t){var e,r=function(t,e,r){t=null==t?void 0:Tt(t,e);return void 0===t?r:t}(t,n);return void 0===r&&r===o?(e=n,null!=(t=t)&&function(t,e,r){e=v(e,t)?[e]:It(e);var n,o=-1,i=e.length;for(;++o<i;){var a=b(e[o]);if(!(n=null!=t&&r(t,a)))break;t=t[a]}if(n)return n;return!!(i=t?t.length:0)&&Kt(i)&&$t(a,i)&&(z(t)||Ut(t))}(t,e,Gt)):Bt(o,r,void 0,B|X)}}else{var e=t,r=function(t){var e=ee(t),r=e.length;for(;r--;){var n=e[r],o=t[n];e[r]=[n,o,qt(o)]}return e}(e);return 1==r.length&&r[0][2]?Dt(r[0][0],r[0][1]):function(t){return t===e||function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var s=r[o];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++o<i;){var u=(s=r[o])[0],c=t[u],l=s[1];if(a&&s[2]){if(void 0===c&&!(u in t))return!1}else{var h,f=new D;if(!(void 0===(h=n?n(c,l,u,t,e,f):h)?Bt(l,c,n,B|X,f):h))return!1}}return!0}(t,e,r)}}var i,a;return v(t=t)?(i=b(t),function(t){return null==t?void 0:t[i]}):(a=t,function(t){return Tt(t,a)})}function Rt(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||a,e!==r)return Mt(t);var e,r,n,o=[];for(n in Object(t))q.call(t,n)&&"constructor"!=n&&o.push(n);return o}function It(t){return z(t)?t:Jt(t)}function Nt(t,e,r,n,o,i){var a=o&X,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;u=i.get(t);if(u&&i.get(e))return u==e;var c=-1,l=!0,h=o&B?new y:void 0;for(i.set(t,e),i.set(e,t);++c<s;){var f,p=t[c],d=e[c];if(void 0!==(f=n?a?n(d,p,c,e,t,i):n(p,d,c,t,e,i):f)){if(f)continue;l=!1;break}if(h){if(!function(t,e){for(var r=-1,n=t?t.length:0;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return!h.has(e)&&(p===t||r(p,t,n,o,i))&&h.add(e)})){l=!1;break}}else if(p!==d&&!r(p,d,n,o,i)){l=!1;break}}return i.delete(t),i.delete(e),l}function g(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":oe(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function m(t,e){e=e;t=null==(t=t)?void 0:t[e];return Xt(t)?t:void 0}f.prototype.clear=function(){this.__data__=h?h(null):{}},f.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},f.prototype.get=function(t){var e,r=this.__data__;return h?(e=r[t])===M?void 0:e:q.call(r,t)?r[t]:void 0},f.prototype.has=function(t){var e=this.__data__;return h?void 0!==e[t]:q.call(e,t)},f.prototype.set=function(t,e){return this.__data__[t]=h&&void 0===e?M:e,this},p.prototype.clear=function(){this.__data__=[]},p.prototype.delete=function(t){var e=this.__data__;return!((t=_(e,t))<0)&&(t==e.length-1?e.pop():Pt.call(e,t,1),!0)},p.prototype.get=function(t){var e=this.__data__;return(t=_(e,t))<0?void 0:e[t][1]},p.prototype.has=function(t){return-1<_(this.__data__,t)},p.prototype.set=function(t,e){var r=this.__data__,n=_(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},d.prototype.clear=function(){this.__data__={hash:new f,map:new(c||p),string:new f}},d.prototype.delete=function(t){return g(this,t).delete(t)},d.prototype.get=function(t){return g(this,t).get(t)},d.prototype.has=function(t){return g(this,t).has(t)},d.prototype.set=function(t,e){return g(this,t).set(t,e),this},y.prototype.add=y.prototype.push=function(t){return this.__data__.set(t,M),this},y.prototype.has=function(t){return this.__data__.has(t)},D.prototype.clear=function(){this.__data__=new p},D.prototype.delete=function(t){return this.__data__.delete(t)},D.prototype.get=function(t){return this.__data__.get(t)},D.prototype.has=function(t){return this.__data__.has(t)},D.prototype.set=function(t,e){var r=this.__data__;if(r instanceof p){var n=r.__data__;if(!c||n.length<199)return n.push([t,e]),this;r=this.__data__=new d(n)}return r.set(t,e),this};var J=function(t){return u.call(t)};function $t(t,e){return!!(e=null==e?S:e)&&("number"==typeof t||ct.test(t))&&-1<t&&t%1==0&&t<e}function v(t,e){var r;if(!z(t))return r=void 0===t?"undefined":oe(t),"number"==r||"symbol"==r||"boolean"==r||null==t||P(t)||(k.test(t)||!A.test(t)||null!=e&&t in Object(e))}function qt(t){return t==t&&!H(t)}function Dt(e,r){return function(t){return null!=t&&(t[e]===r&&(void 0!==r||e in Object(t)))}}(i&&J(new i(new ArrayBuffer(1)))!=$||c&&J(new c)!=R||n&&J(n.resolve())!=L||xt&&J(new xt)!=N||o&&J(new o)!=O)&&(J=function(t){var e=u.call(t),t=e==I?t.constructor:void 0,t=t?w(t):void 0;if(t)switch(t){case Et:return $;case jt:return R;case Ct:return L;case Lt:return N;case Ot:return O}return e});var Jt=zt(function(t){t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(P(t))return kt?kt.call(t):"";var e=t+"";return"0"==e&&1/t==-l?"-0":e}(e);var e,o=[];return F.test(t)&&o.push(""),t.replace(T,function(t,e,r,n){o.push(r?n.replace(ot,"$1"):e||t)}),o});function b(t){if("string"==typeof t||P(t))return t;var e=t+"";return"0"==e&&1/t==-l?"-0":e}function w(t){if(null!=t){try{return mt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function zt(n,o){if("function"!=typeof n||o&&"function"!=typeof o)throw new TypeError("Expected a function");function i(){var t=arguments,e=o?o.apply(this,t):t[0],r=i.cache;return r.has(e)?r.get(e):(t=n.apply(this,t),i.cache=r.set(e,t),t)}return i.cache=new(zt.Cache||d),i}function Ht(t,e){return t===e||t!=t&&e!=e}function Ut(t){return U(e=t)&&Wt(e)&&q.call(t,"callee")&&(!wt.call(t,"callee")||u.call(t)==Y);var e}zt.Cache=d;var z=Array.isArray;function Wt(t){return null!=t&&Kt(t.length)&&!Vt(t)}function Vt(t){t=H(t)?u.call(t):"";return t==j||t==C}function Kt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=S}function H(t){var e=void 0===t?"undefined":oe(t);return t&&("object"==e||"function"==e)}function U(t){return!!t&&"object"==(void 0===t?"undefined":oe(t))}function P(t){return"symbol"==(void 0===t?"undefined":oe(t))||U(t)&&u.call(t)==rt}var Qt,Zt=e?(Qt=e,function(t){return Qt(t)}):function(t){return U(t)&&Kt(t.length)&&!!r[u.call(t)]};function te(t){if("number"==typeof t)return t;if(P(t))return E;if("string"!=typeof(t=H(t)?H(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=t.replace(G,"");var e=at.test(t);return e||ut.test(t)?lt(t.slice(2),e?2:8):it.test(t)?E:+t}function ee(t){return(Wt(t)?Ft:Rt)(t)}function re(t){return t}t.exports=function(t,e,r){var n=t?t.length:0;if(!n)return-1;for(var o=null==r?0:(r=function(t){return t?(t=te(t))!==l&&t!==-l?t==t?t:0:(t<0?-1:1)*x:0===t?t:0}(r=r),o=r%1,r==r?o?r-o:r:0),i=(o<0&&(o=St(n+o,0)),t),a=Yt(e),r=o,s=void 0,u=i.length,c=r+(s?1:-1);s?c--:++c<u;)if(a(i[c],c,i))return c;return-1}}(h={exports:{}},h.exports),h.exports),Ke=function(t){return t.toString().split(".")[1].length};function Qe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);if(t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e)if(Object.setPrototypeOf)Object.setPrototypeOf(t,e);else for(var r=t,n=e,o=Object.getOwnPropertyNames(n),i=0;i<o.length;i++){var a=o[i],s=Object.getOwnPropertyDescriptor(n,a);s&&s.configurable&&void 0===r[a]&&Object.defineProperty(r,a,s)}}var Ze,tr=n.INTERNAL_LAYER_PREFIX+"cxiaof_autoadsorb",t=(Qe(F,Ze=n.Class),F.prototype.setMode=function(t){return this.options.mode=t,this._updateGeosSet(),this},F.prototype.getMode=function(){return this.options.mode},F.prototype.setDistance=function(t){return this.options.distance=t,this._updateGeosSet(),this},F.prototype.getDistance=function(){return this.options.distance},F.prototype.refreshTargets=function(){return this._updateGeosSet(),this},F.prototype.isEnable=function(){return this._isEnable},F.prototype.bindDrawTool=function(t){return t instanceof n.DrawTool&&(this._map||this._addTo(t.getMap()),(this._drawTool=t).on("enable",this._enable,this),t.on("disable remove",this._disable,this),t.isEnabled()&&this._enable()),this},F.prototype.bindGeometry=function(t){return t instanceof n.Geometry&&(this._map||this._addTo(drawTool.getMap()),this._disableMapTool(),this._geometry=t,this._geometryCoords=t.getCoordinates(),t.on("editstart",this._enable,this),t.on("editend remove",this._disable,this),t.isEditing()&&this._enable()),this},F.prototype.remove=function(){this._disable(),this._cursorLayer&&this._cursorLayer.remove(),delete this._treePoints,delete this._treeLines,delete this._cursorLayer,delete this._assistLayers,delete this._mousePoint,delete this._geosSetPoint,delete this._geosSetLine,delete this._cursor,delete this._adsorbPoint,delete this._drawTool,delete this._map},F.prototype._addTo=function(t){this._map=t,this._newCursorLayer(),this._saveAdsorbLayers()},F.prototype._newCursorLayer=function(){this._cursorLayer=new n.VectorLayer(tr,{style:{symbol:this._getCursorSymbol()}}),this._cursorLayer.addTo(this._map).bringToFront()},F.prototype._getCursorSymbol=function(t){return Object.assign({markerType:"ellipse",markerFill:"#fff",markerLineColor:"#272822",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:.4},t)},F.prototype._saveAdsorbLayers=function(){var e=this;this._assistLayers=[],this.options.layers.forEach(function(t){(t="string"==typeof t?e._map.getLayer(t):t)instanceof n.VectorLayer&&e._assistLayers.push(t)})},F.prototype._enable=function(){this._isEnable=!0,this._cursorLayer&&this._cursorLayer.show(),this._updateGeosSet(),this._registerMapEvents(),this._geometry?this._registerGeometryEvents():this._registerDrawToolEvents()},F.prototype._updateGeosSet=function(){this._geosSetPoint=[],this._geosSetLine=[];var t=this._getAllAssistGeos();["auto","vertux"].includes(this.options.mode)&&(this._geosSetPoint=this._parseToPoints(t)),["auto","border"].includes(this.options.mode)&&(this._geosSetLine=this._parseToLines(t)),this._updateRBushTree()},F.prototype._getAllAssistGeos=function(){var t=this._assistLayers.reduce(function(t,e){return t.concat(e.getGeometries())},[]);return t=this._geometry?le(t,[this._geometry]):t},F.prototype._parseToPoints=function(t){var e=this,r=[];return t.forEach(function(t){r=(t instanceof n.GeometryCollection||(t instanceof n.Circle||t instanceof n.Ellipse)&&((t=t.copy()).setOptions(Object.assign(t.options||{},{numberOfShellPoints:e.options.shellPoints})),r.push(e._getCenterFeature(t))),r.concat(V(t.toGeoJSON()).features))}),r},F.prototype._getCenterFeature=function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.getCenter().toArray()},properties:{}}},F.prototype._parseToLines=function(t){var e=this,r=[];return(t=t.filter(function(t){return!(t instanceof n.Marker||t instanceof n.MultiPoint)})).forEach(function(t){t instanceof n.LineString?r.push(t.toGeoJSON()):r=t instanceof n.MultiLineString?r.concat(K(t.toGeoJSON()).features):((t instanceof n.Circle||t instanceof n.Ellipse)&&(t=t.copy()).setOptions(Object.assign(t.options||{},{numberOfShellPoints:e.options.shellPoints})),r.concat(e._polygonToLine(t.toGeoJSON())))}),this._splitLines(r)},F.prototype._polygonToLine=function(t){t=St(t);return"Feature"===t.type?K(t).features:t.features.reduce(function(t,e){return t.concat(K(e).features)},[])},F.prototype._splitLines=function(t){return t.reduce(function(t,e){for(var r=e.geometry.coordinates,n=0;n<r.length-1;n++){var o=[r[n],r[n+1]];t.push({type:"Feature",geometry:{type:"LineString",coordinates:o},properties:{}})}return t},[])},F.prototype._updateRBushTree=function(){this._treePoints.clear(),this._treePoints.load({type:"FeatureCollection",features:this._geosSetPoint}),this._treeLines.clear(),this._treeLines.load({type:"FeatureCollection",features:this._geosSetLine})},F.prototype._registerMapEvents=function(){this._needFindGeometry=!this._geometry,this._map.on("mousedown",this._mapMousedown,this),this._map.on("mouseup",this._mapMouseup,this),this._map.on("mousemove",this._mapMousemove,this)},F.prototype._mapMousedown=function(){this._geometry&&(this._needFindGeometry=!0)},F.prototype._mapMouseup=function(){this._geometry&&(this._needFindGeometry=!1)},F.prototype._mapMousemove=function(t){var e=t.coordinate,t=t.domEvent;this._mousePoint=e,this._cursor?this._cursor.setCoordinates(e):(this._cursor=new n.Marker(e),this._cursor.addTo(this._cursorLayer)),delete this._adsorbPoint,this.options.needCtrl===t.ctrlKey&&this._updateAdsorbPoint(e)},F.prototype._updateAdsorbPoint=function(t){var e;this._needFindGeometry?(0<(t=this._findGeometry(t)).length&&(this._adsorbPoint=this._getAdsorbPoint(t)),this._adsorbPoint?(e=(t=this._adsorbPoint).x,t=t.y,this._cursor.setCoordinates([e,t])):this._cursor.setSymbol(this._getCursorSymbol())):this._cursor.setSymbol(this._getCursorSymbol())},F.prototype._findGeometry=function(t){var e,r=[];return 0<this._geosSetPoint.length&&(e=this._findAvailGeos(this._treePoints,t),r=r.concat(e)),0<this._geosSetLine.length&&(e=this._findAvailGeos(this._treeLines,t),r=r.concat(e)),r},F.prototype._findAvailGeos=function(t,e){e=this._createInspectExtent(e);return t.search(e).features},F.prototype._createInspectExtent=function(t){var e=this._map.pixelToDistance(0,this.options.distance);return new n.Circle(t,e,{properties:{},numberOfShellPoints:this.options.shellPoints}).toGeoJSON()},F.prototype._getAdsorbPoint=function(t){var e=void 0,r=[this._mousePoint.x,this._mousePoint.y],n=t.filter(function(t){return"Point"===t.geometry.type}),t=(0<n.length?(e=this._getNearestPoint(r,n),this._cursor.setSymbol(this._getCursorSymbol({markerFill:"#f5871f",markerLineColor:"#0078a8",opacity:1}))):(n=t.filter(function(t){return"LineString"===t.geometry.type}),e=this._getNearestPointOnLine(r,n),this._cursor.setSymbol(this._getCursorSymbol({markerLineColor:"#0078a8",opacity:1}))),e.geometry.coordinates);return{x:t[0],y:t[1]}},F.prototype._getNearestPoint=function(t,e){var r=t,t={type:"FeatureCollection",features:e};if(!r)throw new Error("targetPoint is required");if(!t)throw new Error("points is required");var n=1/0,o=0;return g(t,function(t,e){t=v(r,t);t<n&&(o=e,n=t)}),(t=Z(t.features[o])).properties.featureIndex=o,t.properties.distanceToPoint=n,t},F.prototype._getNearestPointOnLine=function(t,e){var n;return n={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},g({type:"FeatureCollection",features:e},function(t){var e,r;switch(null==(r=t.geometry)?void 0:r.type){case"Point":n.MultiPoint.coordinates.push(t.geometry.coordinates),n.MultiPoint.properties.push(t.properties);break;case"MultiPoint":(e=n.MultiPoint.coordinates).push.apply(e,t.geometry.coordinates),n.MultiPoint.properties.push(t.properties);break;case"LineString":n.MultiLineString.coordinates.push(t.geometry.coordinates),n.MultiLineString.properties.push(t.properties);break;case"MultiLineString":(e=n.MultiLineString.coordinates).push.apply(e,t.geometry.coordinates),n.MultiLineString.properties.push(t.properties);break;case"Polygon":n.MultiPolygon.coordinates.push(t.geometry.coordinates),n.MultiPolygon.properties.push(t.properties);break;case"MultiPolygon":(e=n.MultiPolygon.coordinates).push.apply(e,t.geometry.coordinates),n.MultiPolygon.properties.push(t.properties)}}),Mt(_(Object.keys(n).filter(function(t){return n[t].coordinates.length}).sort().map(function(t){return p({type:t,coordinates:n[t].coordinates},{collectedProperties:n[t].properties})})),t)},F.prototype._registerGeometryEvents=function(){this._dragCenterHandle=null,this._geometry.on("handledragend",this._checkCenter,this),this._geometry.on("shapechange",this._setShadowCoordinates,this),this._geometry.on("editrecord",this._resetShadowCenter,this)},F.prototype._checkCenter=function(){this._dragCenterHandle=!this._shapechange},F.prototype._setShadowCoordinates=function(t){this._shapechange=!0,this._adsorbPoint&&((t=t.target)instanceof n.Circle?this._setShadowCircle(t):t instanceof n.Ellipse?this._setShadowEllipse(t):this._draggingCenter()||(t instanceof n.LineString?this._setShadowLineString(t):this._setShadowPolygon(t)))},F.prototype._draggingCenter=function(){return!(null===this._dragCenterHandle||n.Util.isNil(this._dragCenterHandle))},F.prototype._setShadowCircle=function(t){var e=this._calcCircleRadius(t);t._editor._shadow.setRadius(e)},F.prototype._calcCircleRadius=function(t){t=t.getCoordinates();return this._map.getProjection().measureLength([t,this._adsorbPoint])},F.prototype._setShadowEllipse=function(t){var e=this._calcEllipseSize(t),r=e[0],e=e[1];t._editor._shadow.setWidth(r).setHeight(e)},F.prototype._calcEllipseSize=function(t){var t=t.getCoordinates(),e=this._adsorbPoint,r=e.x,e=e.y;return[2*this._map.getProjection().measureLength([t,{x:r,y:t.y}]),2*this._map.getProjection().measureLength([t,{x:t.x,y:e}])]},F.prototype._setShadowLineString=function(t){var e=t.getCoordinates(),r=this._geometryCoords,r=We(e,r,He);0!==r.length&&(e[Ve(e,r[0])]=this._adsorbPoint,t._editor._shadow.setCoordinates(e))},F.prototype._setShadowPolygon=function(t){var e=t.getCoordinates();if(1<e.length)return this._setShadowPolygonWithHoles(t);var r=this._geometryCoords[0],n=e[0],r=We(n,r,He);0!==r.length&&(r=Ve(n,r[0]),e[0][r]=this._adsorbPoint,0===r&&(e[0][n.length-1]=this._adsorbPoint),t._editor._shadow.setCoordinates(e))},F.prototype._setShadowPolygonWithHoles=function(t){console.log(t)},F.prototype._resetShadowCenter=function(t){delete this._shapechange;var e,r,t=t.target;this._adsorbPoint&&(t instanceof n.Marker?t.setCoordinates(this._adsorbPoint):this._dragCenterHandle&&(e=t.getCenter(),r=[(r=this._adsorbPoint).x-e.x,r.y-e.y],t.translate.apply(t,r),(e=t._editor._shadow).translate.apply(e,r))),this._geometryCoords=t.getCoordinates(),delete this._dragCenterHandle},F.prototype._registerDrawToolEvents=function(){this._drawTool.on("drawstart drawvertex",this._resetCoordsAndPoint,this),this._drawTool.on("mousemove drawend",this._resetCoordinates,this)},F.prototype._resetCoordsAndPoint=function(t){this._resetCoordinates(t),this._resetClickPoint(t)},F.prototype._resetCoordinates=function(t){if(this._adsorbPoint){var e=t.target,r=e.options.mode,n=e._geometry;switch(r){case"Point":n.setCoordinates(this._adsorbPoint);break;case"Rectangle":this._resetRectangle(n,t);break;case"Circle":"drawstart"===t.type?n.setCoordinates(this._adsorbPoint):this._resetCircle(n);break;case"Ellipse":"drawstart"===t.type?n.setCoordinates(this._adsorbPoint):this._resetEllipse(n);break;default:this._resetCommon(n)}}},F.prototype._resetRectangle=function(t,e){var r,n=t.getCoordinates(),o=this._adsorbPoint,i=o.x,o=o.y;0===n[0].length?(r=this._map.coordinateToPoint(this._adsorbPoint),e.geometry._firstClick=this._map._pointToPrj(r)):(n[0][1].x=i,n[0][2].x=i,n[0][2].y=o,n[0][3].y=o,t.setCoordinates(n))},F.prototype._resetCircle=function(t){var e=this._calcCircleRadius(t);t.setRadius(e)},F.prototype._resetEllipse=function(t){var e=this._calcEllipseSize(t),r=e[0],e=e[1];t.setWidth(r).setHeight(e)._updateCache()},F.prototype._resetCommon=function(t){var e=t.getCoordinates();e.pop(),e.push(this._adsorbPoint),t.setCoordinates(e)},F.prototype._resetClickPoint=function(t){var e;this._adsorbPoint&&(t=t.target._clickCoords,e=this._map.coordToPoint(this._adsorbPoint),t.pop(),t.push(this._map._pointToPrj(e)))},F.prototype._disable=function(){this._isEnable=!1,this._cursorLayer&&this._cursorLayer.hide(),this._offMapEvents(),this._geometry?this._offGeometryEvents():this._offDrawToolEvents(),this._resetGeosSet(),delete this._geometry},F.prototype._offMapEvents=function(){delete this._needFindGeometry,this._map.off("mousedown",this._mapMousedown,this),this._map.off("mousemove",this._mapMousemove,this),this._map.off("mouseup",this._mapMouseup,this)},F.prototype._offGeometryEvents=function(){this._geometry.off("handledragend",this._checkCenter,this),this._geometry.off("shapechange",this._setShadowCoordinates,this),this._geometry.off("editrecord",this._resetShadowCenter,this)},F.prototype._offDrawToolEvents=function(){this._drawTool.off("drawstart drawvertex",this._resetCoordsAndPoint,this),this._drawTool.off("mousemove drawend",this._resetCoordinates,this)},F.prototype._resetGeosSet=function(){this._geosSetPoint=[],this._geosSetLine=[]},F.prototype._disableMapTool=function(){this._map._map_tool&&this._map._map_tool.disable()},F);function F(t){if(!(this instanceof F))throw new TypeError("Cannot call a class as a function");t=function(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,Ze.call(this,t));return t._isEnable=!1,t._treePoints=wt(),t._treeLines=wt(),t}t.mergeOptions({layers:[],mode:"auto",distance:10,shellPoints:60,needCtrl:!1}),T.Autoadsorb=t,Object.defineProperty(T,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.autoadsorb v0.4.0, requires maptalks@>=0.46.0.")});