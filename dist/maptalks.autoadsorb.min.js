/*!
 * maptalks.autoadsorb v1.0.0-alpha.3
 * LICENSE : MIT
 * (c) 2016-2022 maptalks.org
 */
/*!
 * requires maptalks@>=0.46.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(T,n){"use strict";var B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t=6371008.8,G={centimeters:100*t,centimetres:100*t,degrees:t/111325,feet:3.28084*t,inches:39.37*t,kilometers:t/1e3,kilometres:t/1e3,meters:t,metres:t,miles:t/1609.344,millimeters:1e3*t,millimetres:1e3*t,nauticalmiles:t/1852,radians:1,yards:1.0936*t},X={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function p(t,e,r){var n={type:"Feature"};return 0!==(r=void 0===r?{}:r).id&&!r.id||(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function d(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(D(t[0])&&D(t[1]))return p({type:"Point",coordinates:t},e,r);throw new Error("coordinates must contain numbers")}function Y(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return p({type:"Polygon",coordinates:t},e,r)}function y(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return p({type:"LineString",coordinates:t},e,r)}function _(t,e){var r={type:"FeatureCollection"};return(e=void 0===e?{}:e).id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function R(t,e,r){return p({type:"MultiLineString",coordinates:t},e,r=void 0===r?{}:r)}function z(t,e,r){return p({type:"MultiPoint",coordinates:t},e,r=void 0===r?{}:r)}function I(t,e,r){return p({type:"MultiPolygon",coordinates:t},e,r=void 0===r?{}:r)}function $(t,e){var r=G[e=void 0===e?"kilometers":e];if(r)return t*r;throw new Error(e+" units is invalid")}function N(t,e){var r=G[e=void 0===e?"kilometers":e];if(r)return t/r;throw new Error(e+" units is invalid")}function a(t){return 180*(t%(2*Math.PI))/Math.PI}function s(t){return t%360*Math.PI/180}function D(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function q(t){return!!t&&t.constructor===Object}t=Object.freeze({earthRadius:t,factors:G,unitsFactors:{centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t,yards:1.0936133},areaFactors:X,feature:p,geometry:function(t,e,r){switch(void 0===r&&(r={}),t){case"Point":return d(e).geometry;case"LineString":return y(e).geometry;case"Polygon":return Y(e).geometry;case"MultiPoint":return z(e).geometry;case"MultiLineString":return R(e).geometry;case"MultiPolygon":return I(e).geometry;default:throw new Error(t+" is invalid")}},point:d,points:function(t,e,r){return void 0===r&&(r={}),_(t.map(function(t){return d(t,e)}),r)},polygon:Y,polygons:function(t,e,r){return void 0===r&&(r={}),_(t.map(function(t){return Y(t,e)}),r)},lineString:y,lineStrings:function(t,e,r){return void 0===r&&(r={}),_(t.map(function(t){return y(t,e)}),r)},featureCollection:_,multiLineString:R,multiPoint:z,multiPolygon:I,geometryCollection:function(t,e,r){return p({type:"GeometryCollection",geometries:t},e,r=void 0===r?{}:r)},round:function(t,e){if(!(e=void 0===e?0:e)||0<=e)return e=Math.pow(10,e||0),Math.round(t*e)/e;throw new Error("precision must be a positive number")},radiansToLength:$,lengthToRadians:N,lengthToDegrees:function(t,e){return a(N(t,e))},bearingToAzimuth:function(t){return(t%=360)<0&&(t+=360),t},radiansToDegrees:a,degreesToRadians:s,convertLength:function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),0<=t)return $(N(t,e),r);throw new Error("length must be a positive number")},convertArea:function(t,e,r){if(void 0===e&&(e="meters"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("area must be a positive number");if(!(e=X[e]))throw new Error("invalid original units");if(r=X[r])return t/e*r;throw new Error("invalid final units")},isNumber:D,isObject:q,validateBBox:function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!D(t))throw new Error("bbox must only contain numbers")})},validateId:function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(void 0===t?"undefined":B(t)))throw new Error("id must be a number or a string")}});function S(t,e,r){if(null!==t)for(var n,o,i,a=0,s=t.type,u="FeatureCollection"===s,c="Feature"===s,l=u?t.features.length:1,f=0;f<l;f++)for(var h,p,d=(p=!!(h=u?t.features[f].geometry:c?t.geometry:t)&&"GeometryCollection"===h.type)?h.geometries.length:1,y=0;y<d;y++){var _=0,g=0,v=p?h.geometries[y]:h;if(null!==v){var m=v.coordinates,b=v.type,w=!r||"Polygon"!==b&&"MultiPolygon"!==b?0:1;switch(b){case null:break;case"Point":if(!1===e(m,a,f,_,g))return!1;a++,_++;break;case"LineString":case"MultiPoint":for(n=0;n<m.length;n++){if(!1===e(m[n],a,f,_,g))return!1;a++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(n=0;n<m.length;n++){for(o=0;o<m[n].length-w;o++){if(!1===e(m[n][o],a,f,_,g))return!1;a++}"MultiLineString"===b&&_++,"Polygon"===b&&g++}"Polygon"===b&&_++;break;case"MultiPolygon":for(n=0;n<m.length;n++){for(o=g=0;o<m[n].length;o++){for(i=0;i<m[n][o].length-w;i++){if(!1===e(m[n][o][i],a,f,_,g))return!1;a++}g++}_++}break;case"GeometryCollection":for(n=0;n<v.geometries.length;n++)if(!1===S(v.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}function J(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function g(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function U(t,e){for(var r,n,o,i,a,s,u,c,l,f=0,h="FeatureCollection"===t.type,p="Feature"===t.type,d=h?t.features.length:1,y=0;y<d;y++){for(a=h?t.features[y].geometry:p?t.geometry:t,u=h?t.features[y].properties:p?t.properties:{},c=h?t.features[y].bbox:p?t.bbox:void 0,l=h?t.features[y].id:p?t.id:void 0,i=(s=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<i;n++)if(null===(o=s?a.geometries[n]:a)){if(!1===e(null,f,u,c,l))return!1}else switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,f,u,c,l))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],f,u,c,l))return!1;break;default:throw new Error("Unknown Geometry Type")}f++}}function r(t,c){U(t,function(t,e,r,n,o){var i,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1===c(p(t,r,{bbox:n,id:o}),e,0)?!1:void 0}switch(a){case"MultiPoint":i="Point";break;case"MultiLineString":i="LineString";break;case"MultiPolygon":i="Polygon"}for(var s=0;s<t.coordinates.length;s++){var u=t.coordinates[s];if(!1===c(p({type:i,coordinates:u},r),e,s))return!1}})}function H(t,p){r(t,function(i,a,s){var u=0;if(i.geometry){var c,l,f,h,t=i.geometry.type;if("Point"!==t&&"MultiPoint"!==t)return h=f=l=0,!1!==S(i,function(t,e,r,n,o){return void 0===c||l<a||f<n||h<o?(c=t,l=a,f=n,h=o,void(u=0)):(n=y([c,t],i.properties),!1!==p(n,a,s,o,u)&&(u++,void(c=t)))})&&void 0}})}function W(t,a){if(!t)throw new Error("geojson is required");r(t,function(t,e,r){if(null!==t.geometry){var n=t.geometry.type,o=t.geometry.coordinates;switch(n){case"LineString":if(!1===a(t,e,r,0,0))return!1;break;case"Polygon":for(var i=0;i<o.length;i++)if(!1===a(y(o[i],t.properties),e,r,i))return!1}}})}var e=Object.freeze({coordAll:function(t){var e=[];return S(t,function(t){e.push(t)}),e},coordEach:S,coordReduce:function(t,i,a,e){var s=a;return S(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)},e),s},featureEach:g,featureReduce:function(t,r,n){var o=n;return g(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},findPoint:function(t,e){if(!q(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return d(u,s,e);case"MultiPoint":return d(u[o=o<0?u.length+o:o],s,e);case"LineString":return d(u[a=a<0?u.length+a:a],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),d(u[i][a],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a),d(u[o][a],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a),d(u[o][i][a],s,e)}throw new Error("geojson is invalid")},findSegment:function(t,e){if(!q(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return y([u[a=a<0?u.length+a-1:a],u[a+1]],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a-1),y([u[i][a],u[i][a+1]],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a-1),y([u[o][a],u[o][a+1]],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a-1),y([u[o][i][a],u[o][i][a+1]],s,e)}throw new Error("geojson is invalid")},flattenEach:r,flattenReduce:function(t,n,o){var i=o;return r(t,function(t,e,r){i=0===e&&0===r&&void 0===o?t:n(i,t,e,r)}),i},geomEach:U,geomReduce:function(t,i,a){var s=a;return U(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)}),s},lineEach:W,lineReduce:function(t,o,i){var a=i;return W(t,function(t,e,r,n){a=0===e&&void 0===i?t:o(a,t,e,r,n)}),a},propEach:J,propReduce:function(t,r,n){var o=n;return J(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},segmentEach:H,segmentReduce:function(t,i,a){var s=a,u=!1;return H(t,function(t,e,r,n,o){s=!1===u&&void 0===a?t:i(s,t,e,r,n,o),u=!0}),s}});function V(e){var r=[];return"FeatureCollection"===e.type?g(e,function(e){S(e,function(t){r.push(d(t,e.properties))})}):S(e,function(t){r.push(d(t,e.properties))}),_(r)}function K(t){if(!t)throw new Error("geojson is required");var e=[];return r(t,function(t){e.push(t)}),_(e)}var Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function Z(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return tt(t);case"FeatureCollection":return e=t,r={type:"FeatureCollection"},Object.keys(e).forEach(function(t){switch(t){case"type":case"features":return;default:r[t]=e[t]}}),r.features=e.features.map(tt),r;case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return et(t);default:throw new Error("unknown GeoJSON type")}var e,r}function tt(e){var r={type:"Feature"};return Object.keys(e).forEach(function(t){switch(t){case"type":case"properties":case"geometry":return;default:r[t]=e[t]}}),r.properties=function r(n){var o={};if(!n)return o;Object.keys(n).forEach(function(t){var e=n[t];"object"===(void 0===e?"undefined":Q(e))?null===e?o[t]=null:Array.isArray(e)?o[t]=e.map(function(t){return t}):o[t]=r(e):o[t]=e});return o}(e.properties),r.geometry=et(e.geometry),r}function et(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?e.geometries=t.geometries.map(et):e.coordinates=function e(t){if("object"!==Q(t[0]))return t.slice();return t.map(function(t){return e(t)})}(t.coordinates),e}function u(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&2<=t.length&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function v(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function rt(t){return"Feature"===t.type?t.geometry:t}function m(t,e,r){void 0===r&&(r={});var t=u(t),e=u(e),n=s(e[1]-t[1]),o=s(e[0]-t[0]),t=s(t[1]),e=s(e[1]),n=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(t)*Math.cos(e);return $(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),r.units)}function nt(t,e,r){if(!0===(r=void 0===r?{}:r).final)return(nt(e,t)+180)%360;var r=u(t),t=u(e),e=s(r[0]),n=s(t[0]),r=s(r[1]),t=s(t[1]),o=Math.sin(n-e)*Math.cos(t),r=Math.cos(r)*Math.sin(t)-Math.sin(r)*Math.cos(t)*Math.cos(n-e);return a(Math.atan2(o,r))}function ot(t,e,r,n){void 0===n&&(n={});var t=u(t),o=s(t[0]),t=s(t[1]),r=s(r),e=N(e,n.units),i=Math.asin(Math.sin(t)*Math.cos(e)+Math.cos(t)*Math.sin(e)*Math.cos(r));return d([a(o+Math.atan2(Math.sin(r)*Math.sin(e)*Math.cos(t),Math.cos(e)-Math.sin(t)*Math.sin(i))),a(i)],n.properties)}function it(t){if(!t)throw new Error("geojson is required");var i=[];return r(t,function(t){var e=t,r=i,n=[],o=e.geometry;if(null!==o){switch(o.type){case"Polygon":n=v(o);break;case"LineString":n=[v(o)]}n.forEach(function(t){var a,s;a=e.properties,s=[],t.reduce(function(t,e){var r,n,o,i=y([t,e],a);return i.bbox=(r=e,n=(t=t)[0],t=t[1],o=r[0],r=r[1],[n<o?n:o,t<r?t:r,o<n?n:o,r<t?t:r]),s.push(i),e}),s.forEach(function(t){t.id=r.length,r.push(t)})})}}),_(i)}function at(t,e,r,n,o){!function t(e,r,n,o,i){for(;n<o;){600<o-n&&(a=o-n+1,l=r-n+1,u=Math.log(a),s=.5*Math.exp(2*u/3),u=.5*Math.sqrt(u*s*(a-s)/a)*(l-a/2<0?-1:1),c=Math.max(n,Math.floor(r-l*s/a+u)),l=Math.min(o,Math.floor(r+(a-l)*s/a+u)),t(e,r,c,l,i));var a,s,u,c,l,f=e[r],h=n,p=o;for(b(e,n,r),0<i(e[o],f)&&b(e,n,o);h<p;){for(b(e,h,p),h++,p--;i(e[h],f)<0;)h++;for(;0<i(e[p],f);)p--}0===i(e[n],f)?b(e,n,p):b(e,++p,o),p<=r&&(n=p+1),r<=p&&(o=p-1)}}(t,e,r||0,n||t.length-1,o||st)}function b(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function st(t,e){return t<e?-1:e<t?1:0}i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(t){var e=this.data,r=[];if(!dt(t,e))return r;for(var n=this.toBBox,o=[];e;){for(var i=0;i<e.children.length;i++){var a=e.children[i],s=e.leaf?n(a):a;dt(t,s)&&(e.leaf?r.push(a):pt(t,s)?this._all(a,r):o.push(a))}e=o.pop()}return r},i.prototype.collides=function(t){var e=this.data;if(!dt(t,e))return!1;for(var r=[];e;){for(var n=0;n<e.children.length;n++){var o=e.children[n],i=e.leaf?this.toBBox(o):o;if(dt(t,i)){if(e.leaf||pt(t,i))return!0;r.push(o)}}e=r.pop()}return!1},i.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var r,n=this._build(t.slice(),0,t.length-1,0);return this.data.children.length?this.data.height===n.height?this._splitRoot(this.data,n):(this.data.height<n.height&&(r=this.data,this.data=n,n=r),this._insert(n,this.data.height-n.height-1,!0)):this.data=n,this},i.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},i.prototype.clear=function(){return this.data=M([]),this},i.prototype.remove=function(t,e){if(!t)return this;for(var r=this.data,n=this.toBBox(t),o=[],i=[],a=void 0,s=void 0,u=void 0;r||o.length;){if(r||(r=o.pop(),s=o[o.length-1],a=i.pop(),u=!0),r.leaf){var c=function(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}(t,r.children,e);if(-1!==c)return r.children.splice(c,1),o.push(r),this._condense(o),this}u||r.leaf||!pt(r,n)?s?(a++,r=s.children[a],u=!1):r=null:(o.push(r),i.push(a),r=(s=r).children[a=0])}return this},i.prototype.toBBox=function(t){return t},i.prototype.compareMinX=function(t,e){return t.minX-e.minX},i.prototype.compareMinY=function(t,e){return t.minY-e.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(t){return this.data=t,this},i.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},i.prototype._build=function(t,e,r,n){var o=r-e+1,i=this._maxEntries,a=void 0;if(o<=i)return w(a=M(t.slice(e,r+1)),this.toBBox),a;n||(n=Math.ceil(Math.log(o)/Math.log(i)),i=Math.ceil(o/Math.pow(i,n-1))),(a=M([])).leaf=!1,a.height=n;var s=Math.ceil(o/i),u=s*Math.ceil(Math.sqrt(i));yt(t,e,r,u,this.compareMinX);for(var c=e;c<=r;c+=u){var l=Math.min(c+u-1,r);yt(t,c,l,s,this.compareMinY);for(var f=c;f<=l;f+=s){var h=Math.min(f+s-1,l);a.children.push(this._build(t,f,h,n-1))}}return w(a,this.toBBox),a},i.prototype._chooseSubtree=function(t,e,r,n){for(;;){if(n.push(e),e.leaf||n.length-1===r)break;for(var o=1/0,i=1/0,a=void 0,s=0;s<e.children.length;s++){var u=e.children[s],c=ft(u),l=(f=t,l=u,(Math.max(l.maxX,f.maxX)-Math.min(l.minX,f.minX))*(Math.max(l.maxY,f.maxY)-Math.min(l.minY,f.minY))-c);l<i?(i=l,o=c<o?c:o,a=u):l===i&&c<o&&(o=c,a=u)}e=a||e.children[0]}var f,l;return e},i.prototype._insert=function(t,e,r){var r=r?t:this.toBBox(t),n=[],o=this._chooseSubtree(r,this.data,e,n);for(o.children.push(t),ut(o,r);0<=e&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},i.prototype._split=function(t,e){var r=t[e],n=r.children.length,o=this._minEntries,o=(this._chooseSplitAxis(r,o,n),this._chooseSplitIndex(r,o,n)),n=M(r.children.splice(o,r.children.length-o));n.height=r.height,n.leaf=r.leaf,w(r,this.toBBox),w(n,this.toBBox),e?t[e-1].children.push(n):this._splitRoot(r,n)},i.prototype._splitRoot=function(t,e){this.data=M([t,e]),this.data.height=t.height+1,this.data.leaf=!1,w(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(t,e,r){for(var n,o,i,a=void 0,s=1/0,u=1/0,c=e;c<=r-e;c++){var l=P(t,0,c,this.toBBox),f=P(t,c,r,this.toBBox),h=(n=l,h=f,p=i=o=void 0,o=Math.max(n.minX,h.minX),i=Math.max(n.minY,h.minY),p=Math.min(n.maxX,h.maxX),n=Math.min(n.maxY,h.maxY),Math.max(0,p-o)*Math.max(0,n-i)),p=ft(l)+ft(f);h<s?(s=h,a=c,u=p<u?p:u):h===s&&p<u&&(u=p,a=c)}return a||r-e},i.prototype._chooseSplitAxis=function(t,e,r){var n=t.leaf?this.compareMinX:ct,o=t.leaf?this.compareMinY:lt;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,o)&&t.children.sort(n)},i.prototype._allDistMargin=function(t,e,r,n){t.children.sort(n);for(var o=this.toBBox,i=P(t,0,e,o),a=P(t,r-e,r,o),s=ht(i)+ht(a),u=e;u<r-e;u++){var c=t.children[u];ut(i,t.leaf?o(c):c),s+=ht(i)}for(var l=r-e-1;e<=l;l--){var f=t.children[l];ut(a,t.leaf?o(f):f),s+=ht(a)}return s},i.prototype._adjustParentBBoxes=function(t,e,r){for(var n=r;0<=n;n--)ut(e[n],t)},i.prototype._condense=function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():w(t[r],this.toBBox)};var o=i;function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:9,e=this,r=i;if(!(e instanceof r))throw new TypeError("Cannot call a class as a function");this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}function w(t,e){P(t,0,t.children.length,e,t)}function P(t,e,r,n,o){(o=o||M(null)).minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i=e;i<r;i++){var a=t.children[i];ut(o,t.leaf?n(a):a)}return o}function ut(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function ct(t,e){return t.minX-e.minX}function lt(t,e){return t.minY-e.minY}function ft(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ht(t){return t.maxX-t.minX+(t.maxY-t.minY)}function pt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function dt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function M(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function yt(t,e,r,n,o){for(var i,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(at(t,i=e+Math.ceil((r-e)/n/2)*n,e,r,o),a.push(e,i,i,r))}var c=Object.freeze({default:o});function _t(t){var e=[1/0,1/0,-1/0,-1/0];return S(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}_t.default=_t;var l=Object.freeze({default:_t}),f=c&&o,h=(l&&_t).default,gt=e.featureEach,vt=t.featureCollection;function mt(t){t=new f(t);return t.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox||h(t),f.prototype.insert.call(this,t)},t.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox||h(t),e.push(t)}):gt(t,function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox||h(t),e.push(t)}),f.prototype.load.call(this,e)},t.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox||h(t),f.prototype.remove.call(this,t,e)},t.clear=function(){return f.prototype.clear.call(this)},t.search=function(t){t=f.prototype.search.call(this,this.toBBox(t));return vt(t)},t.collides=function(t){return f.prototype.collides.call(this,this.toBBox(t))},t.all=function(){var t=f.prototype.all.call(this);return vt(t)},t.toJSON=function(){return f.prototype.toJSON.call(this)},t.fromJSON=function(t){return f.prototype.fromJSON.call(this,t)},t.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=h(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=h(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},t}var bt=mt;function wt(t,e){t=v(t),e=v(e);if(2!==t.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==e.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=t[0][0],n=t[0][1],o=t[1][0],t=t[1][1],i=e[0][0],a=e[0][1],s=e[1][0],e=e[1][1],u=(e-a)*(o-r)-(s-i)*(t-n),s=(s-i)*(n-a)-(e-a)*(r-i),e=(o-r)*(n-a)-(t-n)*(r-i);if(0==u)return null;a=s/u,i=e/u;return 0<=a&&a<=1&&0<=i&&i<=1?d([r+a*(o-r),n+a*(t-n)]):null}function St(t,c,l){void 0===l&&(l={});var f=d([1/0,1/0],{dist:1/0}),h=0;return r(t,function(t){for(var e=v(t),r=0;r<e.length-1;r++){var n=d(e[r]),o=(n.properties.dist=m(c,n,l),d(e[r+1])),i=(o.properties.dist=m(c,o,l),m(n,o,l)),a=Math.max(n.properties.dist,o.properties.dist),s=nt(n,o),u=ot(c,a,s+90,l),a=ot(c,a,s-90,l),s=function(t,e){var r,n={},o=[];if("LineString"===t.type&&(t=p(t)),"LineString"===e.type&&(e=p(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length)return(r=wt(t,e))&&o.push(r),_(o);var i=bt();return i.load(it(e)),g(it(t),function(r){g(i.search(r),function(t){var e,t=wt(r,t);t&&(e=v(t).join(","),n[e]||(n[e]=!0,o.push(t)))})}),_(o)}(y([u.geometry.coordinates,a.geometry.coordinates]),y([n.geometry.coordinates,o.geometry.coordinates])),u=null;0<s.features.length&&((u=s.features[0]).properties.dist=m(c,u,l),u.properties.location=h+m(n,u,l)),n.properties.dist<f.properties.dist&&((f=n).properties.index=r,f.properties.location=h),o.properties.dist<f.properties.dist&&((f=o).properties.index=r+1,f.properties.location=h+i),u&&u.properties.dist<f.properties.dist&&((f=u).properties.index=r),h+=i}}),f}bt.default=mt;function Pt(t,e){void 0===e&&(e={});var r,n,o,i,a,s=rt(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),s.type){case"Polygon":return void 0===(i=e)&&(i={}),a=rt(o=s).coordinates,i=i.properties||("Feature"===o.type?o.properties:{}),Mt(a,i);case"MultiPolygon":return void 0===(o=e)&&(o={}),i=rt(a=s).coordinates,r=o.properties||("Feature"===a.type?a.properties:{}),n=[],i.forEach(function(t){n.push(Mt(t,r))}),_(n);default:throw new Error("invalid poly")}}function Mt(t,e){return 1<t.length?R(t,e):y(t[0],e)}var ne="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function jt(t,e){return t(e={exports:{}},e.exports),e.exports}var xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et="__lodash_hash_undefined__",Ct=9007199254740991,Ot="[object Arguments]",At="[object Function]",Lt="[object GeneratorFunction]",kt=/^\[object .+?Constructor\]$/,c="object"==xt(ne)&&ne&&ne.Object===Object&&ne,o="object"==("undefined"==typeof self?"undefined":xt(self))&&self&&self.Object===Object&&self,l=c||o||Function("return this")();function Ft(t,e){return!!(t?t.length:0)&&-1<function(t,e,r){if(e!=e)return function(t,e,r,n){var o=t.length,i=r+(n?1:-1);for(;n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,Bt,r);var n=r-1,o=t.length;for(;++n<o;)if(t[n]===e)return n;return-1}(t,e,0)}function Tt(t,e,r){for(var n=-1,o=t?t.length:0;++n<o;)if(r(e,t[n]))return!0;return!1}function Bt(t){return t!=t}function Gt(t,e){return t.has(e)}var e=Array.prototype,t=Function.prototype,c=Object.prototype,o=l["__core-js_shared__"],Xt=(o=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"",Yt=t.toString,Rt=c.hasOwnProperty,zt=c.toString,It=RegExp("^"+Yt.call(Rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),o=l.Symbol,$t=c.propertyIsEnumerable,Nt=e.splice,Dt=o?o.isConcatSpreadable:void 0,qt=Math.max,Jt=Zt(l,"Map"),Ut=Zt(Object,"create");function j(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function x(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function E(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Ht(t){var e=-1,r=t?t.length:0;for(this.__data__=new E;++e<r;)this.add(t[e])}function Wt(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}function Vt(t,e,r,n){var o,i=-1,a=Ft,s=!0,u=t.length,c=[],l=e.length;if(!u)return c;r&&(e=function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(e,(o=r,function(t){return o(t)}))),n?(a=Tt,s=!1):200<=e.length&&(a=Gt,s=!1,e=new Ht(e));t:for(;++i<u;){var f=t[i],h=r?r(f):f,f=n||0!==f?f:0;if(s&&h==h){for(var p=l;p--;)if(e[p]===h)continue t;c.push(f)}else a(e,h,n)||c.push(f)}return c}function Kt(t){var e;if(ce(t)&&(e=t,!(Xt&&Xt in e)))return(ue(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?It:kt).test(function(t){if(null!=t){try{return Yt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function Qt(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":xt(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function Zt(t,e){e=e;t=null==(t=t)?void 0:t[e];return Kt(t)?t:void 0}function te(t){return ie(t)||se(e=t)&&Rt.call(e,"callee")&&(!$t.call(e,"callee")||zt.call(e)==Ot)||!!(Dt&&t&&t[Dt]);var e}j.prototype.clear=function(){this.__data__=Ut?Ut(null):{}},j.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},j.prototype.get=function(t){var e,r=this.__data__;return Ut?(e=r[t])===Et?void 0:e:Rt.call(r,t)?r[t]:void 0},j.prototype.has=function(t){var e=this.__data__;return Ut?void 0!==e[t]:Rt.call(e,t)},j.prototype.set=function(t,e){return this.__data__[t]=Ut&&void 0===e?Et:e,this},x.prototype.clear=function(){this.__data__=[]},x.prototype.delete=function(t){var e=this.__data__;return!((t=Wt(e,t))<0)&&(t==e.length-1?e.pop():Nt.call(e,t,1),!0)},x.prototype.get=function(t){var e=this.__data__;return(t=Wt(e,t))<0?void 0:e[t][1]},x.prototype.has=function(t){return-1<Wt(this.__data__,t)},x.prototype.set=function(t,e){var r=this.__data__,n=Wt(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},E.prototype.clear=function(){this.__data__={hash:new j,map:new(Jt||x),string:new j}},E.prototype.delete=function(t){return Qt(this,t).delete(t)},E.prototype.get=function(t){return Qt(this,t).get(t)},E.prototype.has=function(t){return Qt(this,t).has(t)},E.prototype.set=function(t,e){return Qt(this,t).set(t,e),this},Ht.prototype.add=Ht.prototype.push=function(t){return this.__data__.set(t,Et),this},Ht.prototype.has=function(t){return this.__data__.has(t)};function ee(){for(var t=arguments,e=-1,r=qt(t.length-C,0),n=Array(r);++e<r;)n[e]=t[C+e];for(var e=-1,o=Array(C+1);++e<C;)o[e]=t[e];o[C]=n;var i=re,a=this,s=o;switch(s.length){case 0:return i.call(a);case 1:return i.call(a,s[0]);case 2:return i.call(a,s[0],s[1]);case 3:return i.call(a,s[0],s[1],s[2])}return i.apply(a,s)}var re,C;re=function(t,e){return se(t)?Vt(t,function t(e,r,n,o,i){var a=-1,s=e.length;for(n=n||te,i=i||[];++a<s;){var u=e[a];if(0<r&&n(u))if(1<r)t(u,r-1,n,o,i);else{p=h=f=l=c=void 0;for(var c=i,l=u,f=-1,h=l.length,p=c.length;++f<h;)c[p+f]=l[f]}else o||(i[i.length]=u)}return i}(e,1,se,!0)):[]},C=qt(void 0===C?re.length-1:C,0);var ie=Array.isArray;function ae(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=Ct)&&!ue(t);var e}function se(t){return!!(e=t)&&"object"==(void 0===e?"undefined":xt(e))&&ae(t);var e}function ue(t){t=ce(t)?zt.call(t):"";return t==At||t==Lt}function ce(t){var e=void 0===t?"undefined":xt(t);return t&&("object"==e||"function"==e)}var le=ee,fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he="__lodash_hash_undefined__",pe=9007199254740991,de="[object Arguments]",ye="[object Function]",_e="[object GeneratorFunction]",ge=/^\[object .+?Constructor\]$/,t="object"==fe(ne)&&ne&&ne.Object===Object&&ne,c="object"==("undefined"==typeof self?"undefined":fe(self))&&self&&self.Object===Object&&self,e=t||c||Function("return this")();function ve(t,e){return!!(t?t.length:0)&&-1<function(t,e,r){if(e!=e)return function(t,e,r,n){var o=t.length,i=r+(n?1:-1);for(;n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,be,r);var n=r-1,o=t.length;for(;++n<o;)if(t[n]===e)return n;return-1}(t,e,0)}function me(t,e,r){for(var n=-1,o=t?t.length:0;++n<o;)if(r(e,t[n]))return!0;return!1}function be(t){return t!=t}function we(t,e){return t.has(e)}var o=Array.prototype,l=Function.prototype,t=Object.prototype,c=e["__core-js_shared__"],Se=(c=/[^.]+$/.exec(c&&c.keys&&c.keys.IE_PROTO||""))?"Symbol(src)_1."+c:"",Pe=l.toString,Me=t.hasOwnProperty,je=t.toString,xe=RegExp("^"+Pe.call(Me).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),c=e.Symbol,Ee=t.propertyIsEnumerable,Ce=o.splice,Oe=c?c.isConcatSpreadable:void 0,Ae=Math.max,Le=Ye(e,"Map"),ke=Ye(Object,"create");function O(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function A(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function L(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Fe(t){var e=-1,r=t?t.length:0;for(this.__data__=new L;++e<r;)this.add(t[e])}function Te(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}function Be(t,e,r,n){var o,i=-1,a=ve,s=!0,u=t.length,c=[],l=e.length;if(!u)return c;r&&(e=function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(e,(o=r,function(t){return o(t)}))),n?(a=me,s=!1):200<=e.length&&(a=we,s=!1,e=new Fe(e));t:for(;++i<u;){var f=t[i],h=r?r(f):f,f=n||0!==f?f:0;if(s&&h==h){for(var p=l;p--;)if(e[p]===h)continue t;c.push(f)}else a(e,h,n)||c.push(f)}return c}function Ge(t){var e;if(Je(t)&&(e=t,!(Se&&Se in e)))return(qe(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?xe:ge).test(function(t){if(null!=t){try{return Pe.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function Xe(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":fe(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function Ye(t,e){e=e;t=null==(t=t)?void 0:t[e];return Ge(t)?t:void 0}function Re(t){return $e(t)||De(e=t)&&Me.call(e,"callee")&&(!Ee.call(e,"callee")||je.call(e)==de)||!!(Oe&&t&&t[Oe]);var e}O.prototype.clear=function(){this.__data__=ke?ke(null):{}},O.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},O.prototype.get=function(t){var e,r=this.__data__;return ke?(e=r[t])===he?void 0:e:Me.call(r,t)?r[t]:void 0},O.prototype.has=function(t){var e=this.__data__;return ke?void 0!==e[t]:Me.call(e,t)},O.prototype.set=function(t,e){return this.__data__[t]=ke&&void 0===e?he:e,this},A.prototype.clear=function(){this.__data__=[]},A.prototype.delete=function(t){var e=this.__data__;return!((t=Te(e,t))<0)&&(t==e.length-1?e.pop():Ce.call(e,t,1),!0)},A.prototype.get=function(t){var e=this.__data__;return(t=Te(e,t))<0?void 0:e[t][1]},A.prototype.has=function(t){return-1<Te(this.__data__,t)},A.prototype.set=function(t,e){var r=this.__data__,n=Te(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},L.prototype.clear=function(){this.__data__={hash:new O,map:new(Le||A),string:new O}},L.prototype.delete=function(t){return Xe(this,t).delete(t)},L.prototype.get=function(t){return Xe(this,t).get(t)},L.prototype.has=function(t){return Xe(this,t).has(t)},L.prototype.set=function(t,e){return Xe(this,t).set(t,e),this},Fe.prototype.add=Fe.prototype.push=function(t){return this.__data__.set(t,he),this},Fe.prototype.has=function(t){return this.__data__.has(t)};function ze(){for(var t=arguments,e=-1,r=Ae(t.length-k,0),n=Array(r);++e<r;)n[e]=t[k+e];for(var e=-1,o=Array(k+1);++e<k;)o[e]=t[e];o[k]=n;var i=Ie,a=this,s=o;switch(s.length){case 0:return i.call(a);case 1:return i.call(a,s[0]);case 2:return i.call(a,s[0],s[1]);case 3:return i.call(a,s[0],s[1],s[2])}return i.apply(a,s)}var Ie,k;Ie=function(t,e){var r,n=(r=(n=e)?n.length:0)?n[r-1]:void 0;return De(n)&&(n=void 0),De(t)?Be(t,function t(e,r,n,o,i){var a=-1,s=e.length;for(n=n||Re,i=i||[];++a<s;){var u=e[a];if(0<r&&n(u))if(1<r)t(u,r-1,n,o,i);else{p=h=f=l=c=void 0;for(var c=i,l=u,f=-1,h=l.length,p=c.length;++f<h;)c[p+f]=l[f]}else o||(i[i.length]=u)}return i}(e,1,De,!0),void 0,n):[]},k=Ae(void 0===k?Ie.length-1:k,0);var $e=Array.isArray;function Ne(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=pe)&&!qe(t);var e}function De(t){return!!(e=t)&&"object"==(void 0===e?"undefined":fe(e))&&Ne(t);var e}function qe(t){t=Je(t)?je.call(t):"";return t==ye||t==_e}function Je(t){var e=void 0===t?"undefined":fe(t);return t&&("object"==e||"function"==e)}function Ue(t,e){if(Qe(t,e))return!0;var r=(t=t.toArray())[0],t=t[1],n=(e=e.toArray())[0],e=e[1],o=He(r,n),r=r.toFixed(o),n=n.toFixed(o),o=He(t,e),t=t.toFixed(o),e=e.toFixed(o);return r===n&&t===e}function He(t,e){return t=Ze(t),e=Ze(e),t=Math.max(t,e)-3,Math.max(t,0)}var We=ze,oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ve=jt(function(t,e){var P="__lodash_hash_undefined__",G=1,X=2,l=1/0,M=9007199254740991,j=17976931348623157e292,x=NaN,Y="[object Arguments]",W="[object Array]",V="[object Boolean]",K="[object Date]",Q="[object Error]",E="[object Function]",C="[object GeneratorFunction]",R="[object Map]",Z="[object Number]",z="[object Object]",O="[object Promise]",tt="[object RegExp]",I="[object Set]",et="[object String]",rt="[object Symbol]",A="[object WeakMap]",nt="[object ArrayBuffer]",$="[object DataView]",L=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,k=/^\w*$/,F=/^\./,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,B=/^\s+|\s+$/g,ot=/\\(\\)?/g,it=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,st=/^\[object .+?Constructor\]$/,ut=/^0o[0-7]+$/i,ct=/^(?:0|[1-9]\d*)$/,r={},lt=(r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r[Y]=r[W]=r[nt]=r[V]=r[$]=r[K]=r[Q]=r[E]=r[R]=r[Z]=r[z]=r[tt]=r[I]=r[et]=r[A]=!1,parseInt),n="object"==oe(ne)&&ne&&ne.Object===Object&&ne,o="object"==("undefined"==typeof self?"undefined":oe(self))&&self&&self.Object===Object&&self,o=n||o||Function("return this")(),e=e&&!e.nodeType&&e,i=e&&t&&!t.nodeType&&t,ft=i&&i.exports===e&&n.process,i=function(){try{return ft&&ft.binding("util")}catch(t){}}(),e=i&&i.isTypedArray;function ht(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function pt(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function dt(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var yt,_t,n=Array.prototype,i=Function.prototype,a=Object.prototype,s=o["__core-js_shared__"],gt=(s=/[^.]+$/.exec(s&&s.keys&&s.keys.IE_PROTO||""))?"Symbol(src)_1."+s:"",vt=i.toString,N=a.hasOwnProperty,u=a.toString,mt=RegExp("^"+vt.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),s=o.Symbol,bt=o.Uint8Array,wt=a.propertyIsEnumerable,St=n.splice,Pt=(yt=Object.keys,_t=Object,function(t){return yt(_t(t))}),Mt=Math.max,i=v(o,"DataView"),c=v(o,"Map"),n=v(o,"Promise"),jt=v(o,"Set"),o=v(o,"WeakMap"),f=v(Object,"create"),xt=w(i),Et=w(c),Ct=w(n),Ot=w(jt),At=w(o),s=s?s.prototype:void 0,Lt=s?s.valueOf:void 0,kt=s?s.toString:void 0;function h(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function p(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function d(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function y(t){var e=-1,r=t?t.length:0;for(this.__data__=new d;++e<r;)this.add(t[e])}function D(t){this.__data__=new p(t)}function Ft(t,e){var r,n=J(t)||Ht(t)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],o=n.length,i=!!o;for(r in t)!e&&!N.call(t,r)||i&&("length"==r||$t(r,o))||n.push(r);return n}function _(t,e){for(var r=t.length;r--;)if(Ut(t[r][0],e))return r;return-1}function Tt(t,e){for(var r=0,n=(e=m(e,t)?[e]:zt(e)).length;null!=t&&r<n;)t=t[b(e[r++])];return r&&r==n?t:void 0}function Bt(t,e){return null!=t&&e in Object(t)}function Gt(t,e,r,n,o){{if(t===e)return!0;if(null==t||null==e||!U(t)&&!H(e))return t!=t&&e!=e;var i=Gt,a=J(t),s=J(e),u=W,c=W,s=(a||(u=(u=q(t))==Y?z:u),s||(c=(c=q(e))==Y?z:c),u==z&&!ht(t)),l=c==z&&!ht(e),c;if((c=u==c)&&!s){o=o||new D;if(a||Zt(t))return It(t,e,i,r,n,o);else{var f=t;var h=e;var p=u;var d=i;var y=r;var _=n;var g=o;switch(p){case $:if(f.byteLength!=h.byteLength||f.byteOffset!=h.byteOffset)return!1;f=f.buffer,h=h.buffer;case nt:return f.byteLength==h.byteLength&&d(new bt(f),new bt(h))?!0:!1;case V:case K:case Z:return Ut(+f,+h);case Q:return f.name==h.name&&f.message==h.message;case tt:case et:return f==h+"";case R:var v=pt;case I:var m=_&X;if(v=v||dt,f.size!=h.size&&!m)return!1;m=g.get(f);if(m)return m==h;_|=G,g.set(f,h);m=It(v(f),v(h),d,y,_,g);return g.delete(f),m;case rt:if(Lt)return Lt.call(f)==Lt.call(h)}return!1;return}}if(!(n&X)){var a=s&&N.call(t,"__wrapped__"),u=l&&N.call(e,"__wrapped__");if(a||u)return s=a?t.value():t,l=u?e.value():e,o=o||new D,i(s,l,r,n,o)}if(c){o=o||new D;var b=t,w=e,S=i,P=r,M=n,j=o,x=M&X,E=ee(b),C=E.length,a=ee(w).length;if(C!=a&&!x)return!1;for(var O=C;O--;){var A=E[O];if(!(x?A in w:N.call(w,A)))return!1}if((a=j.get(b))&&j.get(w))return a==w;for(var L=!0,k=(j.set(b,w),j.set(w,b),x);++O<C;){A=E[O];var F,T=b[A],B=w[A];if(!(void 0===(F=P?x?P(B,T,A,w,b,j):P(T,B,A,b,w,j):F)?T===B||S(T,B,P,M,j):F)){L=!1;break}k=k||"constructor"==A}return L&&!k&&(a=b.constructor,u=w.constructor,a!=u&&"constructor"in b&&"constructor"in w&&!("function"==typeof a&&a instanceof a&&"function"==typeof u&&u instanceof u)&&(L=!1)),j.delete(b),j.delete(w),L}return!1}}function Xt(t){var e;if(U(t)&&(e=t,!(gt&&gt in e)))return(Vt(t)||ht(t)?mt:st).test(w(t))}function Yt(t){if("function"==typeof t)return t;if(null==t)return re;if("object"==(void 0===t?"undefined":oe(t)))if(J(t)){var n=t[0],o=t[1];return m(n)&&Nt(o)?Dt(b(n),o):function(t){var e,r=function(t,e,r){t=null==t?void 0:Tt(t,e);return void 0===t?r:t}(t,n);return void 0===r&&r===o?(e=n,null!=(t=t)&&function(t,e,r){e=m(e,t)?[e]:zt(e);var n,o=-1,i=e.length;for(;++o<i;){var a=b(e[o]);if(!(n=null!=t&&r(t,a)))break;t=t[a]}if(n)return n;return!!(i=t?t.length:0)&&Kt(i)&&$t(a,i)&&(J(t)||Ht(t))}(t,e,Bt)):Gt(o,r,void 0,G|X)}}else{var e=t,r=function(t){var e=ee(t),r=e.length;for(;r--;){var n=e[r],o=t[n];e[r]=[n,o,Nt(o)]}return e}(e);return 1==r.length&&r[0][2]?Dt(r[0][0],r[0][1]):function(t){return t===e||function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var s=r[o];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++o<i;){var u=(s=r[o])[0],c=t[u],l=s[1];if(a&&s[2]){if(void 0===c&&!(u in t))return!1}else{var f,h=new D;if(!(void 0===(f=n?n(c,l,u,t,e,h):f)?Gt(l,c,n,G|X,h):f))return!1}}return!0}(t,e,r)}}var i,a;return m(t=t)?(i=b(t),function(t){return null==t?void 0:t[i]}):(a=t,function(t){return Tt(t,a)})}function Rt(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||a,e!==r)return Pt(t);var e,r,n,o=[];for(n in Object(t))N.call(t,n)&&"constructor"!=n&&o.push(n);return o}function zt(t){return J(t)?t:qt(t)}function It(t,e,r,n,o,i){var a=o&X,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;u=i.get(t);if(u&&i.get(e))return u==e;var c=-1,l=!0,f=o&G?new y:void 0;for(i.set(t,e),i.set(e,t);++c<s;){var h,p=t[c],d=e[c];if(void 0!==(h=n?a?n(d,p,c,e,t,i):n(p,d,c,t,e,i):h)){if(h)continue;l=!1;break}if(f){if(!function(t,e){for(var r=-1,n=t?t.length:0;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return!f.has(e)&&(p===t||r(p,t,n,o,i))&&f.add(e)})){l=!1;break}}else if(p!==d&&!r(p,d,n,o,i)){l=!1;break}}return i.delete(t),i.delete(e),l}function g(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":oe(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function v(t,e){e=e;t=null==(t=t)?void 0:t[e];return Xt(t)?t:void 0}h.prototype.clear=function(){this.__data__=f?f(null):{}},h.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},h.prototype.get=function(t){var e,r=this.__data__;return f?(e=r[t])===P?void 0:e:N.call(r,t)?r[t]:void 0},h.prototype.has=function(t){var e=this.__data__;return f?void 0!==e[t]:N.call(e,t)},h.prototype.set=function(t,e){return this.__data__[t]=f&&void 0===e?P:e,this},p.prototype.clear=function(){this.__data__=[]},p.prototype.delete=function(t){var e=this.__data__;return!((t=_(e,t))<0)&&(t==e.length-1?e.pop():St.call(e,t,1),!0)},p.prototype.get=function(t){var e=this.__data__;return(t=_(e,t))<0?void 0:e[t][1]},p.prototype.has=function(t){return-1<_(this.__data__,t)},p.prototype.set=function(t,e){var r=this.__data__,n=_(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},d.prototype.clear=function(){this.__data__={hash:new h,map:new(c||p),string:new h}},d.prototype.delete=function(t){return g(this,t).delete(t)},d.prototype.get=function(t){return g(this,t).get(t)},d.prototype.has=function(t){return g(this,t).has(t)},d.prototype.set=function(t,e){return g(this,t).set(t,e),this},y.prototype.add=y.prototype.push=function(t){return this.__data__.set(t,P),this},y.prototype.has=function(t){return this.__data__.has(t)},D.prototype.clear=function(){this.__data__=new p},D.prototype.delete=function(t){return this.__data__.delete(t)},D.prototype.get=function(t){return this.__data__.get(t)},D.prototype.has=function(t){return this.__data__.has(t)},D.prototype.set=function(t,e){var r=this.__data__;if(r instanceof p){var n=r.__data__;if(!c||n.length<199)return n.push([t,e]),this;r=this.__data__=new d(n)}return r.set(t,e),this};var q=function(t){return u.call(t)};function $t(t,e){return!!(e=null==e?M:e)&&("number"==typeof t||ct.test(t))&&-1<t&&t%1==0&&t<e}function m(t,e){var r;if(!J(t))return r=void 0===t?"undefined":oe(t),"number"==r||"symbol"==r||"boolean"==r||null==t||S(t)||(k.test(t)||!L.test(t)||null!=e&&t in Object(e))}function Nt(t){return t==t&&!U(t)}function Dt(e,r){return function(t){return null!=t&&(t[e]===r&&(void 0!==r||e in Object(t)))}}(i&&q(new i(new ArrayBuffer(1)))!=$||c&&q(new c)!=R||n&&q(n.resolve())!=O||jt&&q(new jt)!=I||o&&q(new o)!=A)&&(q=function(t){var e=u.call(t),t=e==z?t.constructor:void 0,t=t?w(t):void 0;if(t)switch(t){case xt:return $;case Et:return R;case Ct:return O;case Ot:return I;case At:return A}return e});var qt=Jt(function(t){t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(S(t))return kt?kt.call(t):"";var e=t+"";return"0"==e&&1/t==-l?"-0":e}(e);var e,o=[];return F.test(t)&&o.push(""),t.replace(T,function(t,e,r,n){o.push(r?n.replace(ot,"$1"):e||t)}),o});function b(t){if("string"==typeof t||S(t))return t;var e=t+"";return"0"==e&&1/t==-l?"-0":e}function w(t){if(null!=t){try{return vt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Jt(n,o){if("function"!=typeof n||o&&"function"!=typeof o)throw new TypeError("Expected a function");function i(){var t=arguments,e=o?o.apply(this,t):t[0],r=i.cache;return r.has(e)?r.get(e):(t=n.apply(this,t),i.cache=r.set(e,t),t)}return i.cache=new(Jt.Cache||d),i}function Ut(t,e){return t===e||t!=t&&e!=e}function Ht(t){return H(e=t)&&Wt(e)&&N.call(t,"callee")&&(!wt.call(t,"callee")||u.call(t)==Y);var e}Jt.Cache=d;var J=Array.isArray;function Wt(t){return null!=t&&Kt(t.length)&&!Vt(t)}function Vt(t){t=U(t)?u.call(t):"";return t==E||t==C}function Kt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=M}function U(t){var e=void 0===t?"undefined":oe(t);return t&&("object"==e||"function"==e)}function H(t){return!!t&&"object"==(void 0===t?"undefined":oe(t))}function S(t){return"symbol"==(void 0===t?"undefined":oe(t))||H(t)&&u.call(t)==rt}var Qt,Zt=e?(Qt=e,function(t){return Qt(t)}):function(t){return H(t)&&Kt(t.length)&&!!r[u.call(t)]};function te(t){if("number"==typeof t)return t;if(S(t))return x;if("string"!=typeof(t=U(t)?U(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=t.replace(B,"");var e=at.test(t);return e||ut.test(t)?lt(t.slice(2),e?2:8):it.test(t)?x:+t}function ee(t){return(Wt(t)?Ft:Rt)(t)}function re(t){return t}t.exports=function(t,e,r){var n=t?t.length:0;if(!n)return-1;for(var o=null==r?0:(r=function(t){return t?(t=te(t))!==l&&t!==-l?t==t?t:0:(t<0?-1:1)*j:0===t?t:0}(r=r),o=r%1,r==r?o?r-o:r:0),i=(o<0&&(o=Mt(n+o,0)),t),a=Yt(e),r=o,s=void 0,u=i.length,c=r+(s?1:-1);s?c--:++c<u;)if(a(i[c],c,i))return c;return-1}}),Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qe=jt(function(t,e){var n="__lodash_hash_undefined__",G=1,H=2,M=9007199254740991,X="[object Arguments]",Y="[object Array]",j="[object AsyncFunction]",W="[object Boolean]",V="[object Date]",K="[object Error]",x="[object Function]",E="[object GeneratorFunction]",R="[object Map]",Q="[object Number]",C="[object Null]",z="[object Object]",O="[object Promise]",A="[object Proxy]",Z="[object RegExp]",I="[object Set]",tt="[object String]",et="[object Symbol]",L="[object Undefined]",r="[object WeakMap]",rt="[object ArrayBuffer]",$="[object DataView]",k=/^\[object .+?Constructor\]$/,F=/^(?:0|[1-9]\d*)$/,o={},i=(o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o[X]=o[Y]=o[rt]=o[W]=o[$]=o[V]=o[K]=o[x]=o[R]=o[Q]=o[z]=o[Z]=o[I]=o[tt]=o[r]=!1,"object"==Ke(ne)&&ne&&ne.Object===Object&&ne),a="object"==("undefined"==typeof self?"undefined":Ke(self))&&self&&self.Object===Object&&self,a=i||a||Function("return this")(),e=e&&!e.nodeType&&e,s=e&&t&&!t.nodeType&&t,s=s&&s.exports===e,u=s&&i.process,e=function(){try{return u&&u.binding&&u.binding("util")}catch(t){}}(),i=e&&e.isTypedArray;function nt(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function ot(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var T,B,e=Array.prototype,c=Function.prototype,l=Object.prototype,f=a["__core-js_shared__"],it=c.toString,N=l.hasOwnProperty,at=(c=/[^.]+$/.exec(f&&f.keys&&f.keys.IE_PROTO||""))?"Symbol(src)_1."+c:"",st=l.toString,ut=RegExp("^"+it.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),f=s?a.Buffer:void 0,c=a.Symbol,ct=a.Uint8Array,lt=l.propertyIsEnumerable,ft=e.splice,h=c?c.toStringTag:void 0,ht=Object.getOwnPropertySymbols,s=f?f.isBuffer:void 0,pt=(T=Object.keys,B=Object,function(t){return T(B(t))}),e=S(a,"DataView"),p=S(a,"Map"),f=S(a,"Promise"),dt=S(a,"Set"),a=S(a,"WeakMap"),d=S(Object,"create"),yt=P(e),_t=P(p),gt=P(f),vt=P(dt),mt=P(a),c=c?c.prototype:void 0,bt=c?c.valueOf:void 0;function y(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function _(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function g(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function v(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new g;++e<r;)this.add(t[e])}function D(t){t=this.__data__=new _(t);this.size=t.size}function wt(t,e){var r,n,o,i=J(t),a=!i&&At(t),s=!i&&!a&&Lt(t),u=!i&&!a&&!s&&Gt(t),c=i||a||s||u,l=c?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],f=l.length;for(r in t)!e&&!N.call(t,r)||c&&("length"==r||s&&("offset"==r||"parent"==r)||u&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||(n=r,(o=null==(o=f)?M:o)&&("number"==typeof n||F.test(n))&&-1<n&&n%1==0&&n<o))||l.push(r);return l}function m(t,e){for(var r=t.length;r--;)if(Ot(t[r][0],e))return r;return-1}function b(t){{if(null==t)return void 0===t?L:C;if(h&&h in Object(t)){var e=t,r=N.call(e,h),n=e[h];try{var o=!(e[h]=void 0)}catch(t){}var i=st.call(e);return o&&(r?e[h]=n:delete e[h]),i}return st.call(t)}}function St(t){return U(t)&&b(t)==X}function Pt(t,e,r,n,o){{if(t===e)return!0;if(null==t||null==e||!U(t)&&!U(e))return t!=t&&e!=e;var i=Pt,a=J(t),s=J(e),u=a?Y:q(t),s=s?Y:q(e),c=(u=u==X?z:u)==z,l=(s=s==X?z:s)==z,s;if((s=u==s)&&Lt(t)){if(!Lt(e))return!1;c=!(a=!0)}if(s&&!c){o=o||new D;if(a||Gt(t))return xt(t,e,r,n,i,o);else{var f=t;var h=e;var p=u;var d=r;var y=n;var _=i;var g=o;switch(p){case $:if(f.byteLength!=h.byteLength||f.byteOffset!=h.byteOffset)return!1;f=f.buffer,h=h.buffer;case rt:return f.byteLength==h.byteLength&&_(new ct(f),new ct(h))?!0:!1;case W:case V:case Q:return Ot(+f,+h);case K:return f.name==h.name&&f.message==h.message;case Z:case tt:return f==h+"";case R:var v=nt;case I:var m=d&G;if(v=v||ot,f.size!=h.size&&!m)return!1;m=g.get(f);if(m)return m==h;d|=H,g.set(f,h);m=xt(v(f),v(h),d,y,_,g);return g.delete(f),m;case et:if(bt)return bt.call(f)==bt.call(h)}return!1;return}}if(!(r&G)){var a=c&&N.call(t,"__wrapped__"),u=l&&N.call(e,"__wrapped__");if(a||u)return c=a?t.value():t,l=u?e.value():e,o=o||new D,i(c,l,r,n,o)}if(s){o=o||new D;var b=t,w=e,S=r,P=n,M=i,j=o,x=S&G,E=Et(b),C=E.length,a=Et(w).length;if(C!=a&&!x)return!1;for(var O=C;O--;){var A=E[O];if(!(x?A in w:N.call(w,A)))return!1}if((a=j.get(b))&&j.get(w))return a==w;for(var L=!0,k=(j.set(b,w),j.set(w,b),x);++O<C;){A=E[O];var F,T=b[A],B=w[A];if(!(void 0===(F=P?x?P(B,T,A,w,b,j):P(T,B,A,b,w,j):F)?T===B||M(T,B,S,P,j):F)){L=!1;break}k=k||"constructor"==A}return L&&!k&&(a=b.constructor,u=w.constructor,a!=u&&"constructor"in b&&"constructor"in w&&!("function"==typeof a&&a instanceof a&&"function"==typeof u&&u instanceof u)&&(L=!1)),j.delete(b),j.delete(w),L}return!1}}function Mt(t){var e;if(Tt(t)&&(e=t,!(at&&at in e)))return(kt(t)?ut:k).test(P(t))}function jt(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||l,e!==r)return pt(t);var e,r,n,o=[];for(n in Object(t))N.call(t,n)&&"constructor"!=n&&o.push(n);return o}function xt(t,e,r,n,o,i){var a=r&G,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;u=i.get(t);if(u&&i.get(e))return u==e;var c=-1,l=!0,f=r&H?new v:void 0;for(i.set(t,e),i.set(e,t);++c<s;){var h,p=t[c],d=e[c];if(void 0!==(h=n?a?n(d,p,c,e,t,i):n(p,d,c,t,e,i):h)){if(h)continue;l=!1;break}if(f){if(!function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return!f.has(e)&&(p===t||o(p,t,r,n,i))&&f.push(e)})){l=!1;break}}else if(p!==d&&!o(p,d,r,n,i)){l=!1;break}}return i.delete(t),i.delete(e),l}function Et(t){var e=Xt,r=Ct;if(e=e(t),J(t))return e;for(var n=e,o=r(t),i=-1,a=o.length,s=n.length;++i<a;)n[s+i]=o[i];return n}function w(t,e){var r,n,t=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":Ke(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function S(t,e){e=e;t=null==(t=t)?void 0:t[e];return Mt(t)?t:void 0}y.prototype.clear=function(){this.__data__=d?d(null):{},this.size=0},y.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},y.prototype.get=function(t){var e,r=this.__data__;return d?(e=r[t])===n?void 0:e:N.call(r,t)?r[t]:void 0},y.prototype.has=function(t){var e=this.__data__;return d?void 0!==e[t]:N.call(e,t)},y.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=d&&void 0===e?n:e,this},_.prototype.clear=function(){this.__data__=[],this.size=0},_.prototype.delete=function(t){var e=this.__data__;return!((t=m(e,t))<0)&&(t==e.length-1?e.pop():ft.call(e,t,1),--this.size,!0)},_.prototype.get=function(t){var e=this.__data__;return(t=m(e,t))<0?void 0:e[t][1]},_.prototype.has=function(t){return-1<m(this.__data__,t)},_.prototype.set=function(t,e){var r=this.__data__,n=m(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},g.prototype.clear=function(){this.size=0,this.__data__={hash:new y,map:new(p||_),string:new y}},g.prototype.delete=function(t){return t=w(this,t).delete(t),this.size-=t?1:0,t},g.prototype.get=function(t){return w(this,t).get(t)},g.prototype.has=function(t){return w(this,t).has(t)},g.prototype.set=function(t,e){var r=w(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},v.prototype.add=v.prototype.push=function(t){return this.__data__.set(t,n),this},v.prototype.has=function(t){return this.__data__.has(t)},D.prototype.clear=function(){this.__data__=new _,this.size=0},D.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},D.prototype.get=function(t){return this.__data__.get(t)},D.prototype.has=function(t){return this.__data__.has(t)},D.prototype.set=function(t,e){var r=this.__data__;if(r instanceof _){var n=r.__data__;if(!p||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new g(n)}return r.set(t,e),this.size=r.size,this};var Ct=ht?function(e){if(null==e)return[];e=Object(e);for(var t=ht(e),r=function(t){return lt.call(e,t)},n=-1,o=null==t?0:t.length,i=0,a=[];++n<o;){var s=t[n];r(s,n,t)&&(a[i++]=s)}return a}:function(){return[]},q=b;function P(t){if(null!=t){try{return it.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ot(t,e){return t===e||t!=t&&e!=e}(e&&q(new e(new ArrayBuffer(1)))!=$||p&&q(new p)!=R||f&&q(f.resolve())!=O||dt&&q(new dt)!=I||a&&q(new a)!=r)&&(q=function(t){var e=b(t),t=e==z?t.constructor:void 0,t=t?P(t):"";if(t)switch(t){case yt:return $;case _t:return R;case gt:return O;case vt:return I;case mt:return r}return e});var At=St(function(){return arguments}())?St:function(t){return U(t)&&N.call(t,"callee")&&!lt.call(t,"callee")},J=Array.isArray;var Lt=s||function(){return!1};function kt(t){if(Tt(t))return t=b(t),t==x||t==E||t==j||t==A}function Ft(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=M}function Tt(t){var e=void 0===t?"undefined":Ke(t);return null!=t&&("object"==e||"function"==e)}function U(t){return null!=t&&"object"==(void 0===t?"undefined":Ke(t))}var Bt,Gt=i?(Bt=i,function(t){return Bt(t)}):function(t){return U(t)&&Ft(t.length)&&!!o[b(t)]};function Xt(t){return(null!=(e=t)&&Ft(e.length)&&!kt(e)?wt:jt)(t);var e}t.exports=function(t,e){return Pt(t,e)}}),Ze=function(t){return t.toString().split(".")[1].length};function tr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);if(t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e)if(Object.setPrototypeOf)Object.setPrototypeOf(t,e);else for(var r=t,n=e,o=Object.getOwnPropertyNames(n),i=0;i<o.length;i++){var a=o[i],s=Object.getOwnPropertyDescriptor(n,a);s&&s.configurable&&void 0===r[a]&&Object.defineProperty(r,a,s)}}var er,rr=n.INTERNAL_LAYER_PREFIX+"cxiaof_autoadsorb",l=(tr(F,er=n.Class),F.prototype.setMode=function(t){return this.options.mode=t,this._updateGeosSet(),this},F.prototype.getMode=function(){return this.options.mode},F.prototype.setDistance=function(t){return this.options.distance=t,this._updateGeosSet(),this},F.prototype.getDistance=function(){return this.options.distance},F.prototype.refreshTargets=function(){return this._updateGeosSet(),this},F.prototype.isEnable=function(){return this._isEnable},F.prototype.bindDrawTool=function(t){return t instanceof n.DrawTool&&(this._map||this._addTo(t.getMap()),(this._drawTool=t).on("enable",this._enable,this),t.on("disable",this._disable,this),t.isEnabled()&&this._enable()),this},F.prototype.bindGeometry=function(t){return t instanceof n.Geometry&&(this._map||this._addTo(drawTool.getMap()),this._disableMapTool(),this._geometry=t,this._geometryCoords=t.getCoordinates(),t.on("editstart",this._enable,this),t.on("editend",this._disable,this),t.isEditing()&&this._enable()),this},F.prototype.remove=function(){this._disable(),this._cursorLayer&&this._cursorLayer.remove(),delete this._treePoints,delete this._treeLines,delete this._geosSetPoint,delete this._geosSetLine,delete this._mousePoint,delete this._adsorbPoint,delete this._cursor,delete this._cursorLayer,delete this._drawTool,delete this._map},F.prototype._addTo=function(t){this._map=t,this._newCursorLayer()},F.prototype._newCursorLayer=function(){this._cursorLayer=new n.VectorLayer(rr,{style:{symbol:this._getCursorSymbol()}}),this._cursorLayer.addTo(this._map).bringToFront()},F.prototype._getCursorSymbol=function(t){return Object.assign({markerType:"ellipse",markerFill:"#fff",markerLineColor:"#272822",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:.4},t)},F.prototype._enable=function(){this._isEnable=!0,this._cursorLayer&&this._cursorLayer.show(),this._updateGeosSet(),this._registerMapEvents(),this._geometry?this._registerGeometryEvents():this._registerDrawToolEvents()},F.prototype._updateGeosSet=function(){this._geosSetPoint=[],this._geosSetLine=[];var t=this._getAllAssistGeos();["auto","vertux"].includes(this.options.mode)&&(this._geosSetPoint=this._parseToPoints(t)),["auto","border"].includes(this.options.mode)&&(this._geosSetLine=this._parseToLines(t)),this._updateRBushTree()},F.prototype._getAllAssistGeos=function(){var t=this._getAssistLayers().reduce(function(t,e){return t.concat(e.getGeometries())},[]);return t=this._geometry?le(t,[this._geometry]):t},F.prototype._getAssistLayers=function(){var r=this;return this.options.layers.reduce(function(t,e){return(e="string"==typeof e?r._map.getLayer(e):e)instanceof n.VectorLayer&&t.push(e),t},[])},F.prototype._parseToPoints=function(t){var e=this,r=[];return t.forEach(function(t){r=(t instanceof n.GeometryCollection||(t instanceof n.Circle||t instanceof n.Ellipse)&&((t=t.copy()).setOptions(Object.assign(t.options||{},{numberOfShellPoints:e.options.shellPoints})),r.push(e._getCenterFeature(t))),r.concat(V(t.toGeoJSON()).features))}),r},F.prototype._getCenterFeature=function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.getCenter().toArray()},properties:{}}},F.prototype._parseToLines=function(t){var e=this,r=[];return(t=t.filter(function(t){return!(t instanceof n.Marker||t instanceof n.MultiPoint)})).forEach(function(t){t instanceof n.LineString?r.push(t.toGeoJSON()):r=t instanceof n.MultiLineString?r.concat(K(t.toGeoJSON()).features):((t instanceof n.Circle||t instanceof n.Ellipse)&&(t=t.copy()).setOptions(Object.assign(t.options||{},{numberOfShellPoints:e.options.shellPoints})),r.concat(e._polygonToLine(t.toGeoJSON())))}),this._splitLines(r)},F.prototype._polygonToLine=function(t){t=Pt(t);return"Feature"===t.type?K(t).features:t.features.reduce(function(t,e){return t.concat(K(e).features)},[])},F.prototype._splitLines=function(t){return t.reduce(function(t,e){for(var r=e.geometry.coordinates,n=0;n<r.length-1;n++){var o=[r[n],r[n+1]];t.push({type:"Feature",geometry:{type:"LineString",coordinates:o},properties:{}})}return t},[])},F.prototype._updateRBushTree=function(){this._treePoints.clear(),this._treePoints.load({type:"FeatureCollection",features:this._geosSetPoint}),this._treeLines.clear(),this._treeLines.load({type:"FeatureCollection",features:this._geosSetLine})},F.prototype._registerMapEvents=function(){this._needFindGeometry=!this._geometry,this._map.on("mousedown",this._mapMousedown,this),this._map.on("mouseup",this._mapMouseup,this),this._map.on("mousemove",this._mapMousemove,this)},F.prototype._mapMousedown=function(){this._geometry&&(this._needFindGeometry=!0)},F.prototype._mapMouseup=function(){this._geometry&&(this._needFindGeometry=!1)},F.prototype._mapMousemove=function(t){var e=t.coordinate,t=t.domEvent;this._mousePoint=e,this._cursor?this._cursor.setCoordinates(e):(this._cursor=new n.Marker(e),this._cursor.addTo(this._cursorLayer)),delete this._adsorbPoint,this.options.needCtrl===t.ctrlKey?this._updateAdsorbPoint(e):this._resetCursorSymbol()},F.prototype._resetCursorSymbol=function(){this._cursor.setSymbol(this._getCursorSymbol())},F.prototype._updateAdsorbPoint=function(t){if(!this._needFindGeometry)return this._resetCursorSymbol();var e,t=this._findGeometry(t);0<t.length&&(this._adsorbPoint=this._getAdsorbPoint(t)),this._adsorbPoint?(e=(t=this._adsorbPoint).x,t=t.y,this._cursor.setCoordinates([e,t])):this._resetCursorSymbol()},F.prototype._findGeometry=function(t){var e,r=[];return 0<this._geosSetPoint.length&&(e=this._findAvailGeos(this._treePoints,t),r=r.concat(e)),0<this._geosSetLine.length&&(e=this._findAvailGeos(this._treeLines,t),r=r.concat(e)),r},F.prototype._findAvailGeos=function(t,e){e=this._createInspectExtent(e);return t.search(e).features},F.prototype._createInspectExtent=function(t){var e=this._map.pixelToDistance(0,this.options.distance);return new n.Circle(t,e,{properties:{},numberOfShellPoints:this.options.shellPoints}).toGeoJSON()},F.prototype._getAdsorbPoint=function(t){var e=void 0,r=[this._mousePoint.x,this._mousePoint.y],n=t.filter(function(t){return"Point"===t.geometry.type}),t=(0<n.length?(e=this._getNearestPoint(r,n),this._cursor.setSymbol(this._getCursorSymbol({markerFill:"#f5871f",markerLineColor:"#0078a8",opacity:1}))):(n=t.filter(function(t){return"LineString"===t.geometry.type}),e=this._getNearestPointOnLine(r,n),this._cursor.setSymbol(this._getCursorSymbol({markerLineColor:"#0078a8",opacity:1}))),e.geometry.coordinates);return{x:t[0],y:t[1]}},F.prototype._getNearestPoint=function(t,e){var r=t,t={type:"FeatureCollection",features:e};if(!r)throw new Error("targetPoint is required");if(!t)throw new Error("points is required");var n=1/0,o=0;return g(t,function(t,e){t=m(r,t);t<n&&(o=e,n=t)}),(t=Z(t.features[o])).properties.featureIndex=o,t.properties.distanceToPoint=n,t},F.prototype._getNearestPointOnLine=function(t,e){var n;return n={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},g({type:"FeatureCollection",features:e},function(t){var e,r;switch(null==(r=t.geometry)?void 0:r.type){case"Point":n.MultiPoint.coordinates.push(t.geometry.coordinates),n.MultiPoint.properties.push(t.properties);break;case"MultiPoint":(e=n.MultiPoint.coordinates).push.apply(e,t.geometry.coordinates),n.MultiPoint.properties.push(t.properties);break;case"LineString":n.MultiLineString.coordinates.push(t.geometry.coordinates),n.MultiLineString.properties.push(t.properties);break;case"MultiLineString":(e=n.MultiLineString.coordinates).push.apply(e,t.geometry.coordinates),n.MultiLineString.properties.push(t.properties);break;case"Polygon":n.MultiPolygon.coordinates.push(t.geometry.coordinates),n.MultiPolygon.properties.push(t.properties);break;case"MultiPolygon":(e=n.MultiPolygon.coordinates).push.apply(e,t.geometry.coordinates),n.MultiPolygon.properties.push(t.properties)}}),St(_(Object.keys(n).filter(function(t){return n[t].coordinates.length}).sort().map(function(t){return p({type:t,coordinates:n[t].coordinates},{collectedProperties:n[t].properties})})),t)},F.prototype._registerGeometryEvents=function(){this._dragCenterHandle=null,this._geometry.on("handledragend",this._checkCenter,this),this._geometry.on("shapechange",this._setShadowCoordinates,this),this._geometry.on("editrecord",this._resetShadowCenter,this)},F.prototype._checkCenter=function(){this._dragCenterHandle=!this._shapechange},F.prototype._setShadowCoordinates=function(t){this._shapechange=!0,this._adsorbPoint&&((t=t.target)instanceof n.Circle?this._setShadowCircle(t):t instanceof n.Ellipse?this._setShadowEllipse(t):this._draggingCenter()||(t instanceof n.LineString?this._setShadowLineString(t):this._setShadowPolygon(t)))},F.prototype._draggingCenter=function(){return!(null===this._dragCenterHandle||n.Util.isNil(this._dragCenterHandle))},F.prototype._setShadowCircle=function(t){var e=this._calcCircleRadius(t);t._editor._shadow.setRadius(e)},F.prototype._calcCircleRadius=function(t){t=t.getCoordinates();return this._map.getProjection().measureLength([t,this._adsorbPoint])},F.prototype._setShadowEllipse=function(t){var e=this._calcEllipseSize(t),r=e[0],e=e[1];t._editor._shadow.setWidth(r).setHeight(e)},F.prototype._calcEllipseSize=function(t){var t=t.getCoordinates(),e=this._adsorbPoint,r=e.x,e=e.y;return[2*this._map.getProjection().measureLength([t,{x:r,y:t.y}]),2*this._map.getProjection().measureLength([t,{x:t.x,y:e}])]},F.prototype._setShadowLineString=function(t){var e=t.getCoordinates(),r=this._geometryCoords,r=We(e,r,Ue);0!==r.length&&(e[Ve(e,r[0])]=this._adsorbPoint,t._editor._shadow.setCoordinates(e))},F.prototype._setShadowPolygon=function(t){var e=t.getCoordinates(),r=this._geometryCoords,n=this._getShapeIndex(e),r=r[n],o=e[n],r=We(o,r,Ue);0!==r.length&&(r=Ve(o,r[0]),e[n][r]=this._adsorbPoint,0===r&&(e[n][o.length-1]=this._adsorbPoint),t._editor._shadow.setCoordinates(e))},F.prototype._getShapeIndex=function(t){var e=this._geometryCoords,r=We(t,e,Qe);return Ve(t,function(t){return Qe(t,r[0])})},F.prototype._resetShadowCenter=function(t){delete this._shapechange;var e,r,t=t.target;this._adsorbPoint&&(t instanceof n.Marker?t.setCoordinates(this._adsorbPoint):this._dragCenterHandle&&(e=t.getCenter(),r=[(r=this._adsorbPoint).x-e.x,r.y-e.y],t.translate.apply(t,r),(e=t._editor._shadow).translate.apply(e,r))),this._geometryCoords=t.getCoordinates(),delete this._dragCenterHandle},F.prototype._registerDrawToolEvents=function(){this._drawTool.on("drawstart drawvertex",this._resetCoordsAndPoint,this),this._drawTool.on("mousemove drawend",this._resetCoordinates,this)},F.prototype._resetCoordsAndPoint=function(t){this._resetCoordinates(t),this._resetClickPoint(t)},F.prototype._resetCoordinates=function(t){if(this._adsorbPoint){var e=t.target,r=e.options.mode,n=e._geometry;switch(r){case"Point":n.setCoordinates(this._adsorbPoint);break;case"Rectangle":this._resetRectangle(n,t);break;case"Circle":"drawstart"===t.type?n.setCoordinates(this._adsorbPoint):this._resetCircle(n);break;case"Ellipse":"drawstart"===t.type?n.setCoordinates(this._adsorbPoint):this._resetEllipse(n);break;default:this._resetCommon(n)}}},F.prototype._resetRectangle=function(t,e){var r,n=t.getCoordinates(),o=this._adsorbPoint,i=o.x,o=o.y;0===n[0].length?(r=this._map.coordinateToPoint(this._adsorbPoint),e.geometry._firstClick=this._map._pointToPrj(r)):(n[0][1].x=i,n[0][2].x=i,n[0][2].y=o,n[0][3].y=o,t.setCoordinates(n))},F.prototype._resetCircle=function(t){var e=this._calcCircleRadius(t);t.setRadius(e)},F.prototype._resetEllipse=function(t){var e=this._calcEllipseSize(t),r=e[0],e=e[1];t.setWidth(r).setHeight(e)._updateCache()},F.prototype._resetCommon=function(t){var e=t.getCoordinates();e.pop(),e.push(this._adsorbPoint),t.setCoordinates(e)},F.prototype._resetClickPoint=function(t){var e;this._adsorbPoint&&(t=t.target._clickCoords,e=this._map.coordToPoint(this._adsorbPoint),t.pop(),t.push(this._map._pointToPrj(e)))},F.prototype._disable=function(){this._isEnable=!1,this._cursorLayer&&this._cursorLayer.hide(),this._offMapEvents(),this._geometry?this._offGeometryEvents():this._offDrawToolEvents(),this._resetGeosSet(),delete this._geometry},F.prototype._offMapEvents=function(){delete this._needFindGeometry,this._map.off("mousedown",this._mapMousedown,this),this._map.off("mousemove",this._mapMousemove,this),this._map.off("mouseup",this._mapMouseup,this)},F.prototype._offGeometryEvents=function(){this._geometry.off("handledragend",this._checkCenter,this),this._geometry.off("shapechange",this._setShadowCoordinates,this),this._geometry.off("editrecord",this._resetShadowCenter,this)},F.prototype._offDrawToolEvents=function(){this._drawTool.off("drawstart drawvertex",this._resetCoordsAndPoint,this),this._drawTool.off("mousemove drawend",this._resetCoordinates,this)},F.prototype._resetGeosSet=function(){this._geosSetPoint=[],this._geosSetLine=[],this._updateRBushTree()},F.prototype._disableMapTool=function(){this._map._map_tool&&this._map._map_tool.disable()},F);function F(t){if(!(this instanceof F))throw new TypeError("Cannot call a class as a function");t=function(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,er.call(this,t));return t._isEnable=!1,t._treePoints=bt(),t._treeLines=bt(),t}l.mergeOptions({layers:[],mode:"auto",distance:10,shellPoints:60,needCtrl:!1}),T.Autoadsorb=l,Object.defineProperty(T,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.autoadsorb v1.0.0-alpha.3, requires maptalks@>=0.46.0.")});